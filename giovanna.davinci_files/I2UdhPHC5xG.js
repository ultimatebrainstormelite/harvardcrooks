/*!CK:1161407209!*//*1439939561,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["3DfBj"]); }

__d('AjaxRequest',['ErrorUtils','Keys','URI','UserAgent_DEPRECATED','getSameOriginTransport','setTimeoutAcrossTransitions','PHPQuerySerializer'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();function o(s,t,u){this.xhr=l();if(!(t instanceof j))t=new j(t);if(u&&s=='GET'){t.setQueryData(u);}else this._params=u;this.method=s;this.uri=t;this.xhr.open(s,t);}var p=window.XMLHttpRequest&&'withCredentials' in new XMLHttpRequest();o.supportsCORS=function(){return p;};o.ERROR='ar:error';o.TIMEOUT='ar:timeout';o.PROXY_ERROR='ar:proxy error';o.TRANSPORT_ERROR='ar:transport error';o.SERVER_ERROR='ar:http error';o.PARSE_ERROR='ar:parse error';o.SERVICE_UNAVAILABLE='ar:noservice';o._inflight=[];function q(){var s=o._inflight;o._inflight=[];s.forEach(function(t){t.abort();});}function r(s){s.onJSON=s.onError=s.onSuccess=null;clearTimeout(s._timer);if(s.xhr&&s.xhr.readyState<4){s.xhr.abort();s.xhr=null;}o._inflight=o._inflight.filter(function(t){return t&&t!=s&&t.xhr&&t.xhr.readyState<4;});}Object.assign(o.prototype,{timeout:60000,streamMode:true,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(s){if(this[s])this[s](this);},_parseStatus:function(){var s;try{this.status=this.xhr.status;s=this.xhr.statusText;}catch(t){if(this.xhr.readyState>=4){this.errorType=o.TRANSPORT_ERROR;this.errorText=t.message;}return;}if(this.status===0&&!/^(file|ftp)/.test(this.uri)){this.errorType=o.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=o.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=o.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=o.SERVER_ERROR;}else if(this.status===503){this.errorType=o.SERVICE_UNAVAILABLE;}else if(this.status>500&&this.status<600){this.errorType=o.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=o.TRANSPORT_ERROR;}else{s='unrecognized status code: '+this.status;this.errorType=o.ERROR;}if(!this.errorText)this.errorText=s;},_parseResponse:function(){var s,t=this.xhr.readyState;try{s=this.xhr.responseText||'';}catch(u){if(t>=4){this.errorType=o.ERROR;this.errorText='responseText not available - '+u.message;}return;}while(this.xhr){var v=this._eol+1,w=this.streamMode?s.indexOf('\n',v):s.length;if(w<0&&t==4)w=s.length;if(w<=this._eol)break;var x=s;if(this.streamMode)x=s.substr(v,w-v).replace(/^\s*|\s*$/g,'');if(v===0&&this.prelude)if(this.prelude.test(x))x=x.replace(this.prelude,'');this._eol=w;if(x){try{this.json=JSON.parse(x);}catch(u){var y=/(<body[\S\s]+?<\/body>)/i.test(s)&&RegExp.$1,z={message:u.message,'char':v,excerpt:(v===0&&y||x).substr(512)};this.errorType=o.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(z);return;}h.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var s=this.xhr&&this.xhr.readyState||0;if(this.status==null&&s>=2)this._parseStatus();if(!this.errorType&&this.status!=null)if(s==3&&this.streamMode||s==4)this._parseResponse();if(this.errorType||s==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');r(this);}},send:function(s){this.xhr.onreadystatechange=(function(){h.applyWithGuard(this._onReadyState,this,arguments);}).bind(this);var t=this.timeout;if(t)this._timer=m((function(){this.errorType=o.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');r(this);}).bind(this),t);o._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(s?n.serialize(s):'');},abort:function(){r(this);},toString:function(){var s='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)s+=' errorType='+this.errorType+' ('+this.errorText+')';return s+']';},toJSON:function(){var s={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};if(this.errorType)s.uri=this.uri;for(var t in s)if(s[t]==null)delete s[t];return s;}});if(window.addEventListener&&k.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===i.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',q);f.exports=o;},null);
__d('SystemEvents',['Arbiter','ErrorUtils','SystemEventsInitialData','UserAgent_DEPRECATED','setIntervalAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=new h(),n=[],o=1000;l(function(){for(var y=0;y<n.length;y++)n[y]();},o);function p(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1||0);}function q(){return j.ORIGINAL_USER_ID;}var r=q(),s=navigator.onLine;function t(){if(!s){s=true;m.inform(m.ONLINE,s);}}function u(){if(s){s=false;m.inform(m.ONLINE,s);}}if(k.ie()){if(k.ie()>=11){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}else if(k.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=t;document.body.onoffline=u;});}else n.push(function(){(navigator.onLine?t:u)();});}else if(window.addEventListener)if(!k.chrome()){window.addEventListener('online',t,false);window.addEventListener('offline',u,false);}var v=r;n.push(function(){var y=p();if(v!=y){m.inform(m.USER,y);v=y;}});var w=Date.now();function x(){var y=Date.now(),z=y-w,aa=z<0||z>10000;w=y;if(aa)m.inform(m.TIME_TRAVEL,z);return aa;}n.push(x);n.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});Object.assign(m,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(y){return (y||p())==r;},isOnline:function(){return k.chrome()||s;},checkTimeTravel:x});f.exports=m;},null);
__d('ChannelSubdomain',['Event','JSLogger','Run','setTimeoutAcrossTransitions','LogHistory','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('LogHistory').getInstance('channel'),m=c('WebStorage').getLocalStorage(),n=i.create('channel'),o='channel_sub:',p=7,q=100*1000,r=null,s;function t(){if(s){clearTimeout(s);s=null;}if(m&&r!=null)m.removeItem(o+r);r=null;}function u(v,w,x){var y=(v-1)*p;if(x){if(s)clearTimeout(s);r=s=null;}if(w==null)w=Math.floor(Math.random()*y);if(r==null)if(m){var z=[];for(var aa=0;aa<m.length;aa++){var ba=m.key(aa);if(ba.indexOf(o)===0){var ca=parseInt(ba.substr(o.length),10);z[ca]=parseInt(m.getItem(ba),10);}}var da=Date.now()-q;for(aa=0;aa<y;aa++){var ea=(aa+w)%y;if(!z[ea]||z[ea]<da){r=ea;break;}}if(r!=null){var fa=function(){try{m.setItem(o+r,Date.now());}catch(ga){l.warn('subdomain set failed',ga.message);}s=k(fa,q/2);};fa();}else{l.warn('no channel subdomain',z);n.error('subdomain_overflow');}if(typeof window.onpageshow!='undefined'){h.listen(window,'pagehide',t);}else j.onUnload(t);}else r=w;return r==null?null:r%p;}f.exports={allocate:u,clear:t};},null);
__d('DocRPC',['ErrorUtils'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={_apis:{},_dispatch:function(j){var k;try{j=JSON.parse(j);}catch(l){throw new Error('DocRPC unparsable dispatch: "'+j+'"');}if(i._apis.hasOwnProperty(j.api)){var m=i._apis[j.api];if(m[j.method])k=h.applyWithGuard(m[j.method],m,j.args);}if(k===undefined)k=null;return JSON.stringify(k);},publish:function(j,k){i._apis[k]=j;},proxy:function(j,k,l){var m={};l.forEach(function(n){m[n]=function(){var o={api:k,method:n,args:Array.prototype.slice.call(arguments)},p;try{if(j.closed)throw new Error('DocRPC window closed');p=j.DocRPC._dispatch(JSON.stringify(o));}catch(q){h.reportError(q);return;}if(typeof p=='string')try{p=JSON.parse(p);}catch(q){throw new Error('DocRPC '+k+'.'+n+' unparsable return: "'+p+'"');}return p;};});return m;}};f.exports=b.DocRPC=i;},null);
__d('ChannelTransport',['AjaxRequest','ChannelConstants','DocRPC','LogHistory','URI','bind','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=k.getInstance('channel');function p(){return (1048576*Math.random()|0).toString(36);}function q(z,aa){var ba=z.subdomain;ba=ba===null?'':ba+'-';var ca=new l(aa).setDomain(ba+z.host+'.'+z.domain).setPort(z.port).setSecure(new l(window.location.href).isSecure());return ca;}function r(z){var aa={partition:z.partition,cb:p()};if(z.sticky_token)aa.sticky_token=z.sticky_token;var ba=q(z,'/p').setQueryData(aa);o.log('start_p',{uri:ba.toString()});var ca=new h('GET',ba);if(h.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){o.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function s(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){o.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){r(z);ea(false);};var fa=n(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:p()};if(z.sticky_token)ga.sticky_token=z.sticky_token;if(z.sticky_pool)ga.sticky_pool=z.sticky_pool;if(z.lastRequestErrorReason){ga.reason=z.lastRequestErrorReason;z.lastRequestErrorReason=null;}if(z.uid&&z.viewerUid){ga.uid=z.uid;ga.viewer_uid=z.viewerUid;}if(z.watchdog&&z.watchdog.enabled)ga.wtc=z.watchdog.doSerialize();da=Date.now();ca.src=q(z,'/ping').setQueryData(ga);return ca;}function t(z){var aa={channel:z.user_channel,partition:z.partition,clientid:z.sessionID,cb:p(),cap:0,uid:z.uid,viewer_uid:z.viewerUid};if(z.sticky_token)aa.sticky_token=z.sticky_token;if(z.sticky_pool)aa.sticky_pool=z.sticky_pool;if(z.is_offline||z.shouldSuppressPresence){aa.state='offline';}else aa.state='active';if(aa.state===z.lastPresenceState)return;z.lastPresenceState=aa.state;if(z.profile)aa.profile=z.profile;if(z.capabilities)aa.cap=z.capabilities;var ba=q(z,'/active_ping').setQueryData(aa),ca=new h('GET',ba);if(h.supportsCORS())ca.xhr.withCredentials=true;ca.onError=function(da){o.warn('active_ping_error');};ca.onSuccess=function(da){o.log('active_ping_ok');};ca.timeout=z.P_TIMEOUT;ca.send();}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)o.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:p(),idle:ea,cap:0};if(!!z.watchdog&&z.watchdog.enabled)fa.wtc=z.watchdog.doSerialize();fa.msgs_recv=z.estimatedReceived;if(z.uid&&z.viewerUid){fa.uid=z.uid;fa.viewer_uid=z.viewerUid;}if(z.stableDeviceId)fa.sdi=1;if(z.sticky_token){fa.sticky_token=z.sticky_token;}else if(z.msgr_region)fa.msgr_region=z.msgr_region;if(z.sticky_pool)fa.sticky_pool=z.sticky_pool;if('trace_id' in z)fa.traceid=z.trace_id;if(z.is_offline||z.shouldSuppressPresence){fa.state='offline';}else if(z.userActive>0&&ea<60)fa.state='active';z.lastPresenceState=fa.state;if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.capabilities)fa.cap=z.capabilities;var ga=q(z,'/pull').setQueryData(fa),ha=z.fantail_enabled?'POST':'GET',ia=new h(ha,ga);if(h.supportsCORS())ia.xhr.withCredentials=true;ia.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ia.onJSON=aa;ia.onSuccess=ba;ia.onError=function(){var la=this.status==12002&&this._time>=z.MIN_12002_TIMEOUT||this.status==504&&this._time>=z.MIN_504_TIMEOUT,ma=la?ba:ca;return ma&&ma.apply(this,arguments);};if(z.fantail_logs&&z.fantail_logs.length>0){var ja={};for(var ka=0;ka<z.fantail_logs.length;ka++)Object.assign(ja,z.fantail_logs[ka]);ia.send(ja);z.fantail_logs=[];}else ia.send();z.inStreaming=z.streamingCapable;return ia;}function v(z){this.manager=z;this.init&&this.init();}function w(z){v.apply(this,arguments);}Object.assign(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')n(m(this.manager,'exitState',{status:i.OK,stateId:aa.stateId}),aa.fullReloadAsSuccess?0:3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=s(aa,m(ba,'exitState',{status:i.OK,stateId:aa.stateId}),m(ba,'exitState',{status:i.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(ba,'_processTransportData',aa.stateId),m(ba,'exitState',{status:i.OK,stateId:aa.stateId}),m(ba,'exitState',{status:i.ERROR,stateId:aa.stateId}));}});function x(z){o.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);j.publish(this,'outerTransport');}Object.assign(x.prototype,{logName:'iframe',_initIframe:function(z){o.log('iframe_init_start');window.onchanneliframeready=function(){o.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){o.log('iframe_loaded');};if(z){this._iframeURI=q(z,z.path);if(z.resources){var aa=this._iframeURI.getDomain();z.resources=z.resources.map(function(da){var ea=new l(da);if(ea.getPath().startsWith('/intern/rsrc.php')&&ea.getQueryData().origin!==undefined)return ea.addQueryData('origin',aa).toString();return da;});}if(z.bustIframe){var ba={partition:z.partition,cb:p()};this._iframeURI.setQueryData(ba);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);o.log('iframe_uri_set');}catch(ca){o.error('iframe_uri_set_error',ca);this.exitState({status:i.ERROR,stateId:z.stateId},ca+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:i.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==i.OK)this._iframeProxy=j.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}Object.assign(y.prototype,{logName:'iframe(inner)',init:function(){j.publish(this,'innerTransport');try{var aa=j.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);Object.assign(this,aa);this.exitState({status:i.OK,stateId:1e+06});}catch(z){o.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=s(aa,m(this,'exitState',{status:i.OK,stateId:aa.stateId}),m(this,'exitState',{status:i.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,m(this,'_processTransportData',aa.stateId),m(this,'exitState',{status:i.OK,stateId:aa.stateId}),m(this,'exitState',{status:i.ERROR,stateId:aa.stateId}));}});f.exports={getURI:q,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y,sendActivePing:t};},null);
__d('FBAjaxRequest',['AjaxRequest','getAsyncParams'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=Object.assign||function(l){for(var m=1;m<arguments.length;m++){var n=arguments[m];for(var o in n)if(Object.prototype.hasOwnProperty.call(n,o))l[o]=n[o];}return l;};function k(l,m,n){n=j({},i(l),n);var o=new h(l,m,n);o.streamMode=false;var p=o._call;o._call=function(q){if(q=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}p.apply(this,arguments);};o.ajaxReqSend=o.send;o.send=function(q){this.ajaxReqSend(j({},q,n));};return o;}f.exports=k;},null);
__d("MovingStat",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i){i=i||60000;var j={t:new Date(),count:0,v:0},k=j,l=0,m=0;function n(){var o=new Date()-i;while(k&&k.next&&k.t<o){l-=k.v;m-=k.count;k=k.next;}}this.add=function(o){l+=o;m++;var p=new Date();if(p-j.t<1000){j.v+=o;j.count++;}else{j.next={t:p,v:o,count:1};j=j.next;n();}};this.tally=function(o){o=o||1000;n();return {sum:l,count:m,timeAverage:l*o/i};};}f.exports=h;},null);
__d('Dcode',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h,i={},j={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var l=[];for(var m in j){i[j[m]]=m;l.push(j[m]);}l.reverse();h=new RegExp(l.join("|"),'g');})();var k={encode:function(l){return encodeURIComponent(l).replace(/([_A-Z])|%../g,function(m,n){return n?'%'+n.charCodeAt(0).toString(16):m;}).toLowerCase().replace(h,function(m){return i[m];});},decode:function(l){return decodeURIComponent(l.replace(/[_A-Z]/g,function(m){return j[m];}));}};f.exports=k;},null);
__d('PresenceCookieManager',['Cookie','CurrentUser','Dcode','ErrorUtils','JSLogger','PresenceInitialData','PresenceUtil','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.cookieVersion,q=m.dictEncode,r='presence',s={},t=null,u=null,v=l.create('presence_cookie');function w(){try{var aa=h.get(r);if(t!==aa){t=aa;u=null;if(aa&&aa.charAt(0)=='E')aa=j.decode(aa.substring(1));if(aa)u=JSON.parse(aa);}if(u){if(u.user&&u.user!==i.getID())return null;if(u.v!==p)return null;return u;}}catch(z){v.warn('getcookie_error',z);}return null;}function x(){return parseInt(Date.now()/1000,10);}var y={register:function(z,aa){s[z]=aa;},store:function(){var z=w();if(z&&z.v&&p<z.v){v.debug('stale_cookie',p);return;}var aa={v:p,time:x(),user:i.getID()};for(var ba in s)aa[ba]=k.applyWithGuard(s[ba],s,[z&&z[ba]],function(fa){fa.presence_subcookie=ba;});var ca=JSON.stringify(aa);if(q)ca='E'+j.encode(ca);if(n.hasUserCookie()){var da=ca.length;if(da>1024)v.warn('big_cookie',da);var ea=o.getRequestURI(false).isSecure()&&!!h.get('csm');h.set(r,ca,null,null,ea);}},clear:function(){h.clear(r);},getSubCookie:function(z){var aa=w();if(!aa)return null;return aa[z];}};f.exports=y;},null);
__d('PresenceState',['Arbiter','ErrorUtils','JSLogger','PresenceCookieManager','debounceAcrossTransitions','setIntervalAcrossTransitions','PresenceInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=Object.assign||function(ka){for(var la=1;la<arguments.length;la++){var ma=arguments[la];for(var na in ma)if(Object.prototype.hasOwnProperty.call(ma,na))ka[na]=ma[na];}return ka;},p=n.cookiePollInterval||2000,q=n.shouldSuppress||false,r=[],s=[],t=null,u=null,v=0,w=null,x=0,y=['sb2','t2','lm2','uct2','tr','tw','at','wml'],z=j.create('presence_state');function aa(){return k.getSubCookie('state');}function ba(){v=Date.now();k.store();fa(u);}var ca=l(ba,0);function da(ka){if(typeof ka=='undefined'||isNaN(ka)||ka==Number.POSITIVE_INFINITY||ka==Number.NEGATIVE_INFINITY)ka=0;return ka;}function ea(ka){var la={};if(ka){y.forEach(function(oa){la[oa]=ka[oa];});if(v<ka.ut)z.error('new_cookie',{cookie_time:ka.ut,local_time:v});}la.ut=v;for(var ma=0,na=r.length;ma<na;ma++)i.applyWithGuard(r[ma],null,[la]);u=la;return u;}function fa(ka){x++;v=da(ka.ut);if(!t)t=m(ia,p);u=ka;if(w===null)w=ka;for(var la=0,ma=s.length;la<ma;la++)i.applyWithGuard(s[la],null,[ka]);x--;}function ga(ka){if(ka&&ka.ut)if(v<ka.ut){return true;}else if(ka.ut<v)z.error('old_cookie',{cookie_time:ka.ut,local_time:v});return false;}function ha(){var ka=aa();if(ga(ka))u=ka;return u;}function ia(){var ka=aa();if(ga(ka))fa(ka);}k.register('state',ea);h.subscribe(j.DUMP_EVENT,function(ka,la){la.presence_state={initial:o({},w),state:o({},u),update_time:v,sync_paused:x,poll_time:p};});(function(){var ka=ha();if(ka){fa(ka);}else{z.debug('no_cookie_initial');fa(ea());return;}})();var ja={doSync:function(ka){if(x)return;if(ka){ba();}else ca();},registerStateStorer:function(ka){r.push(ka);},registerStateLoader:function(ka){s.push(ka);},get:function(){return ha();},getInitial:function(){return w;},shouldSuppress:function(){return q;},verifyNumber:da};f.exports=ja;},null);
__d('RTISession',['URI','AjaxRequest','invariant','ErrorUtils'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l='.facebook.com';function m(n,o,p,q,r,s,t,u,v){!n?j(0):undefined;!q?j(0):undefined;!r?j(0):undefined;this.domain=n;this.port=o;this.edgePoolName=p;this.stickyToken=q;this.loggedInId=r;this.accountId=s;this.clientProfile=t||'desktop';this.clientId=u;this.capabilities=v;}m.prototype.issueRequest=function(n,o,p,q,r){!n?j(0):undefined;!o?j(0):undefined;!q?j(0):undefined;var s=this.domain.length-l.length,t=s>0&&this.domain.indexOf(l,s)!==-1,u=t?this.domain:this.domain+l,v=(1048576*Math.random()|0).toString(36),w={cb:v,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var x in w)!!o[x]?j(0):undefined;Object.assign(w,o);var y=new h(n).setDomain(u).setPort(this.port).setSecure(new h(window.location.href).isSecure()).setQueryData(w),z=p?'POST':'GET',aa=new i(z,y);aa.timeout=r?r*1000:30000;if(aa.xhr)aa.xhr.withCredentials=true;var ba={};aa.onSuccess=function(){};aa.onJSON=(function(){ba.data=aa.json;ba.error=null;k.applyWithGuard(q,this,[ba]);}).bind(this);aa.onError=(function(){ba.data=null;ba.error=aa.errorType||'error';k.applyWithGuard(q,this,[ba]);}).bind(this);aa.send(JSON.stringify(p));};f.exports=m;},null);
__d('ChannelManager',['AjaxRequest','Arbiter','AsyncRequest','ChannelConstants','ChannelInitialData','ChannelSubdomain','ChannelTransport','ChatVisibility','DTSG','Env','FBAjaxRequest','ISB','JSLogger','MessagingRealtimeConstants','MovingStat','PresenceCookieManager','PresenceState','PresenceUtil','Run','SystemEvents','URI','UserActivity','VideoCallSupport','RTISession','createArrayFromMixed','errorCode','setIntervalAcrossTransitions','setTimeoutAcrossTransitions','WebStorage'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia){if(c.__markCompiled)c.__markCompiled();var ja=c('WebStorage').getSessionStorage(),ka='chproxy_base_sess',la,ma=t.create('channel'),na=null;function oa(db){na=db;}var pa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},qa={reconnectOverrideTimeMillis:Date.now(),userActive:Date.now(),lastPresenceState:null,lastRequestErrorReason:null,seq:0,estimatedReceived:0,fantail_logs:[],sessionID:(Math.random()*2147483648|0).toString(16),stableDeviceId:false,capabilities:da.getCapabilities(),streamingCapable:false,inStreaming:false,shouldSuppressPresence:x.shouldSuppress(),LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:320000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,CHANNEL_PROXY_REPORTING_MIN_INTERVAL:10000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:5000,STREAMING_EXIT_STATE_ON_CONTINUE:false,FANTAIL_QUEUE_CAPACITY:50},ra={MAX_CONTINUOUS_PULL_FAILS:3,enabled:false,uptimeMillis:Date.now(),timeInGoodStatesStartMillis:Date.now(),timeInGoodStatesMillis:0,initialized:false,firstPullSentTimeMillis:Date.now(),accumulatedPullTimeMillis:0,pullStartTimeMillis:0,pingCount:0,pullCount:0,continuousPullFails:0,getTimeSinceFirstPullSentSeconds:function(){return (Date.now()-this.firstPullSentTimeMillis)/1000;},getUptimeSeconds:function(){return (Date.now()-this.uptimeMillis)/1000;},getAccumulatedPullTimeSeconds:function(){var db=this.accumulatedPullTimeMillis,eb=Date.now();if(this.pullStartTimeMillis>0&&eb-this.pullStartTimeMillis<=qa.LONGPOLL_TIMEOUT)db+=eb-this.pullStartTimeMillis;var fb=db/1000;if(fb>=this.getTimeSinceFirstPullSentSeconds())this.initialize();return fb;},getPingToPullRatio:function(){return this.pullCount===0?0:this.pingCount/this.pullCount;},reportPullSent:function(){if(!this.enabled)return;if(!this.initialized)this.initialize();this.pullStartTimeMillis=Date.now();},initialize:function(){this.initialized=true;this.firstPullSentTimeMillis=Date.now();this.pullStartTimeMillis=0;this.accumulatedPullTimeMillis=0;this.pingCount=0;this.pullCount=0;this.timeInGoodStatesStartMillis=Date.now();this.timeInGoodStatesMillis=0;this.uptimeMillis=Date.now();},reportPullReturned:function(db,eb){if(!this.enabled)return;if(this.pullStartTimeMillis>0){this.accumulatedPullTimeMillis+=Date.now()-this.pullStartTimeMillis;if(db){this.pullCount++;this.continuousPullFails=0;}else this.continuousPullFails++;}this.pullStartTimeMillis=0;},reportPingSent:function(){if(!this.enabled)return;this.pingCount++;},isGoodState:function(db){return db.indexOf('pull')===0||db.indexOf('init')===0||db.indexOf('idle')===0;},getTotalTimeInGoodStatesSeconds:function(){var db=this.timeInGoodStatesMillis;if(this.timeInGoodStatesStartMillis>0)db+=Date.now()-this.timeInGoodStatesStartMillis;return db/1000;},clientEnteredState:function(db){if(!this.enabled)return;var eb=this.isGoodState(db);if(eb&&this.timeInGoodStatesStartMillis===0){this.timeInGoodStatesStartMillis=Date.now();}else if(!eb&&this.timeInGoodStatesStartMillis>0){this.timeInGoodStatesMillis=Date.now()-this.timeInGoodStatesStartMillis;this.timeInGoodStatesStartMillis=0;}},transportEnteredState:function(db){if(!this.enabled)return;if(db.indexOf('pull')===0){this.reportPullSent();}else if(db.indexOf('ping')===0&&qa.lastRequestErrorReason!==k.SYS_TIMETRAVEL&&qa.lastRequestErrorReason!==k.SYS_ONLINE&&qa.lastRequestErrorReason!==k.SYS_OWNER&&qa.lastRequestErrorReason!==k.SYS_NONOWNER)this.reportPingSent();},doSerialize:function(){if(!this.enabled)return "";return this.getTimeSinceFirstPullSentSeconds().toFixed(0)+','+this.getAccumulatedPullTimeSeconds().toFixed(0)+','+this.getPingToPullRatio().toFixed(3)+','+this.getUptimeSeconds().toFixed(0)+','+this.getTotalTimeInGoodStatesSeconds().toFixed(0);}},sa=1,ta={},ua=0;function va(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function wa(){var db={};if(la.getConfig('host'))db[la.getConfig('user_channel')]=la.getConfig('seq',0);return db;}function xa(){var db=Date.now(),eb=Date.now(),fb={total:0},gb='idle',hb=false;aa.subscribe([aa.USER,aa.ONLINE,aa.TIME_TRAVEL],function(kb,lb){za(true);eb=null;la.lastPullTime=Date.now();var mb;switch(kb){case aa.USER:mb=aa.isPageOwner()?k.SYS_OWNER:k.SYS_NONOWNER;break;case aa.ONLINE:mb=lb?k.SYS_ONLINE:k.SYS_OFFLINE;break;case aa.TIME_TRAVEL:mb=k.SYS_TIMETRAVEL;break;}la.exitState({status:mb,stateId:sa});});var ib=function(kb,lb){var mb=Date.now(),nb;if(lb){db=mb;nb=lb.nextState||lb.state;}else nb=gb;aa.checkTimeTravel();if(eb){var ob=Math.round((mb-eb)/1000);if(ob>0){fb[gb]=(fb[gb]||0)+ob;fb.total+=ob;}}gb=nb;eb=mb;if(!kb){fb.lastSuccessTime=va();fb.online=aa.isOnline();ma.log('rollup',fb);}};i.subscribe(k.ON_ENTER_STATE,ib);ha(ib,60000);i.subscribe(t.DUMP_EVENT,function(kb,lb){lb.channelRollup=fb;});var jb=function(){if(la.isShutdown()||la.shouldIdle())return;aa.checkTimeTravel();var kb=Date.now()-(la.lastPullTime||q.start);if(!hb&&kb>qa.STALL_THRESHOLD){var lb=va();ma.error('stall',{lastSuccessTime:lb,rollupState:gb});hb=true;}var mb=Date.now()-db;if(la.state=='pull'&&mb>qa.JUMPSTART_THRESHOLD){db=null;ma.warn('jumpstart',{state:la.state,dormant:mb});la.enterState('init');}};ha(jb,10000);}function ya(){var db=Date.now(),eb=1;function fb(){ia(fb,eb*1000);var kb=la.state;if(kb=='idle'&&la.shouldIdle())return;ma.bump('conn_t',eb);if(kb=='pull')ma.bump('conn_t_pull',eb);}fb();var gb=[15,30,60,120,240],hb=false,ib=false;function jb(kb){ia(function(){ma.rate('pullenter_'+kb,hb);ma.rate('pullexit_'+kb,ib);},kb*1000);}while(gb.length)jb(gb.shift());i.subscribe(k.ON_ENTER_STATE,function(kb,lb){if(lb.state=='pull')hb=true;db=Date.now();});i.subscribe(k.ON_EXIT_STATE,function(kb,lb){if(lb.state!='pull'||!db)return;var mb='other';if(lb.status==k.OK){ib=true;mb='ok';}else if(lb.xhr&&lb.xhr.errorType){mb=/ar:(\w+)/.test(lb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(lb.status))return;var nb=(Date.now()-db)/1000;if(nb<0){return;}else if(nb>3600)nb=3600;ma.bump('conn_num');ma.bump('conn_exit',nb);ma.bump('conn_num_'+mb);ma.bump('conn_exit_'+mb,nb);});}function za(db){if(db){ua=0;ta={};}else ua++;}function ab(){if(!qa.stableDeviceId)return;var db={};db.sessionID=qa.sessionID;db.seq=qa.seq;db.estimatedReceived=qa.estimatedReceived;var eb=function(fb){if(typeof qa[fb]=="string")db[fb]=qa[fb];};eb('sticky_token');eb('sticky_pool');eb('host');ja.setItem(ka,JSON.stringify(db));}function bb(db){if(!db)return false;db=db.trim();if(db.length===0)return false;try{var fb=JSON.parse(db),gb=function(jb){if(typeof fb[jb]=="number")return fb[jb];ma.error("not an integer: "+jb+"="+fb[jb]);throw "NotAnInteger";},hb=function(jb){if(typeof fb[jb]=="string")qa[jb]=fb[jb];};hb('sticky_token');hb('sticky_pool');hb('host');qa.seq=gb('seq');qa.estimatedReceived=gb('estimatedReceived');var ib=fb.sessionID;if(ib&&ib.length&&ib.trim()){qa.sessionID=ib;return true;}return false;}catch(eb){ma.error("unable to parse state: "+db);return false;}}la={state:'idle',nextState:null,proxyDown:false,lastPullTime:Date.now(),lastReportOnMisguidedMsgTime:Date.now(),heartbeats:[],setTestCallback:oa,backoff:false,init:function(db){this.init=function(){};this._logFantail('client initialized',k.FANTAIL_INFO);var eb=!!qa.use_sticky_session,fb=false;qa.stableDeviceId=false;if(eb&&ja){qa.stableDeviceId=true;var gb=true;for(var hb=0;hb<ja.length;hb++){var ib=ja.key(hb);if(ib.indexOf(ka)===0){fb=bb(ja.getItem(ib));gb=!fb;break;}}if(gb)ab();}this._logFantail('using session id: '+qa.sessionID+(fb?' [restored]':' [new]')+' with sticky:'+qa.sticky_token+"/"+qa.sticky_pool,k.FANTAIL_INFO);ra.enabled=!!qa.watchdog_enabled;qa.watchdog=ra;if(typeof ca!='undefined'){ca.subscribe((function(){qa.userActive=Date.now();n.sendActivePing(qa);}).bind(this));}else ma.error('user_activity_undefined');w.register('ch',wa);var jb=this.getConfig('max_conn',2);qa.subdomain=m.allocate(jb);this._transportRate=new v(30000);var kb=h.supportsCORS()&&!qa.forceIframe?'CORSTransport':'IframeTransport';this.transport=new n[kb](this);if(db)this.enterState.apply(this,arguments);i.subscribe(t.DUMP_EVENT,(function(event,mb){mb.transportRate=this._transportRate.tally();mb.transportType=kb;mb.transportVersion=2;}).bind(this));xa();ya();if(la.getConfig('tryStreaming')&&la.getConfig('host')&&h.supportsCORS()&&!qa.forceIframe){var lb=qa.MIN_INIT_PROBE_DELAY+Math.random()*qa.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ia(this._probeTest,lb);}},configure:function(){var db=fa(arguments);ma.log('configure',db);db.forEach(function(eb){return Object.assign(qa,eb);});i.inform(k.ON_CONFIG,this);},getConfig:function(db,eb){return db in qa?qa[db]:eb;},getCompleteConfig:function(){return qa;},getWatchdog:function(){return ra;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(aa.isPageOwner()&&aa.isOnline());},_sendIframeError:function(db){var eb=new j().setURI('/ajax/presence/reconnect.php').setData({reason:db,fb_dtsg:p.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);eb.specifiesWriteRequiredParams()&&eb.send();},_getDelay:function(){var db=Math.min(qa.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ua-1)),qa.MAX_RETRY_INTERVAL);if(this.proxyDown&&'proxy_down_delay_millis' in qa)db=qa.proxy_down_delay_millis;this.proxyDown=false;return Math.floor(db*(1+Math.random()*.5));},enterState:function(){if(this._inEnterState)ma.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(db){this._inEnterState=false;throw db;}},_enterState:function(db){if((db.indexOf('pull')===0||db.indexOf('ping')===0||db.indexOf('shutdown')===0)&&!!qa.active_config_refresh){var eb=Date.now(),fb=(eb-qa.reconnectOverrideTimeMillis)/1000;if('config_refresh_seconds' in qa&&qa.config_refresh_seconds>0&&fb>qa.config_refresh_seconds){db='reconnect';this._logFantail('forcing reconnect to refresh config'+' - this is normal behavior',k.FANTAIL_DEBUG);}}if(db.indexOf('reconnect')===0)qa.reconnectOverrideTimeMillis=Date.now();var gb=this.backoff?this._getDelay():0;this.backoff=false;var hb=fa(arguments);if(this.isShutdown()){this._logFantail('not executing state due to shutdown mode: '+db,k.FANTAIL_WARN);return;}if(db!='idle!'&&this.shouldIdle()){this._logFantail('forced idleness',k.FANTAIL_WARN);return;}sa++;qa.stateId=sa;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(db)){var ib=this._transportRate.tally().timeAverage,jb=la.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ib>=jb){if(!this._throttled){this._throttled=true;ma.warn('throttled');}ma.bump('throttle');gb=1000/jb;}}else if(!(/#$/.test(db)))gb=this._getDelay();db=db.replace(/\W*$/,'');if(!pa[db]){this._logFantail('invalid state: '+db,k.FANTAIL_ERROR);throw new Error('invalid state:'+db);}var kb;if(gb<=0){kb={state:db};this._transportRate.add(1);this.state=db;var lb=this['_enter_'+this.state];if(lb){hb.shift();lb.apply(this,hb);}if(/init|idle|pull|ping/.test(this.state)){if(qa.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];ra.transportEnteredState(db);ra.clientEnteredState(db);qa.is_offline=!o.isOnline();qa.capabilities=da.getCapabilities();this._logFantail('entering transport state: '+this.state,k.FANTAIL_INFO);this.transport.enterState(this.state,qa);if(this.state=='ping'){kb.url=n.getURI(qa).toString();kb.port=qa.port||'undefined';}}}else{this.state='idle';this.nextState=db;kb={state:this.state,delay:gb,nextState:db};hb[0]=db+'#';this._deferredTransition=ia((function(){this._deferredTransition=null;this.enterState.apply(this,hb);}).bind(this),gb);}if(/pull/.test(db)){kb.client_id=qa.sessionID;kb.streaming=qa.inStreaming;}ma.log('enter_'+this.state,kb);i.inform(k.ON_ENTER_STATE,kb);},exitState:function(db,eb){var fb=db.stateId,gb=db.status;if((gb==k.SYS_TIMETRAVEL||gb==k.SYS_ONLINE||gb==k.SYS_NONOWNER||gb==k.SYS_OWNER)&&ra)ra.initialize();if(this.isShutdown()||fb<sa)return;var hb=fa(arguments),ib=this.state;hb[0]=db.status;var jb={state:ib,status:gb};if(/pull/.test(ib)){jb.client_id=qa.sessionID;jb.streaming=qa.inStreaming;}if(/ping/.test(ib)&&gb!=k.OK)jb.url=n.getURI(qa).toString();if(this.nextState)jb.nextState=this.nextState;if(eb&&eb.errorType){qa.lastRequestErrorReason=eb.errorType;jb.xhr=eb.toJSON?eb.toJSON():eb;if(eb.errorType==h.SERVICE_UNAVAILABLE){this._logFantail('got 5xx http status code, setting long delay',k.FANTAIL_ERROR);this.proxyDown=true;}delete jb.xhr.json;}else if(gb!=k.OK)qa.lastRequestErrorReason=gb;if(eb&&eb.json){if(eb.json.t)jb.t=eb.json.t;if(eb.json.reason)jb.reason=eb.json.reason;if(eb.json.seq)jb.seq=eb.json.seq;}ma.log('exit_'+ib,jb);i.inform(k.ON_EXIT_STATE,jb);var kb=this['_exit_'+ib];if(kb)gb=kb.apply(this,hb)||gb;if(gb!=k.OK){za();ta[ib]=(ta[ib]||0)+1;}var lb=pa[this.nextState||ib][gb]||pa._all[gb],mb=lb&&lb.replace(/!*$/,'');if(!mb){ma.error('terminal_transition',jb);this._shutdownHint=k.HINT_INVALID_STATE;lb='shutdown!';this._logFantail('entering shutdown state',k.FANTAIL_ERROR);}this._lastState=ib;this._lastStatus=gb;this.enterState(lb);},_processTransportData:function(db,eb){var fb=eb.json,gb=fb.t;if('s' in fb){fb.seq=fb.s;delete fb.s;}if(fb.u&&qa.user&&fb.u!=qa.user){ma.warn('misguided_msg',{user:qa.user,target:fb.u});this._reportProxyMisguidedMsg(fb.u,qa.user);return;}var hb=qa.seq;if('seq' in fb){qa.seq=fb.seq;x.doSync();}switch(gb){case 'continue':if(qa.inStreaming&&this.heartbeats.length<1){qa.streamingCapable=false;ma.log('switch_to_longpoll');ia(this._probeTest,qa.PROBE_DELAY);}za(true);if(!qa.inStreaming||qa.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:k.OK,stateId:db});break;case 'refresh':case 'refreshDelay':this._logFantail('got refresh with reason: '+fb.reason,k.FANTAIL_INFO);this.exitState({status:'refresh_'+(fb.reason||0),stateId:db},eb);break;case 'backoff':this._logFantail('server told client to back off',k.FANTAIL_WARN);za();this.backoff=true;break;case 'lb':var ib=fb.lb_info;if(ib){qa.sticky_token=ib.sticky;if('pool' in ib){qa.sticky_pool=ib.pool;}else qa.host=ib.vip;if(h.supportsCORS()&&!qa.forceIframe){var jb=qa.subdomain===null?qa.host:qa.subdomain+'-'+qa.host,kb=new ea(jb,qa.port,qa.sticky_pool,qa.sticky_token,qa.uid,qa.viewer_uid,qa.profile,qa.sessionID,qa.capabilities);i.inform(k.RTI_SESSION,kb);}}else ma.error('bad lb info');break;case 'test_streaming':ia(this._probeTest,500);break;case 'fullReload':w.clear();ma.log('invalid_history');i.inform(k.ON_INVALID_HISTORY);za(true);this._logFantail('full reload incurred',k.FANTAIL_INFO);var lb=k.ERROR_MISSING;if(qa.fullReloadAsSuccess)lb=k.OK;this.exitState({status:lb,stateId:db},eb);break;case 'msg':var mb,nb,ob,pb;za(true);if('tr' in fb)qa.trace_id=fb.tr;nb=fb.ms;ob=qa.seq-nb.length;for(mb=0;mb<nb.length;mb++,ob++){qa.estimatedReceived++;if(ob>=hb){pb=nb[mb];if(pb.type){var qb=k.getArbiterType(pb.type);if(pb.type==='messaging'){var rb={type:'messaging',event:pb.event};if(pb.message){rb.inbox_unread=pb.unread_counts&&pb.unread_counts.inbox;rb.tid=pb.message.tid;rb.mid=pb.message.mid;this._logFantail('got message with id: '+pb.message.mid,k.FANTAIL_INFO);}ma.debug('message',rb);}else if(pb.type==='pages_messaging'){if(pb.unread_counts&&pb.unread_counts.inbox)i.inform(k.getArbiterType('pages_inbox_count_update'),{page_id:pb[u.VIEWER_FBID],inbox_unread:pb.unread_counts.inbox});}else if(pb.type==='skywalker'){qb=k.SKYWALKER;}else ma.debug('message',{type:pb.type});i.inform(qb,{obj:pb});}}else ma.warn('seq_regression',{seq:ob,last_seq:hb,messages:nb.length});}break;case 'heartbeat':if(qa.inStreaming){var sb=Date.now();if(this.heartbeats.length>0){var tb=sb-this.heartbeats[this.heartbeats.length-1];ma.log('heartbeat_interval',{client_id:qa.sessionID,interval:tb});}this.heartbeats.push(sb);}break;default:this._logFantail('got an unknown protocol message: '+gb,k.FANTAIL_ERROR);ma.error('unknown_msg_type',{type:gb});break;}ab();},_enter_init:function(){if(ta.init>=la.getConfig('MAX_INIT_FAILS',2))return setTimeout(this.exitState.bind(this,{status:k.ERROR_MAX,stateId:sa}),0);this._initTimer=ia(this.exitState.bind(this,{status:k.ERROR,stateId:sa},'timeout'),qa.IFRAME_LOAD_TIMEOUT);},_enter_reconnect:function(db){this._logFantail('entered reconnect with reason: '+db,k.FANTAIL_INFO);var eb=sa;if(!y.hasUserCookie()){this._logFantail('user has no cookie???',k.FANTAIL_WARN);ma.warn('no_user_cookie');setTimeout(function(){la._shutdownHint=k.HINT_AUTH;la.exitState({status:k.ERROR_SHUTDOWN,stateId:eb});},0);return;}var fb={reason:db,fb_dtsg:p.getToken()};if(s.token)fb.fb_isb=s.token;if(na)na(fb);var gb=new r('GET','/ajax/presence/reconnect.php',fb);gb.onSuccess=(function(){la.configure(gb.json);w.store();this.exitState({status:k.OK,stateId:eb});}).bind(this);gb.onError=(function(){var hb=gb.json&&gb.json.error;this._logFantail('reconnect error: '+gb.errorType,k.FANTAIL_ERROR);if(gb.errorType==h.TRANSPORT_ERROR||gb.errorType==h.PROXY_ERROR||gb.errorType==h.SERVICE_UNAVAILABLE)this._shutdownHint=k.HINT_CONN;if(hb&&hb==1356007){this._shutdownHint=k.HINT_MAINT;}else if(hb==1357001||hb==1357004||hb==1348009){this._shutdownHint=k.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?k.ERROR_SHUTDOWN:k.ERROR,stateId:eb},gb);}).bind(this);gb.send();},_enter_shutdown:function(){i.inform(k.ON_SHUTDOWN,{reason:this._shutdownHint});if(!!qa.shutdown_recovery_enabled&&'shutdown_recovery_interval_seconds' in qa&&qa.shutdown_recovery_interval_seconds>0){var db=qa.shutdown_recovery_interval_seconds*1000;ia((function(){i.inform(k.ATTEMPT_RECONNECT);this.state='reconnect!';this.enterState('reconnect!');}).bind(this),db);}},_exit_init:function(db){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(db==k.ERROR_MAX)this._sendIframeError(k.reason_IFrameLoadGiveUp);},_exit_pull:function(db,eb){var fb=db==k.OK;ra.reportPullReturned(fb,this);if(fb){this.lastPullTime=Date.now();}else{var gb="exit status: "+db;if(eb&&eb.errorType)gb+=" ajax request error: "+eb.errorType;this._logFantail('pull failed with status: '+gb,k.FANTAIL_ERROR);}},_exit_ping:function(db){if(db==k.OK){var eb=Date.now()-(this.lastPullTime||q.start);if(eb>qa.STALL_THRESHOLD){this._logFantail('didnt complete a successful pull for too long',k.FANTAIL_ERROR);return k.ERROR_STALE;}}else this._logFantail('ping failed with status: '+db,k.FANTAIL_ERROR);},_reportProxyMisguidedMsg:function(db,eb){this._logFantail('misguided message to '+eb+' meant for '+db,k.FANTAIL_ERROR);var fb=Date.now();if(fb-this.lastReportOnMisguidedMsgTime<=qa.CHANNEL_PROXY_REPORTING_MIN_INTERVAL)return;this.lastReportOnMisguidedMsgTime=fb;var gb={received_uid:db,expected_uid:eb};if(qa.sticky_token)gb.sticky_token=qa.sticky_token;var hb=new ba('/err_misguided_msg').setDomain(qa.host+'.'+qa.domain).setPort(qa.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(gb),ib=new h('GET',hb);if(h.supportsCORS())ib.xhr.withCredentials=true;ib.onSuccess=function(jb){};ib.onError=function(jb){};ib.onJSON=function(jb,kb){};ib.send();},_probeTest:function(){qa.streamingCapable=false;var db=[],eb={mode:'stream',format:'json'};if(qa.sticky_token)eb.sticky_token=qa.sticky_token;var fb=new ba('/probe').setDomain(qa.host+'.'+qa.domain).setPort(qa.port).setSecure(new ba(window.location.href).isSecure()).setQueryData(eb),gb=new h('GET',fb);gb.onJSON=function(hb,ib){if(hb&&hb.json&&hb.json.t==='heartbeat'){db.push(Date.now());if(db.length>=2){var jb=db[1]-db[0];if(jb>=qa.PROBE_HEARTBEATS_INTERVAL_LOW&&jb<=qa.PROBE_HEARTBEATS_INTERVAL_HIGH){qa.streamingCapable=true;ma.log('switch_to_streaming');}ma.log('probe_ok',{time:jb});}}};gb.onSuccess=function(hb){if(db.length!=2){qa.streamingCapable=false;ma.error('probe_error',{error:'beats.length = '+db.length});}};gb.onError=function(hb){qa.streamingCapable=false;ma.error('probe_error',hb);};ma.log('probe_request');gb.send();},_logFantail:function(db,eb){var fb=qa.fantail_queue_capacity||qa.FANTAIL_QUEUE_CAPACITY;if(!qa.fantail_enabled||qa.fantail_logs.length>fb)return;var gb='fantail queue size exceeded',hb=k.FANTAIL_WARN;if(qa.fantail_logs.length<fb){gb=db;hb=eb;}var ib=qa.fantail_logs.length,jb={};jb['time'+ib]=Date.now();jb['log'+ib]=gb;jb['severity'+ib]=hb;qa.fantail_logs.push(jb);}};f.exports=la;function cb(){if(l.channelConfig){la.configure(l.channelConfig);if(/shutdown/.test(l.state))la._shutdownHint=k[l.reason];la.init(l.state,l.reason);}}if(l.channelConfig&&l.channelConfig.fullReloadAsSuccess){cb();}else z.onAfterLoad(cb);},null);
__d('ChannelConnection',['Arbiter','Run','SystemEvents','ChannelConstants','ChannelManager','JSLogger','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=Object.assign(new h(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});i.onBeforeUnload(function(){});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ca){v();q=n(w,ca);o.log('mute_warning',{time:ca});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ca,da){y();if(ca===k.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var ea=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:ea});}}else if(ca===k.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||!da.nextState&&da.state==='idle')){r=n(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=da.delay||0;o.log('reconnecting',{delay:fa});if(u.disconnected())o.log('reconnecting_ui',{delay:fa});s=u.RECONNECTING;da.state==='idle'&&t++;if(t>1){u.inform(u.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')z(ca,da);},500);}else if(ca===k.ON_SHUTDOWN){o.log('shutdown',{reason:da.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,da.reason);}}function aa(){if(l.isShutdown()){z(k.ON_SHUTDOWN,l._shutdownHint);}else z(k.ON_ENTER_STATE,{state:l.state,nextState:l.nextState,delay:0});}i.onAfterLoad(aa);Object.assign(u,{disconnected:function(){return s===u.SHUTDOWN||s===u.RECONNECTING&&!q&&t>1;},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:function(ca){if(l.state==='ping'||l.isShutdown())return;o.log('reconnect',{now:ca});u.inform(u.RECONNECTING,0);if(!!ca){if(p!==null){clearTimeout(p);p=null;}l.enterState('ping!');}else if(!p)p=n(function(){l.enterState('ping!');p=null;},k.CHANNEL_MANUAL_RECONNECT_DEFER_MSEC);},unmuteWarning:w});function ba(){h.subscribe([k.ON_ENTER_STATE,k.ON_SHUTDOWN],z);h.subscribe(k.ATTEMPT_RECONNECT,function(){if(u.disconnected())u.reconnect();});j.subscribe(j.TIME_TRAVEL,function(){u.reconnect();x(k.MUTE_WARNING_TIME_MSEC);});i.onBeforeUnload(y,false);}i.onAfterLoad(ba);u.mockAfterLoad=function(){aa();ba();};f.exports=u;},null);
__d('ChatproxyLastMobileActiveTimes',['ServerTime','fbt'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={};function k(o){if(!o||o<0)return '';var p=h.get()/1000-o,q=Math.floor(p/60),r=Math.floor(q/60),s=Math.floor(r/24);if(q<=1){return i._("{count}m",[i.param('count',1)]);}else if(q<60){return i._("{count}m",[i.param('count',q)]);}else if(r<24){return i._("{count}h",[i.param('count',r)]);}else if(s<3){return i._("{count}d",[i.param('count',s)]);}else return '';}function l(o,p){if(!(o in j)||j[o]<p)j[o]=p;}function m(o){if(o in j){return j[o];}else return 0;}var n={update:function(o){for(var p in o)l(p,o[p]);},getShortDisplay:function(o){return k(m(o));},get:function(o){return m(o);},getDebugData:function(){return j;}};f.exports=n;},null);
__d('ChatproxyPresenceStatus',['ArbiterMixin','AvailableListConstants','BanzaiODS','ChatVisibility','CurrentUser','ChatproxyLastMobileActiveTimes','LogHistory','PresencePrivacy','ServerTime','createObjectFrom','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();j.setEntitySample('presence',.0001);var s=n.getInstance('presence_status'),t={},u={},v={},w={},x={},y={},z={},aa=Object.assign({},h),ba=r(function(){return aa.inform('change');},0);Object.assign(aa,{resetPresenceData:function(){u={};v={};z={};y={};x={};},reset:function(){aa.resetPresenceData();w={};},get:function(ca){if(ca==l.getID())return k.isOnline()?i.ACTIVE:i.OFFLINE;var da=i.OFFLINE;if(ca in u)da=u[ca];if(da===i.OFFLINE||da===i.IDLE)if(w[ca])da=i.MOBILE;if(!o.allows(ca))da=i.OFFLINE;return da;},getCapabilities:function(ca){var da=aa.get(ca);if(da==i.OFFLINE)return 0;var ea=v[ca];return ea?ea:0;},getDetailedActivePresence:function(ca){var da=z[ca];if(!da)return i.ACTIVE_ON_WEB;var ea=this._getDetailedActivePresenceFromObject(da);if(ea)return ea;if(!t[ca]){s.error('inconsistent_presence',{id:ca,presence:aa.getDebugInfo(ca)});j.bumpEntityKey('presence','inconsistent_presence');t[ca]=true;}return null;},_getDetailedActivePresenceFromObject:function(ca){var da=ca[i.WEB_STATUS],ea=ca[i.FB_APP_STATUS],fa=ca[i.MESSENGER_STATUS],ga=ca[i.OTHER_STATUS];if(ea===i.STATUS_ACTIVE||fa===i.STATUS_ACTIVE){return i.ACTIVE_ON_MOBILE;}else if(da===i.STATUS_ACTIVE||ga===i.STATUS_ACTIVE)return i.ACTIVE_ON_WEB;},isMessengerUser:function(ca){var da=z[ca];if(da)if(da[i.MESSENGER_STATUS]==i.STATUS_ACTIVE)return true;return w[ca];},hasDetailedPresenceData:function(ca){return z[ca]!=null;},getGroup:function(ca){return ca.some(function(da){if(da==l.getID())return false;return aa.get(da)===i.ACTIVE;})?i.ACTIVE:i.OFFLINE;},set:function(ca,da,ea,fa,ga,ha){if(ca==l.getID())return false;switch(da){case i.OFFLINE:case i.IDLE:case i.ACTIVE:case i.MOBILE:break;default:return false;}var ia=aa.get(ca),ja=ia!=da;if(ja&&ia==i.ACTIVE||da==i.ACTIVE){var ka={};ka[ca]=p.get()/1000;m.update(ka);}var la=false;if(!ja&&ga)la=aa.getCapabilities(ca)!=ga;if(ea){x[ca]=p.get();y[ca]=fa;}u[ca]=da;if(ga)v[ca]=ga;if(ha)z[ca]=ha;var ma=ja||la;if(ma)ba();return ma;},setMobileFriends:function(ca){w=q(ca);},getOnlineIDs:function(){var ca,da=[];for(ca in u)if(aa.get(ca)===i.ACTIVE)da.push(ca);return da;},getAvailableIDs:function(){var ca=aa.getOnlineIDs(),da;for(da in w){if(u[da])continue;ca.push(da);}return ca;},getOnlineCount:function(){return aa.getOnlineIDs().length;},getPresenceStats:function(){var ca=0,da=0,ea=0,fa=0,ga=0;for(var ha in u){ca+=1;switch(aa.get(ha)){case i.OFFLINE:da+=1;break;case i.IDLE:ea+=1;break;case i.ACTIVE:fa+=1;break;case i.MOBILE:ga+=1;break;default:break;}}return {total:ca,offline:da,idle:ea,active:fa,mobile:ga};},getDebugInfo:function(ca){return {id:ca,presence:u[ca],detailedPresence:z[ca],overlaySource:y[ca],overlayTime:x[ca],mobile:w[ca]};},getAllDebugInfo:function(){return {presence:u,detailedPresence:z,overlaySource:y,overlayTime:x,mobile:w};}});f.exports=aa;},null);
__d('ComparePresence',['ChatproxyPresenceStatus','PresenceStatus','LastMobileActiveTimes','ChatproxyLastMobileActiveTimes','BanzaiODS'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m={compareCpWithPp:function(){var n=i.getAllDebugInfo(),o=h.getAllDebugInfo(),p=0,q=0,r=0;for(var s in o.presence){if(n.presence[s]!==o.presence[s]&&o.presence[s]!==0){p++;l.bumpEntityKey('diff_presence_data','diff');}else l.bumpEntityKey('diff_presence_data','same');if(i.getDetailedActivePresence(s)!==h.getDetailedActivePresence(s)){q++;l.bumpEntityKey('diff_detailed_presence_data','diff');}else l.bumpEntityKey('diff_detailed_presence_data','same');if(i.getCapabilities(s)!==h.getCapabilities(s)){r++;l.bumpEntityKey('diff_capability','diff');}else l.bumpEntityKey('diff_capability','same');}this._compareLastActiveTime();},_compareLastActiveTime:function(){var n=j.getDebugData(),o=k.getDebugData(),p=0,q=0,r=0;for(var s in o)if(s in n){var t=Math.abs(o[s]-n[s]);p+=t;q++;var u=o[s]-n[s];r+=u;if(t>60){l.bumpEntityKey('diff_last_active_time','diff');}else l.bumpEntityKey('diff_last_active_time','same');}else l.bumpEntityKey('diff_last_active_time','diff');l.bumpEntityKey('diff_last_active_time','sum_diff',p);l.bumpEntityKey('diff_last_active_time','sum_diff_cp_pp',r);l.bumpEntityKey('diff_last_active_time','num_of_id',q);l.bumpEntityKey('diff_last_active_time','num_of_push');}};f.exports=m;},null);
__d('ChatproxyPresence',['Arbiter','AvailableListConstants','ChannelConstants','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes','CurrentUser','ComparePresence','AvailableListInitialData','PresenceStatus','LastMobileActiveTimes'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();function r(s){'use strict';this.$ChatproxyPresence1=s;}r.prototype.subscribe=function(){'use strict';h.subscribe(j.getArbiterType('chatproxy-presence'),this.updatePresenceInfo.bind(this));};r.prototype.updatePresenceInfo=function(s,t){'use strict';k.resetPresenceData();var u={};t=t.obj;for(var v in t){if(v===m.getID()||v==='type')continue;var w=0;switch(t[v].p){case 0:w=i.OFFLINE;break;case 1:w=i.ACTIVE;break;case 2:w=i.IDLE;}var x=0;if(t[v].vc)x=t[v].vc;var y=null;if(t[v].dcp)y=this.updateDetailedPresence(t[v].dcp);if(t[v].lat)u[v]=t[v].lat;if(o.gk_replace_available_list_chatproxy)p.set(v,w,false,'chatproxy',x,y);k.set(v,w,false,'chatproxy',x,y);}if(o.gk_replace_available_list_chatproxy)q.update(u);l.update(u);n.compareCpWithPp();};r.prototype.updateDetailedPresence=function(s){'use strict';var t={};if((s&8)!==0){t[i.MESSENGER_STATUS]=i.STATUS_ACTIVE;}else t[i.MESSENGER_STATUS]=i.STATUS_OFFLINE;if((s&4)!==0){t[i.FB_APP_STATUS]=i.STATUS_ACTIVE;}else t[i.FB_APP_STATUS]=i.STATUS_OFFLINE;if((s&2)!==0){t[i.WEB_STATUS]=i.STATUS_ACTIVE;}else t[i.WEB_STATUS]=i.STATUS_OFFLINE;if((s&1)!==0){t[i.OTHER_STATUS]=i.STATUS_ACTIVE;}else t[i.OTHER_STATUS]=i.STATUS_OFFLINE;return t;};f.exports=r;},null);
__d('ChatContexts',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};function i(l){var m=l?l.subtext:'';return m;}function j(l,m){h[l]=m;}var k={get:function(l){if(l in h){return h[l];}else return null;},update:function(l){for(var m in l)j(m,l[m]);},getShortDisplay:function(l){return i(k.get(l));}};f.exports=k;},null);
__d('PresencePoller',['AvailableListConstants','AvailableListInitialData','BanzaiODS','ChannelConnection','ChatContexts','ChatVisibility','CurrentUser','JSLogger','LastMobileActiveTimes','Poller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','UserActivity','debounceAcrossTransitions','errorCode'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y=Object.assign||function(ia){for(var ja=1;ja<arguments.length;ja++){var ka=arguments[ja];for(var la in ka)if(Object.prototype.hasOwnProperty.call(ka,la))ia[la]=ka[la];}return ia;},z=5,aa='/ajax/chat/buddy_list.php',ba=1800000,ca=i.pollInterval,da=i.lazyPollInterval,ea=i.lazyThreshold,fa=o.create('available_list'),ga='presence_poller';j.setEntitySample(ga,.01);function ha(ia){'use strict';this.$PresencePoller1=ia;this.$PresencePoller2=false;this.$PresencePoller3=i.chatNotif;this.$PresencePoller4=false;this.$PresencePoller5=[];this.$PresencePoller6=new q({interval:ca,setupRequest:this.$PresencePoller7.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(m.isOnline()){this.$PresencePoller8=Date.now();this.$PresencePoller9=Date.now();this.$PresencePoller10=Date.now();this.$PresencePoller11=i.updateTime;}else{this.$PresencePoller8=0;this.$PresencePoller11=0;this.$PresencePoller9=0;this.$PresencePoller10=0;}this.$PresencePoller12=0;this.$PresencePoller13('available_initial_data',i.updateTime,i.availableList,i.lastActiveTimes,i.mobileFriends);v.subscribe((function(ja,ka){if(ka.idleness>ca)this.forceUpdate();}).bind(this));r.subscribe('privacy-user-presence-changed',(function(){this.forceUpdate();}).bind(this));}ha.prototype.start=function(){'use strict';setTimeout(this.$PresencePoller6.start.bind(this.$PresencePoller6),0);};ha.prototype.restart=function(){'use strict';if(this.$PresencePoller6.isMuted()){this.$PresencePoller6.resume();this.forceUpdate();}};ha.prototype.stop=function(){'use strict';this.$PresencePoller6.mute();};ha.prototype.forceUpdate=function(){'use strict';this.$PresencePoller4=true;this.$PresencePoller6.request();};ha.prototype.getIsUserIdle=function(){'use strict';return this.$PresencePoller2;};ha.prototype.getWebChatNotification=function(){'use strict';return this.$PresencePoller3;};ha.prototype.getCallback=function(){'use strict';return this.$PresencePoller1;};ha.prototype.addExtraBuddy=function(ia){'use strict';if(this.$PresencePoller5.indexOf(ia)!==-1)return;this.$PresencePoller5.push(ia);};ha.prototype.$PresencePoller14=function(){'use strict';return w((function(){this.$PresencePoller1(h.ON_AVAILABILITY_CHANGED);}).bind(this),0)();};ha.prototype.$PresencePoller13=function(ia,ja,ka,la,ma){'use strict';this.$PresencePoller11=ja;if(!i.gk_replace_available_list_chatproxy||Object.keys(ka).length!=0)if(!Array.isArray(ka)){s.resetPresenceData();for(var na in ka)s.set(na,ka[na].a,false,ia,ka[na].c,ka[na].p);}if(la&&!Array.isArray(la))p.update(la);if(ma)s.setMobileFriends(ma);this.$PresencePoller14();};ha.prototype.$PresencePoller7=function(ia){'use strict';if(k.isShutdown()||!m.isOnline()){this.$PresencePoller6.skip();j.bumpEntityKey(ga,'skip.offline');return;}if(Date.now()-this.$PresencePoller8<ca){this.$PresencePoller6.skip();j.bumpEntityKey(ga,'skip.recent');return;}j.bumpEntityKey(ga,'request');this.$PresencePoller8=Date.now();var ja=Date.now()-this.$PresencePoller10,ka=u.getCachedProfileIDs().join(","),la=true;if(i.gk_replace_available_list_chatproxy&&!this.$PresencePoller4&&this.$PresencePoller5.length===0)la=false;this.$PresencePoller4=false;ia.setHandler(this.$PresencePoller15.bind(this)).setErrorHandler(this.$PresencePoller16.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:n.getID(),cached_user_info_ids:ka,fetch_mobile:ja>ba,additional_buddies:this.$PresencePoller5,get_now_available_list:la}).setURI(aa).setAllowCrossPageTransition(true);};ha.prototype.$PresencePoller15=function(ia){'use strict';var ja=ia.getPayload(),ka=ja.buddy_list;if(!ka){this.$PresencePoller16(ia);return;}j.bumpEntityKey(ga,'response');this.$PresencePoller17();this.$PresencePoller9=Date.now();t.update(ja.time);if(ka.mobile_friends)this.$PresencePoller10=Date.now();this.$PresencePoller12=0;this.$PresencePoller18();var la=ka.userInfos;if(la)u.setMulti(la);var ma=ka.chatContexts;ma&&l.update(ma);this.$PresencePoller2=ka.userIsIdle;if(ka.chatNotif!==undefined&&ka.chatNotif!==this.$PresencePoller3){this.$PresencePoller3=ka.chatNotif;this.$PresencePoller1(h.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller3);}this.$PresencePoller13('buddy_list_poller',ja.time,ka.nowAvailableList,ka.last_active_times,ka.mobile_friends);};ha.prototype.$PresencePoller16=function(ia){'use strict';j.bumpEntityKey(ga,'error');if(ia.getError()==1356007)return;this.$PresencePoller12++;if(this.$PresencePoller12>=z)this.$PresencePoller1(h.ON_UPDATE_ERROR);};ha.prototype.$PresencePoller18=function(){'use strict';var ia=v.isActive(ea)?ca:da;j.bumpEntityKey(ga,'period.'+ia);this.$PresencePoller6.setInterval(ia);};ha.prototype.$PresencePoller17=function(){'use strict';var ia=Date.now(),ja=ia-this.$PresencePoller9;fa.log('buddylist_presence_stats',y({duration:ja},s.getPresenceStats()));};f.exports=ha;},null);
__d("TypingStates",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={INACTIVE:0,TYPING:1,QUITTING:2};f.exports=h;},null);
__d('AvailableList',['Arbiter','ArbiterMixin','AsyncRequest','AvailableListConstants','BanzaiODS','ChannelConnection','ChannelConstants','ChatConfig','ChatVisibility','ErrorUtils','JSLogger','LastMobileActiveTimes','PresencePoller','PresencePrivacy','PresenceStatus','ServerTime','ShortProfiles','TypingStates','debounceAcrossTransitions','emptyFunction','AvailableListInitialData','ChatproxyPresence','ChatproxyPresenceStatus','ChatproxyLastMobileActiveTimes'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){if(c.__markCompiled)c.__markCompiled();'use strict';var fa=Object.assign||function(sa){for(var ta=1;ta<arguments.length;ta++){var ua=arguments[ta];for(var va in ua)if(Object.prototype.hasOwnProperty.call(ua,va))sa[va]=ua[va];}return sa;};l.setEntitySample('presence',.0001);var ga=fa({},k,i);ga.subscribe([k.ON_AVAILABILITY_CHANGED,k.ON_UPDATE_ERROR],function(sa,ta){h.inform(sa,ta);});var ha=z(function(){return ga.inform(k.ON_AVAILABILITY_CHANGED);},0);function ia(sa,ta,ua,va,wa,xa){var ya=v.set(sa,ta,ua,va,wa,xa);if(qa)da.set(sa,ta,ua,va,wa,xa);if(ya){var za=z(function(){return ga.inform(k.ON_AVAILABILITY_CHANGED,sa);},0);za();}}function ja(sa){var ta=sa.payload.availability||{};for(var ua in ta)ia(ua&&ua.toString(),ta[ua].a,true,'mercury_tabs',ta[ua].c,ta[ua].p);}function ka(){oa&&oa.restart();}function la(){oa&&oa.stop();}function ma(sa){var ta=ga.getDebugInfo(sa),ua=ta.presence==k.ACTIVE;new j('/ajax/mercury/tabs_presence.php').setData({target_id:sa,to_online:ua,presence_source:ta.overlaySource,presence_time:ta.overlayTime}).setHandler(ja).setErrorHandler(aa).setAllowCrossPageTransition(true).send();}function na(sa,ta){ta.chat_config=o.getDebugInfo();ta.available_list_debug_info={};v.getAvailableIDs().forEach(function(ua){ta.available_list_debug_info[ua]=ga.getDebugInfo(ua);});ta.available_list_poll_interval=ga._poller&&ga._poller.getInterval();}var oa;try{oa=new t(function(event){ga.inform(event);});}catch(pa){q.reportError&&q.reportError(pa,false);}var qa=ba.gk_chatproxy_presence;if(qa){var ra;try{ra=new ca(function(event){ga.inform(event);});}catch(pa){q.reportError&&q.reportError(pa,false);}ra&&ra.subscribe();}Object.assign(ga,{get:function(sa){return v.get(sa);},updateForID:function(sa){ma(sa);oa&&oa.addExtraBuddy(sa);},shouldUpdateForID:function(sa){if(o.get('avoid_available_list_updates',false))return v.getCapabilities(sa)===0;return true;},getWebChatNotification:function(){return oa&&oa.getWebChatNotification&&oa.getWebChatNotification();},isUserIdle:function(){return oa&&oa.getIsUserIdle();},isReady:function(){return !!oa;},set:function(sa,ta,ua,va,wa){ia(sa,ta,true,ua,va,wa);},update:function(){oa&&oa.forceUpdate();},isIdle:function(sa){return ga.get(sa)==k.IDLE;},getDebugInfo:function(sa){var ta=v.getDebugInfo(sa),ua=x.getNow(sa);if(ua)ta.name=ua.name;return ta;}});oa&&oa.start();h.subscribe(r.DUMP_EVENT,na);h.subscribe('chat-visibility/go-online',ka);h.subscribe('chat-visibility/go-offline',la);u.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],ha);m.subscribe([m.CONNECTED,m.RECONNECTING,m.SHUTDOWN,m.MUTE_WARNING,m.UNMUTE_WARNING],ha);h.subscribe(n.getArbiterType('buddylist_overlay'),function(sa,ta){var ua={},va=ta.obj.overlay;for(var wa in va){ga.set(wa,va[wa].a,va[wa].s||'channel',va[wa].vc,va[wa].p);if(va[wa].la)ua[wa]=va[wa].la;}s.update(ua);if(qa)ea.update(ua);});h.subscribe([n.getArbiterType('typ'),n.getArbiterType('ttyp')],function(sa,ta){var ua=ta.obj;if(ua.st===y.TYPING){var va=ua.from;if(p.isOnline()){l.bumpEntityKey('presence','stale_presence_check_typing');var wa=v.get(va);if(wa!=k.ACTIVE){var xa=s.get(va)*1000,ya=w.get();if(!xa){l.bumpEntityKey('presence','no_detailed_presence_typing');}else if(ya-xa>5*60*1000){var za='stale_presence_typing',ab=ya-xa;if(ab<10*60*1000){za+='600';}else if(ab<60*60*1000)za+='3600';l.bumpEntityKey('presence',za);}}}ga.set(va&&va.toString(),k.ACTIVE,'channel-typing');}});h.subscribe(n.getArbiterType('messaging'),function(sa,ta){if(!p.isOnline())return;var ua=ta.obj;if(ua.message&&ua.message.timestamp&&ua.message.sender_fbid){var va=w.get(),wa=ua.message.timestamp;if(va-wa<2*60*1000){l.bumpEntityKey('presence','stale_presence_check');var xa=ua.message.sender_fbid,ya=v.get(xa);if(ya==k.ACTIVE)return;var za=s.get(xa)*1000;if(!za){l.bumpEntityKey('presence','no_detailed_presence');}else if(wa-za>5*60*1000){var ab='stale_presence',bb=wa-za;if(bb<10*60*1000){ab+='600';}else if(bb<60*60*1000)ab+='3600';l.bumpEntityKey('presence',ab);}}}});b.AvailableList=f.exports=ga;},null);
__d('FavIcon',['DOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i,j,k;function l(){var n=h.scry(document.head,"link");if(n)n.forEach(function(o){if(o.rel.indexOf('icon')!=-1||o.rel.indexOf('shortcut icon')!=-1)h.remove(o);});}var m={isToggledResource:function(){if(k&&i.href===k)return true;return false;},set:function(n){if(i)h.remove(i);l();i=h.create('link',{type:'image/x-icon',rel:'icon',href:n});h.appendContent(h.find(document,'head'),i);},setToggleResources:function(n,o){i=document.querySelector('link[rel*=icon][href*=".ico"]');j=o||i.href;k=n;},toggle:function(){if(!i||!k)return;if(i.href===j){this.set(k);return;}this.set(j);}};f.exports=m;},null);