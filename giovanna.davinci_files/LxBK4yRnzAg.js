/*!CK:235248669!*//*1439842535,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["nuZNI"]); }

__d("ChatTypeaheadEvent",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={ABANDONED_QUERY:"abandoned_query",NEW_QUERY:"new_query",RESULT_SELECTED:"result_selected"};},null,{});
__d("StickerConstants",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};},null,{});
__d('ChatDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('ChatSidebarActionTypes',['keyMirror'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=h({INIT:null,LOADED:null,SET_ENABLED:null,SHOW:null,TOGGLE:null});},null);
__d('ChatSidebarStore',['ChatDispatcher','ChatOptionsInitialData','ChatSidebarActionTypes','FluxStore','SidebarType','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=Object.assign||function(r){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u))r[u]=t[u];}return r;},o,p;'use strict';o=k;p=o&&o.prototype;Object.assign(q,o);q.prototype=Object.create(o.prototype);q.prototype.constructor=q;q.__superConstructor__=o;function q(){p.constructor.call(this,h);this.$ChatSidebarStore1={initialized:false,initTime:m(),loaded:false,enabled:!!i.sidebar_mode,visible:null};this.$ChatSidebarStore2={};}q.prototype.__onDispatch=function(r){var s=r.type;this.$ChatSidebarStore2=n({},this.$ChatSidebarStore1);switch(s){case j.INIT:if(!this.$ChatSidebarStore2.initialized)this.$ChatSidebarStore1.initTime=m();this.$ChatSidebarStore1.initialized=true;break;case j.LOADED:this.$ChatSidebarStore1.loaded=true;break;case j.SHOW:this.$ChatSidebarStore1.visible=r.sidebarType;break;case j.SET_ENABLED:this.$ChatSidebarStore1.enabled=r.enabled;this.$ChatSidebarStore1.visible=r.sidebarType;break;case j.TOGGLE:this.$ChatSidebarStore1.enabled=!this.$ChatSidebarStore1.enabled;this.$ChatSidebarStore1.visible=this.$ChatSidebarStore1.enabled?r.visible:l.BUDDYLIST;break;}for(var t in this.$ChatSidebarStore1)if(this.$ChatSidebarStore1.hasOwnProperty(t))if(this.$ChatSidebarStore1[t]!==this.$ChatSidebarStore2[t]){this.__emitChange();break;}};q.prototype.getPrevState=function(){return this.$ChatSidebarStore2;};q.prototype.getState=function(){return this.$ChatSidebarStore1;};q.prototype.isInitialized=function(){return this.$ChatSidebarStore1.initialized;};q.prototype.isLoaded=function(){return this.$ChatSidebarStore1.loaded;};q.prototype.isEnabled=function(){return this.$ChatSidebarStore1.enabled;};q.prototype.getInitTime=function(){return this.$ChatSidebarStore1.initTime;};q.prototype.getVisibleType=function(){return this.$ChatSidebarStore1.visible;};f.exports=new q();},null);
__d('OrderedFriendsList',['AvailableListConstants','PresenceStatus','SearchableEntry','ShortProfiles','WorkModeConfig','createArrayFromMixed','isValidUniqueID','InitialChatFriendsList'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=[],p=[],q={},r=[],s={},t=[],u={contains:function(v){return v in q;},getList:function(){if(l.is_work_user)return m(o);u.reRank();var v=m(o);v=v.filter(function(w){var x=k.getNowUnsafe(w);return !x||x.type=="friend";});return v;},getSearchableEntries:function(v,w){var x=u.getList();k.getMulti(x.slice(0,v),function(y){var z=[];for(var aa in y)z.push(u.normalizeProfileEntry(y[aa]));var ba=u.getGroups().map(u.normalizeThreadEntry);w(z.concat(ba).filter(function(ca){return !!ca;}).sort(function(ca,da){return ca.getOrder()-da.getOrder();}));});},normalizeProfileEntry:function(v){var w=v.searchTokens||[];return new j({uniqueID:v.id,keywordString:w.join(' '),order:u.getRank(v.id),photo:v.thumbSrc,title:v.name,type:v.type,uri:v.uri,auxiliaryData:{isMessengerUser:v.is_messenger_user}});},normalizeThreadEntry:function(v,w){var x=v.mercury_thread,y=v.participants_to_render,z=v.text,aa=null;if(!z)z=x.name;var ba=y.map(function(da){return da.name;}).join(', ');if(!z){z=ba;}else aa=ba;var ca=v.uid;if(!z||!n(ca))return null;return new j({uniqueID:ca,order:w,photo:x.image_src,title:z,subtitle:aa,type:'thread',auxiliaryData:{participantsToRender:y,thread:x}});},getRank:function(v){return v in q?q[v]:o.length;},getActiveList:function(){if(r.length>0)return r;return u.getList();},getActiveRank:function(v){return v in s?s[v]:u.getRank(v);},reRank:function(){o=[];var v=0;t.forEach(function(w){var x=w.slice(0,-2),y=w.slice(-1);if(i.get(x)==y){o[v]=x;q[x]=v++;}});},rankActive:function(){var v=0;t.forEach(function(w){var x=w.slice(0,-2),y=w.slice(-1);if(y==h.ACTIVE){r[v]=x;s[x]=v++;}});},getGroups:function(){return p;}};(function(){var v=c('InitialChatFriendsList');o=v.list.length?v.list:[];p=v.groups||[];if(!l.is_work_user){t=o.slice();u.rankActive();u.reRank();}else o.forEach(function(w,x){q[w]=x;});})();f.exports=b.OrderedFriendsList||u;},null);
__d('ChatSidebarVisibility',['ChatConfig','ChatSidebarStore','DOMDimensions','OrderedFriendsList'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l=h.get('sidebar.min_friends'),m=h.get('sidebar.minimum_width'),n=h.get('minisidebar.minimum_width'),o={getViewport:function(){return j.getViewportWithoutScrollbarDimensions();},hasLowFriendCount:function(){return k.getActiveList().length<=l;},isViewportCapable:function(){var p=o.getViewport();return p.width>m;},shouldShowSidebar:function(){return o.isViewportCapable()&&i.isEnabled()&&!o.hasLowFriendCount();},isViewportCapableForMiniSidebar:function(){var p=o.getViewport();return p.width>n&&p.width<=m;},shouldShowMiniSidebar:function(){return !h.get('divebar_new_design',false)&&o.isViewportCapableForMiniSidebar()&&i.isEnabled()&&!o.hasLowFriendCount();}};f.exports=o;},null);
__d('ChatSidebarActions',['ChatDispatcher','ChatSidebarActionTypes','ChatSidebarVisibility','SidebarType'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(){var n=k.BUDDYLIST;if(j.shouldShowSidebar()){n=k.SIDEBAR;}else if(j.shouldShowMiniSidebar())n=k.MINI_SIDEBAR;return n;}var m={init:function(){h.dispatch({type:i.INIT});},loaded:function(){h.dispatch({type:i.LOADED});},disable:function(){h.dispatch({type:i.SET_ENABLED,enabled:false,sidebarType:k.BUDDYLIST});},enable:function(){h.dispatch({type:i.SET_ENABLED,enabled:true,sidebarType:l()});},show:function(){h.dispatch({type:i.SHOW,sidebarType:l()});},toggle:function(){h.dispatch({type:i.TOGGLE,sidebarType:l()});}};f.exports=m;},null);
__d('FBRTCDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('FBRTCStore',['FBRTCDispatcher','FluxStore'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j,k;'use strict';j=i;k=j&&j.prototype;Object.assign(l,j);l.prototype=Object.create(j.prototype);l.prototype.constructor=l;l.__superConstructor__=j;function l(){k.constructor.call(this,h);}l.prototype.__emitChange=function(){this.__emitter.emit(this.__changeEvent);};f.exports=l;},null);
__d('FBRTCCallBlockingStore',['Arbiter','AsyncRequest','ChannelConstants','FBRTCStore','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;'use strict';var o=false,p=0,q=null;m=k;n=m&&m.prototype;Object.assign(r,m);r.prototype=Object.create(m.prototype);r.prototype.constructor=r;r.__superConstructor__=m;r.prototype.init=function(s){this.$FBRTCCallBlockingStore1(s);h.subscribe(j.getArbiterType('videocall_block_setting'),this.$FBRTCCallBlockingStore2.bind(this));};r.prototype.$FBRTCCallBlockingStore1=function(s){switch(s){case 0:o=false;this.$FBRTCCallBlockingStore3();break;case -1:o=true;this.$FBRTCCallBlockingStore3();break;default:o=true;this.$FBRTCCallBlockingStore4(s);}this.__emitChange();};r.prototype.$FBRTCCallBlockingStore4=function(s){if(q===null)q=l(this.turnOnVideoCalling.bind(this),s*1000);};r.prototype.getBlockingStatus=function(){return o;};r.prototype.turnOnVideoCalling=function(){new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore5.bind(this)).setData({call_blocked_until:0}).send();};r.prototype.turnOffVideoCalling=function(s){p=s;new i('/ajax/chat/settings.php').setHandler(this.$FBRTCCallBlockingStore6.bind(this)).setData({call_blocked_until:s}).send();};r.prototype.$FBRTCCallBlockingStore3=function(){if(q){clearTimeout(q);q=null;}};r.prototype.$FBRTCCallBlockingStore5=function(){this.$FBRTCCallBlockingStore1(0);};r.prototype.$FBRTCCallBlockingStore6=function(){this.$FBRTCCallBlockingStore1(p);};r.prototype.$FBRTCCallBlockingStore2=function(s,t){var u=t.obj.value;this.$FBRTCCallBlockingStore1(u);};function r(){m.apply(this,arguments);}f.exports=new r();},null);
__d('ChatOptions',['Arbiter','ChannelConstants','ChatSidebarActions','FBRTCCallBlockingStore','JSLogger','PresenceUtil','ChatOptionsInitialData'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=l.create('chat_options'),o={};(function(){var q=c('ChatOptionsInitialData');for(var r in q){var s=q[r];if(r==='call_blocked_until'){k.init(s);}else o[r]=!!s;}})();var p=Object.assign(new h(),{getSetting:function(q){return o[q];},setSetting:function(q,r,s){if(q==='sidebar_mode'){r?j.enable():j.disable();return;}if(this.getSetting(q)==r)return;if(s){s='from_'+s;n.log(s,{name:q,new_value:r,old_value:this.getSetting(q)});}o[q]=!!r;h.inform('chat/option-changed',{name:q,value:r});}});h.subscribe(i.getArbiterType('setting'),function(q,r){var s=r.obj;if(s.window_id===m.getSessionID())return;p.setSetting(s.setting,!!s.value,'channel');});h.subscribe(l.DUMP_EVENT,function(q,r){r.chat_options=o;});f.exports=p;},null);
__d('ChatTabActions',['ChatDispatcher','keyMirror'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j=i({CLOSE_TAB:null,CLOSE_ALL_TABS:null,CLOSE_FRAGILE_TABS:null,LOWER_TAB:null,OPEN_FRAGILE_TAB:null,OPEN_TAB:null,PERSIST_LOCAL_STATE:null,PROMOTE_TAB:null,RAISE_TAB:null}),k={Types:j,closeTab:function(l,m){h.dispatch({actionType:j.CLOSE_TAB,reason:m,threadID:l});},closeAllTabs:function(){h.dispatch({actionType:j.CLOSE_ALL_TABS});},closeFragileTabs:function(){h.dispatch({actionType:j.CLOSE_FRAGILE_TABS});},lowerTab:function(l){h.dispatch({actionType:j.LOWER_TAB,threadID:l});},openFragileTab:function(l){h.dispatch({actionType:j.OPEN_FRAGILE_TAB,threadID:l});},openTab:function(l){h.dispatch({actionType:j.OPEN_TAB,threadID:l});},persistLocalState:function(){h.dispatch({actionType:j.PERSIST_LOCAL_STATE});},promoteTab:function(l){h.dispatch({actionType:j.PROMOTE_TAB,threadID:l});},raiseTab:function(l,m,n){h.dispatch({actionType:j.RAISE_TAB,signatureID:n,threadID:l,userAction:m});}};f.exports=k;},null);
__d('ChatSidebarComposeLink.react',['ChatOpenTab','React','TooltipLink.react','URI','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=i.PropTypes,n=i.createClass({displayName:'ChatSidebarComposeLink',propTypes:{className:m.string.isRequired},componentDidMount:function(){h.listenOpenEmptyTab(i.findDOMNode(this),'sidebar');},render:function(){var o=l._("New Message");return (i.createElement(j,{ajaxify:new k('/ajax/messaging/composer.php'),className:this.props.className,tooltip:o,rel:'dialog'}));}});f.exports=n;},null);
__d('SidebarFitWindowHeight',['Arbiter','ArbiterMixin','Event','Style','SubscriptionsHandler','UITinyViewportAction','Vector','mixin','queryThenMutateDOM'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();var q,r;q=o(i);r=q&&q.prototype;Object.assign(s,q);s.prototype=Object.create(q.prototype);s.prototype.constructor=s;s.__superConstructor__=q;function s(t){'use strict';r.constructor.call(this);this.$SidebarFitWindowHeight1=t;this.onViewportUpdate();m.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){'use strict';if(m.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight2=new l();this.$SidebarFitWindowHeight2.addSubscriptions(j.listen(window,'scroll',t),h.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight3!==0){k.set(this.$SidebarFitWindowHeight1,'margin-top','0');this.$SidebarFitWindowHeight3=0;}this.$SidebarFitWindowHeight2&&this.$SidebarFitWindowHeight2.release();}};s.prototype.onScroll=function(){'use strict';p(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){'use strict';this.$SidebarFitWindowHeight4=n.getScrollPosition().y;this.$SidebarFitWindowHeight5||(this.$SidebarFitWindowHeight5=this.$SidebarFitWindowHeight1.offsetHeight);};s.prototype.resizeSidebar=function(){'use strict';var t=-Math.max(Math.min(this.$SidebarFitWindowHeight4,this.$SidebarFitWindowHeight5),0);k.set(this.$SidebarFitWindowHeight1,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight3){this.$SidebarFitWindowHeight3=t;this.inform('resized',t);}};s.prototype.getOffset=function(){'use strict';return this.$SidebarFitWindowHeight3;};f.exports=s;},null);
__d('ChatSidebar',['Arbiter','ArbiterMixin','AsyncRequest','BanzaiODS','Bootloader','ChatConfig','ChatImpressionLogger','ChatSidebarActions','ChatSidebarComposeLink.react','ChatSidebarStore','ChatSidebarVisibility','CSS','DOM','DOMDimensions','Event','JSLogger','LitestandClassicPlaceHolders','MercuryConfig','Parent','PresencePrivacy','React','ReactComponentRenderer','Run','SidebarType','ScrollableArea','SidebarFitWindowHeight','Style','ViewportBounds','createArrayFromMixed','csx','cx','debounce','emptyFunction','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa){if(c.__markCompiled)c.__markCompiled();var pa='chat_sidebar_visibility',qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab=null,bb,cb=w.create('chat_sidebar');k.setEntitySample(pa,.0001);function db(){return q.getVisibleType()===ea.SIDEBAR;}function eb(){return q.getVisibleType()===ea.MINI_SIDEBAR;}function fb(sb,tb){if(!db())return;if(tb){xa.hide();}else{xa.show();ib();}}function gb(){if(!db()&&!eb()||!va)return 0;if(ab===null){ab=va.offsetWidth;if(eb())ab=206;}return ab;}function hb(){s.removeClass(document.documentElement,'sidebarMode');if(!q.isInitialized()){h.inform('reflow');ia.inform('change');return;}ab=null;xa.hide();za.getCore().reset();s.hide(va);s.hide(ta);s.hide(ua);s.removeClass(document.documentElement,'miniSidebar');s.removeClass(va,"_51xq");sa&&sa.setProps({shown:false},function(){return nb(false);});cb.log('minisidebar_hide');h.inform('sidebar/hide',rb);h.inform('reflow');ia.inform('change');}function ib(){o.show();if(!q.isInitialized()){qb();o.init();}}function jb(){if(za&&db())za.getCore().getElement().focus();}function kb(sb){var tb=r.getViewport().height;sb.forEach(function(ub){if(ub&&ub!==qa)tb-=u.getElementDimensions(ub).height;});if(bb)tb-=bb.getOffset();if(ya)tb-=u.getElementDimensions(ya).height;return Math.max(0,tb);}function lb(){s.hide(ta);s.show(ua);s.removeClass(document.documentElement,'miniSidebar');s.removeClass(va,"_51xq");sa&&sa.setProps({shown:false},function(){return nb(false);});ab=null;s.show(va);s.addClass(document.documentElement,'sidebarMode');xa.show();cb.log('sidebar_show');h.inform('sidebar/show',rb);x.destroy('sidebar');ia.inform('change');mb();}function mb(){var sb=kb(ja(ua.childNodes)),tb=xa.getItemHeight(),ub=8,vb=Math.floor((sb-ub)/tb);ha.set(qa,'height',sb+'px');xa.setNumTopFriends(vb);if(y.ScrollableSidebarTypeaheadGK){za.getView().setMaxHeight(sb);}else{var wb=Math.floor((sb-ub)/tb);wb=wb-2>0?wb-2:0;za.getData().setMaxResults(wb);}h.inform('sidebar/resized',rb);h.inform('reflow');}function nb(sb){if(va===null)return;s.conditionClass(va,"_2e4g",sb);}function ob(){s.hide(ua);s.show(ta);s.show(va);s.addClass(document.documentElement,'sidebarMode');s.addClass(document.documentElement,'miniSidebar');s.addClass(va,"_51xq");var sb=kb([]);if(!sa){l.loadModules(["ChatMiniSidebar.react","ChatSearchSource"],function(tb,ub){if(!ra)ra=new ub({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});sa=new ca(tb,ta);sa.setProps({dataSource:ra,height:sb,maxEntries:50,onClickSearch:nb,onToggleSidebar:o.disable,shown:true});});}else sa.setProps({height:sb,shown:true});x.destroy('sidebar');cb.log('minisidebar_show');h.inform('minisidebar/show',rb);h.inform('reflow');ia.inform('change');}function pb(){new j('/ajax/chat/settings.php').setHandler(na).setErrorHandler(na).setData({sidebar_mode:q.isEnabled()}).setAllowCrossPageTransition(true).send();}function qb(){var sb=true;if(!q.isEnabled()){cb.log('state_not_enabled');sb=false;}if(!r.isViewportCapable())if(!r.isViewportCapableForMiniSidebar()){cb.log('state_not_shown_viewport_mini');sb=false;}if(sb)k.bumpEntityKey(pa,'state_viewport_can_show');if(r.hasLowFriendCount()){cb.log('state_not_shown_num_friends');sb=false;}var tb=sb?'state_shown':'state_not_shown';cb.log(tb);k.bumpEntityKey(pa,tb);}var rb={init:function(sb,tb,ub,vb){rb.init=na;o.loaded();va=sb;xa=tb;za=ub;wa=vb;qa=t.find(sb,'div.fbChatSidebarBody');ta=t.find(sb,"._51x-");ua=t.find(sb,"._51x_");ya=t.find(sb,"._5qqe");var wb=t.find(sb,"._x1u");if(wb)ba.render(ba.createElement(p,{className:"_3a-4 _5q85"}),wb);if(m.get('sidebar_react_dropdown',false)){var xb=t.find(sb,"._1ltf");if(xb)da.onAfterLoad(function(){l.loadModules(["ChatSidebarDropdown.react","SidebarType"],function(zb,ac){ba.render(ba.createElement(zb,{sidebarType:ac.SIDEBAR,onToggleSidebar:o.disable}),xb);});});}v.listen(window,'resize',ib);var yb=t.find(sb,'div.fbChatSidebarMessage div.message');if(yb)da.onAfterLoad(function(){l.loadModules(["ChatSidebarSheet.react"],function(zb){ba.render(ba.createElement(zb,{root:sb,onUpdate:mb}),yb,mb);});});xa.setScrollContainer(z.byClass(xa.getRoot(),'uiScrollableAreaWrap'));xa.subscribe(['render','show','hide'],ma(function(zb){var ac=fa.getInstance(xa.getRoot());ac&&ac.adjustGripper();}));h.subscribe('chat/option-changed',function(zb,ac){if(ac.name==='hide_groups')mb();});h.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps'],ib);ub.getCore().subscribe('sidebar/typeahead/active',fb);ub.subscribe('reset',function(){if(!ub.getCore().getValue()&&!xa.isVisible())fb(null,false);});aa.subscribe('privacy-user-presence-changed',ib);q.addListener(function(){var zb=q.getState(),ac=q.getPrevState();if(zb.visible!==ac.visible)switch(zb.visible){case ea.SIDEBAR:lb();break;case ea.MINI_SIDEBAR:ob();break;case ea.BUDDYLIST:hb();break;}if(zb.enabled!==ac.enabled){if(zb.enabled)setTimeout(jb,0);pb();}});ib();n.init(xa);ia.addPersistentRight(gb);rb.inform('sidebar/initialized',rb,h.BEHAVIOR_PERSISTENT);h.inform('sidebar/initialized',rb,h.BEHAVIOR_PERSISTENT);bb=new ga(ya);bb.subscribe('resized',ib);},ensureLoaded:function(){if(!q.isEnabled())return;if(q.isLoaded())return;if(oa('pagelet_sidebar'))return;e(['UIPagelet'],function(sb){var tb=t.create('div',{id:'pagelet_sidebar'});t.appendContent(document.body,tb);sb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});o.loaded();},hide:function(){if(!q.isEnabled())return;o.disable();},unhide:function(){if(q.isEnabled())return;o.enable();}};Object.assign(rb,i);f.exports=rb;},null);
__d('ChatTypeaheadBehavior',['BanzaiLogger','ChatOpenTab','ChatTypeaheadEvent','CSS','MercuryTypeaheadConstants','Parent','Rect','cx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();function p(r,s){var t=m.byClass(r,"_4oes");if(t)k.conditionClass(t,"_5q83",s);}function q(r){'use strict';this._typeahead=r;this._loggedQuery=false;}q.prototype.enable=function(){'use strict';var r=this._typeahead;this._subscriptions=[r.subscribe('focus',(function(){this._loggedQuery=false;r.getData().refreshData();p(r.getElement(),true);}).bind(this)),r.subscribe('blur',(function(s){if(this._loggedQuery)h.log('ChatTypeaheadLoggerConfig',{event:j.ABANDONED_QUERY,max_results:r.getData().getMaxResults(),num_friend_results:r.getView().results.filter(function(t){return t.render_type===l.FRIEND_TYPE;}).length,query:r.getCore().value});r.getCore().reset();p(r.getElement(),false);this._loggedQuery=false;}).bind(this)),r.subscribe('respond',(function(s,t){if(!this._loggedQuery&&r.getCore().getValue().length>0){h.log('ChatTypeaheadLoggerConfig',{event:j.NEW_QUERY});this._loggedQuery=true;}if(t.value&&t.value===r.getCore().getValue()){if(!t.results.length){var u=t.value.toLowerCase(),v=r.getData().getQueryCache();if(!t.isAsync&&!v.hasOwnProperty(u))return;r.getView().showNoResults();}k.addClass(r.getElement(),'hasValue');}}).bind(this)),r.subscribe('reset',function(){k.removeClass(r.getElement(),'hasValue');}),r.subscribe('select',(function(s,t){var u=t.selected.uid;if(t.selected.mercury_thread&&!t.selected.mercury_thread.is_canonical)u=t.selected.mercury_thread.thread_fbid;r.getView().hide();h.log('ChatTypeaheadLoggerConfig',{event:j.RESULT_SELECTED,max_results:r.getData().getMaxResults(),result_type:t.selected.render_type});this._loggedQuery=false;i.openTabByType(u,t.selected.type,'typeahead');}).bind(this)),r.subscribe('highlight',function(s,t){if(t.index>=0){var u=r.getView().getItems()[t.index];if(u){var v=new n(u),w=u.offsetParent,x=v.boundWithin(new n(w)).getPositionVector();v.getPositionVector().sub(x).scrollElementBy(w);}}})];};q.prototype.disable=function(){'use strict';this._subscriptions.forEach(function(r){this._typeahead.unsubscribe(r);},this);this._subscriptions=null;};Object.assign(q.prototype,{_subscriptions:null});f.exports=q;},null);
__d('NubController',['ArbiterMixin','Dock'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(){}Object.assign(j.prototype,h,{init:function(k){this.el=k;i.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});f.exports=j;},null);
__d('DropdownContextualHelpLink',['DOM','ge'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};f.exports=j;},null);
__d('ChatActivity',['Event','Arbiter','AvailableList','AvailableListConstants','JSLogger','MercuryConfig','PresenceState','UserActivity'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=m.activity_limit||60000,q=m.idle_limit||1800000,r=m.idle_poll_interval||300000,s=l.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&aa-t<p);}var x=Object.assign(new i(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);n.doSync();}x.inform('activity');}j.subscribe(k.ON_AVAILABILITY_CHANGED,function(){if(!j.isUserIdle())u=Date.now();});h.listen(window,'focus',function(){v=true;y();});h.listen(window,'blur',function(){v=false;});o.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&n.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(n.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);n.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});i.subscribe(l.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});f.exports=x;},null);
__d('MercuryNotificationRenderer',['MercuryAssert','MercuryParticipants','MercuryViewer','fbt','MercuryMessages','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('MercuryMessages').get(),m=c('MercuryThreads').get();function n(o,p){h.isThreadID(o);m.getThreadMeta(o,function(q){l.getThreadMessagesRange(o,0,1,function(r){var s=r.length&&r[r.length-1];if(s&&s.author!=j.getID()){i.get(s.author,function(t){if(q.name){p(k._("{senderName} messaged {groupName}",[k.param('senderName',t.short_name),k.param('groupName',q.name)]));}else p(k._("{name} messaged you",[k.param('name',t.short_name)]));});}else p(k._("New message!"));});});}f.exports={renderDocumentTitle:n};},null);
__d('MercuryTimestampTracker',['MercuryActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryDispatcher'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(m){this._fbid=m;this._dispatcher=k.getForFBID(this._fbid);this._lastTimestamp=0;this._dispatcher.subscribe('update-messages',(function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==i.CLIENT_SEND_MESSAGE||o.payload_source==i.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==h.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}).bind(this));}Object.assign(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});Object.assign(l,j);f.exports=l;},null);
__d('ChatTitleBarBlinker',['ChatActivity','ChatConfig','DocumentTitle','FavIcon','JSLogger','MercuryNotificationRenderer','PresenceState','MercuryThreadInformer','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=c('MercuryThreadInformer').get(),p=c('MercuryTimestampTracker').get(),q=l.create('chat_title'),r=null,s=0,t=false;if(i.get('unreadFavicon'))k.setToggleResources(i.get('unreadFaviconURL'));function u(){if(r){r.stop();r=null;return true;}return false;}function v(aa){var ba=aa||p.getLastUserMessageTimestamp();if(s<=ba){s=ba;if(u()||t)n.doSync();}if(i.get('unreadFavicon')&&k.isToggledResource())k.toggle();}var w={blink:function(aa,ba){if(!r&&s<ba)m.renderDocumentTitle(aa,function(ca){if(!r)r=j.blink(ca);});},stopBlinking:function(){v();},blinkingElsewhere:function(){t=true;}};function x(aa){var ba=n.verifyNumber(aa.sb2);if(!ba||ba<=s)return null;return ba;}function y(aa){var ba=aa&&x(aa);if(ba){s=ba;q.debug('load',s);u();t=false;}}function z(aa){var ba=x(aa);if(!ba){q.debug('store',s);aa.sb2=s;t=false;}return aa;}n.registerStateStorer(z);n.registerStateLoader(y);o.subscribe('thread-read-changed',function(aa,ba){var ca=p.getLastUserMessageTimestamp(),da=0;for(var ea in ba)if(ba[ea].mark_as_read&&ba[ea].timestamp>=ca&&ba[ea].timestamp>da)da=ba[ea].timestamp;da&&v(da);});h.subscribe('activity',function(){v();});(function(){var aa=n.getInitial();if(aa)s=x(aa)||0;})();f.exports=w;},null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={messageMentionsViewer:function(k,l){i.get(h.getID(),function(m){l(new RegExp('@'+m.firstName,'i').test(k.body));});}};f.exports=j;},null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','isFacebookURI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=null,p={init:function(t){if(!o)i.init(t);},play:function(t,u,v){if(o){j.playRemote(o.contentWindow,t,u,false);}else j.playLocal(t,u,v);},stop:function(t){if(!o)i.stop(t);}},q=new l(location.href);if(q.getSubdomain()&&q.getSubdomain()!=='www')q.setSubdomain('www');var r=q.getDomain();function s(){if(m.ie()<9)return false;if(h.RPC_DISABLED)return false;return k.isSupported()&&j.supportsRPC();}if(n(q)&&location.host!==r&&s()){o=document.createElement('iframe');o.setAttribute('src','//'+r+'/sound_iframe.php');o.style.display='none';document.body.appendChild(o);}f.exports=p;},null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryViewer','MessagingTag','Sound','MercuryBlockedParticipants','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=c('MercuryBlockedParticipants').get(),t=c('MercuryThreads').get();r.init(['audio/ogg','audio/mpeg']);function u(w){if(k.getSetting('sound'))r.play([j.get('sound.notif_ogg_url'),j.get('sound.notif_mp3_url')],w,false);}var v={messageReceived:function(w){if(p.isViewer(w.author)||!w.is_unread||w.folder!=q.INBOX&&w.folder!=q.ARCHIVED)return;var x=w.thread_id,y=i.isActive();if(y){var z=false;v.inform('before-alert',{threadID:x,cancelAlert:function(){z=true;}});}t.getThreadMeta(x,function(aa){var ba=o.isMuted(aa);n.messageMentionsViewer(w,function(ca){if(ba&&(!m.GroupChatMentionsGK||!ca))return;if(s.isPresentInGroupThread(aa))return;var da=w.timestamp;if(y){!z&&u(da);}else{l.blink(x,da);u(da);}l.blinkingElsewhere();});});}};f.exports=Object.assign(v,h);},null);
__d("FBRTCCallSummaryUploader",["Bootloader"],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={init:function(){h.loadModules(["Banzai","FBRTCCallSummary","FBRTCCallSummaryStore"],function(j,k,l){var m=l.getInstance();j.subscribe(j.SEND,function(){k.logSavedSummaries(m);});});}};f.exports=i;},null);
__d('FBRTCAvailability',['ChannelConstants','PresenceStatus'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j={isCallable:function(k){var l=i.getCapabilities(k),m=h.CAPABILITY_VOIP_INTEROP|h.CAPABILITY_VIDEO;return !!(l&m);}};f.exports=j;},null);
__d('FBRTCStruct',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=function(j,k,l){var m,n;if(typeof j=='string'||j instanceof String){n=j;m=j;}else for(var o in j)if(j.hasOwnProperty(o))if(o==='index'){l=j[o];}else{n=o;m=j[o];}k[n]=l;k.strNames[l]=m;};function i(j){'use strict';this.strNames=[];for(var k=0;k<j.length;k++)h(j[k],this,k);}f.exports=i;},null);
__d('FBRTCConstants',['FBRTCStruct'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={OFFER:'offer',ANSWER:'answer',ICE_CANDIDATE:'ice_candidate',OK:'ok',PING:'ping',HANGUP:'hang_up',OTHER_DISMISS:'other_dismiss',MSG_ACK:'msg_ack',PRANSWER:'pranswer',ICERESTART_OFFER:'icerestart_offer',ICERESTART_ANSWER:'icerestart_answer',PCRESTART_OFFER:'pcrestart_offer',PCRESTART_ANSWER:'pcrestart_answer',SDP_UPDATE:'sdp_update',OFFER_ACK:'offer_ack',OFFER_NACK:'offer_nack',ANSWER_ACK:'answer_ack',SET_VIDEO:'set_video',VIDEO_REQUEST:'video_request',ACK:'ack'},j=new h([{IGNORE_CALL:'IgnoreCall'},{HANGUP_CALL:'HangupCall'},{IN_ANOTHER_CALL:'InAnotherCall'},{ACCEPT_AFTER_HANGUP:'CallEndAcceptAfterHangUp'},{NO_ANSWER_TIMEOUT:'NoAnswerTimeout'},{INCOMING_TIMEOUT:'IncomingTimeout'},{OTHER_INSTANCE_HANDLED:'OtherInstanceHandled'},{SIGNALING_MESSAGE_FAILED:'SignalingMessageFailed'},{CONNECTION_DROPPED:'ConnectionDropped'},{CLIENT_INTERRUPTED:'ClientInterrupted'},{WEBRTC_ERROR:'WebRTCError'},{CLIENT_ERROR:'ClientError'},{NO_PERMISSION:'NoPermission'},{OTHER_NOT_CAPABLE:'OtherNotCapable'},{NO_UI_ERROR:'NoUIShown'},{UNSUPPORTED_VERSION:'VersionUnsupported'},{CALLER_NOT_VISIBLE:'CallerNotVisible'},{CARRIER_BLOCKED:'CarrierBlocked'},{OTHER_CARRIER_BLOCKED:'OtherCarrierBlocked'}]),k={TOGGLE_SELF_VIEW:5,SUBMIT_STAR_RATING:6,SUBMIT_FEEDBACK:7,START_CALL:9,OPEN_SCREEN_IN_NEW:10},l={ONE_HOUR:"1hour",UNTIL_EIGHT_AM:"8am",ALWAYS:"always"},m={PayloadType:i,CallEndReason:j,UIEventType:k,CallBlockingConstants:l,endCallReasonFromString:function(n){return j.strNames.indexOf(n);},callEndReasonString:function(n){if(n<0||n>j.strNames.length)return 'Unknown';return j.strNames[n];},fullCallEndReasonString:function(n,o){return this.callEndReasonString(n)+'_'+(o?'remote':'local');}};f.exports=m;},null);
__d('FBRTCIceStatsParser',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=null;i.getInstance=function(){'use strict';if(!h)h=new i();return h;};function i(){'use strict';}i.prototype.extractIceInfo=function(j){'use strict';var k=[],l=j.split("\r\n");for(var m=0;m<l.length;m++){var n=l[m];if(this.$FBRTCIceStatsParser1(n))k.push({gen:this.$FBRTCIceStatsParser2(n),type:this.$FBRTCIceStatsParser3(n)});}return k;};i.prototype.$FBRTCIceStatsParser1=function(j){'use strict';return j.indexOf('candidate:')>-1;};i.prototype.$FBRTCIceStatsParser2=function(j){'use strict';var k=0,l=j.match(/generation (\d+)/);if(l)k=parseInt(l[1],10);return k;};i.prototype.$FBRTCIceStatsParser3=function(j){'use strict';var k=j.match(/typ (host|relay|srflx|prflx)/);if(k){return k[1];}else return 'unknown';};f.exports=i;},null);
__d('FBRTCLogger',['Log','LogHistory','MarauderLogger','formatDate','pageID'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='webrtc',n='sent_message',o='received_message',p='send_succeeded',q='send_failed',r='info',s='call_action',t='client_event',u='client_error',v='type',w='msg_id',x='ack_msg_id',y='call_id',z='from',aa='to',ba='content',ca='tag',da='peer_id',ea='error_code',fa='trigger',ga='endcallstats',ha=null;ia.getInstance=function(){'use strict';if(!ha)ha=new ia();return ha;};function ia(){'use strict';this.$FBRTCLogger1=i.getInstance(m);}ia.prototype.logToConsole=function(ja){'use strict';var ka='Console';this.$FBRTCLogger2(null,null,ka,ja);this.$FBRTCLogger1.log(ka,ja);};ia.prototype.logReceivedMessage=function(ja,ka,la){'use strict';var ma={};ma[z]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(o,ma);this.$FBRTCLogger2(ja,ka,'Received',la.type+', '+la.msg_id);};ia.prototype.logSentMessage=function(ja,ka,la){'use strict';var ma={};ma[aa]=ja;ma[y]=ka;ma[v]=la.type;ma[w]=la.msg_id;if(la.sdp)ma[ba]=la.sdp;if(la.ack_id)ma[x]=la.ack_id;this.$FBRTCLogger3(n,ma);this.$FBRTCLogger2(ja,ka,'Sent',la.type+', '+la.msg_id);};ia.prototype.logSentMessageSuccess=function(ja,ka,la,ma){'use strict';var na={};na[da]=ja;na[y]=ka;na[v]=la;na[w]=ma;this.$FBRTCLogger3(p,na);};ia.prototype.logSentMessageFailure=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[v]=la;oa[w]=ma;oa[ea]=na;this.$FBRTCLogger3(q,oa);this.$FBRTCLogger2(ja,ka,'Send Failed',la+', '+na);};ia.prototype.logCallAction=function(ja,ka,la,ma,na){'use strict';var oa={};oa[da]=ja;oa[y]=ka;oa[s]=la;oa[ba]=ma;if(na)oa[fa]=na;this.$FBRTCLogger3(s,oa);this.$FBRTCLogger2(ja,ka,'CallAction',la+', '+ma);};ia.prototype.logEvent=function(ja,ka,event){'use strict';var la={};la[da]=ja;la[y]=ka;la[ba]=event;this.$FBRTCLogger3(t,la);this.$FBRTCLogger2(ja,ka,'Event',event);};ia.prototype.logInfo=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(r,ma);this.$FBRTCLogger2(ja,ka,'Info',la);};ia.prototype.logError=function(ja,ka,la){'use strict';var ma={};ma[da]=ja;ma[y]=ka;ma[ba]=la;this.$FBRTCLogger3(u,ma);this.$FBRTCLogger2(ja,ka,'Error',la);};ia.prototype.logErrorWithoutID=function(ja){'use strict';this.logError(null,null,ja);};ia.prototype.logEndCallSummary=function(ja){'use strict';if(!ja)return;var ka={};ka[da]=ja.peerID;ka[y]=ja.callID;ka[ca]=ga;ka[ba]=ja.toString();var la=ja.getExtraInfo();for(var ma in la)if(la.hasOwnProperty(ma))ka[ma]=la[ma];this.$FBRTCLogger3(r,ka);this.$FBRTCLogger2(ja.peerID,ja.callID,'Call Summary',ka);};ia.prototype.$FBRTCLogger3=function(ja,ka){'use strict';ka.page_id=l;this.$FBRTCLogger1.log(ja,ka);j.log(ja,m,ka);};ia.prototype.$FBRTCLogger2=function(ja,ka,la,ma){'use strict';};ia.CallAction={START_CALL:'start_call',RECEIVED_CALL:'received_call',ANSWER_CALL:'answer_call',END_CALL:'end_call',DENIED_PERMISSION:'denied_permission',SET_MUTE:'set_mute',SET_VIDEO_ON:'set_video_on',SET_SELF_VIEW_ON:'set_self_view_on',SET_FULLSCREEN_ON:'set_fullscreen_on',START_SKYPE:'start_skype',TRY_NEW:'try_new',OPEN_POPUP:'open_popup',POPUP_OPENED:'popup_opened',AUTO_DISABLE_VIDEO:'auto_disable_video',FAILED_GETTING_URI:'failed_getting_uri',OLD_URI:'old_uri',USER_SETTINGS_CHANGED:'user_settings_changed'};ia.Trigger={ADMIN_MESSAGE:'admin_message',CHAT_TAB_ICON:'chat_tab_icon',CHAT_TAB_ICON_TOUR:'chat_tab_icon_tour',CHAT_TAB_VOICE_ICON:'chat_tab_voice_icon',SKYPE_DEPRECATION_DIALOG:'skype_deprecation_dialog',REDIAL_BUTTON:'redial_button',RETURN_CALL:'return_call',WEB_MESSENGER:'web_messenger',POPUP_CALL_START_BUTTON:'popup_start_call_button',TIMELINE_PROFILE:'timeline_profile',UNKNOWN:'unknown',RESET_CALL:'install_screen_sharing_ext_dialog'};ia.Key={DEVICE_INFO:'device_info',RATING:'rating5',RATING_SHOWN:'rating_shown',SURVEY_CHOICE:'survey_choice',SURVEY_DETAILS:'survey_details',SURVEY_SHOWN:'survey_shown',INITIATED_BY_PAGE_ID:'initiated_by_page_id',PEER_IS_MOBILE:'peer_is_mobile'};f.exports=ia;},null);
__d('FBRTCCallSummary',['FBRTCConstants','FBRTCIceStatsParser','FBRTCLogger','UserAgentData','performanceNow'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=5*60*1000,n={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};o.CURRENT_SUMMARY_VERSION=19;function o(p){'use strict';this.peerID=p.peerID;this.callID=p.callID;this.$FBRTCCallSummary1=p.isCaller;this.$FBRTCCallSummary2=new Date().valueOf();this.$FBRTCCallSummary3=null;this.$FBRTCCallSummary4={};this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummary10=null;this.$FBRTCCallSummary11={};this.$FBRTCCallSummary12={};this.$FBRTCCallSummary13={};this.$FBRTCCallSummary14={};this.$FBRTCCallSummary15={};this.$FBRTCCallSummary16={};this.$FBRTCCallSummary17=l();this.$FBRTCCallSummary18=0;this.$FBRTCCallSummary19={};this.$FBRTCCallSummary20=this.$FBRTCCallSummary17;this.$FBRTCCallSummary21=0;this.$FBRTCCallSummary22={};this.addExtraInfo(j.Key.DEVICE_INFO,this.$FBRTCCallSummary23());this.$FBRTCCallSummary24();this.$FBRTCCallSummary25=i.getInstance();this.$FBRTCCallSummary26=j.getInstance();}o.prototype.toJsonString=function(){'use strict';this.$FBRTCCallSummary9=new Date().valueOf();return JSON.stringify({version:o.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary1,callType:this.$FBRTCCallSummary27,localVideoDuration:this.$FBRTCCallSummary28,remoteVideoDuration:this.$FBRTCCallSummary29,startTime:this.$FBRTCCallSummary2,trigger:this.$FBRTCCallSummary3,signalingTime:this.$FBRTCCallSummary4,endCallReason:this.$FBRTCCallSummary5,endCallSubreason:this.$FBRTCCallSummary6,isRemoteEnded:this.$FBRTCCallSummary7,lastUpdatedTime:this.$FBRTCCallSummary8,lastSerializedTime:this.$FBRTCCallSummary9,unsetOnRetrieve:this.$FBRTCCallSummary10,openCount:this.$FBRTCCallSummary21,extraInfo:this.$FBRTCCallSummary22,pcStats:this.$FBRTCCallSummary11,captureStats:this.$FBRTCCallSummary12,gen0IceSentCount:this.$FBRTCCallSummary13,gen0IceReceivedCount:this.$FBRTCCallSummary14,iceSentCount:this.$FBRTCCallSummary15,iceReceivedCount:this.$FBRTCCallSummary16,newSignalingTime:this.$FBRTCCallSummary19,accumulatedCallTime:this.$FBRTCCallSummary30()});};o.fromJsonString=function(p){'use strict';var q;try{q=JSON.parse(p);}catch(r){return null;}if(q.version!==o.CURRENT_SUMMARY_VERSION)return null;if(!q.hasOwnProperty('peerID')||!q.hasOwnProperty('callID')||!q.hasOwnProperty('isCaller')||!q.hasOwnProperty('startTime')||!q.hasOwnProperty('trigger')||!q.hasOwnProperty('signalingTime')||!q.hasOwnProperty('endCallReason')||!q.hasOwnProperty('isRemoteEnded')||!q.hasOwnProperty('lastUpdatedTime')||!q.hasOwnProperty('lastSerializedTime'))return null;var s=new o({peerID:q.peerID,callID:q.callID,isCaller:q.isCaller});s.$FBRTCCallSummary2=q.startTime;s.$FBRTCCallSummary3=q.trigger;s.$FBRTCCallSummary4=q.signalingTime;s.$FBRTCCallSummary5=q.endCallReason;s.$FBRTCCallSummary6=q.endCallSubreason;s.$FBRTCCallSummary7=q.isRemoteEnded;s.$FBRTCCallSummary8=q.lastUpdatedTime;s.$FBRTCCallSummary9=q.lastSerializedTime;if(q.callType)s.$FBRTCCallSummary27=q.callType;if(q.localVideoDuration)s.$FBRTCCallSummary28=q.localVideoDuration;if(q.remoteVideoDuration)s.$FBRTCCallSummary29=q.remoteVideoDuration;if(q.unsetOnRetrieve)s.$FBRTCCallSummary10=q.unsetOnRetrieve;if(q.openCount)s.$FBRTCCallSummary21=q.openCount;if(q.extraInfo)s.$FBRTCCallSummary22=q.extraInfo;if(q.pcStats)s.$FBRTCCallSummary11=q.pcStats;if(q.captureStats)s.$FBRTCCallSummary12=q.captureStats;if(q.gen0IceSentCount)s.$FBRTCCallSummary13=q.gen0IceSentCount;if(q.gen0IceReceivedCount)s.$FBRTCCallSummary14=q.gen0IceReceivedCount;if(q.iceSentCount)s.$FBRTCCallSummary15=q.iceSentCount;if(q.iceReceivedCount)s.$FBRTCCallSummary16=q.iceReceivedCount;if(q.newSignalingTime)s.$FBRTCCallSummary19=q.newSignalingTime;if(q.accumulatedCallTime)s.$FBRTCCallSummary18=q.accumulatedCallTime;return s;};o.restoreOrInitialize=function(p,q,r,s,t){'use strict';var u=p.retrieveCallSummary(q,r);if(!u){u=new o({peerID:q,callID:r,isCaller:s});if(t){u.onFullMessageReceived({msg:t});u.onOfferAckSent(t);}else u.onCallStarted(j.Trigger.UNKNOWN);j.getInstance().logError(q,r,'Missing call summary from storage');}else if(u.$FBRTCCallSummary10){u.$FBRTCCallSummary5=null;u.$FBRTCCallSummary6=null;u.$FBRTCCallSummary7=null;delete u.$FBRTCCallSummary4[n.CALL_ENDED];delete u.$FBRTCCallSummary19[n.CALL_ENDED];u.$FBRTCCallSummary10=null;}return u;};o.logSavedSummaries=function(p){'use strict';var q=p.getLoggableSummaries(),r=q.length;if(r<=0)return;var s=j.getInstance(),t=[];for(var u=0;u<r;u++){var v=q[u];s.logEndCallSummary(v);t.push({peerID:v.peerID,callID:v.callID});}p.removeCallSummaries(t);s.logToConsole('Logged pending summaries: '+r);};o.prototype.save=function(p){'use strict';var q=l(),r=q-this.$FBRTCCallSummary20;if(r>m){this.$FBRTCCallSummary26.logInfo(this.peerID,this.callID,'Summary too old: '+r);return;}p.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummary20=q;};o.prototype.getLastUpdatedTime=function(){'use strict';return this.$FBRTCCallSummary8;};o.prototype.setLastUpdatedTime=function(p){'use strict';this.$FBRTCCallSummary8=p;};o.prototype.getExtraInfo=function(){'use strict';return this.$FBRTCCallSummary22;};o.prototype.addExtraInfo=function(p,q){'use strict';this.$FBRTCCallSummary22[p]=q;this.$FBRTCCallSummary24();};o.prototype.onCallStarted=function(p){'use strict';this.$FBRTCCallSummary3=p;this.$FBRTCCallSummary31(n.CALL_STARTED);this.$FBRTCCallSummary24();};o.prototype.onPopupOpened=function(){'use strict';this.$FBRTCCallSummary31(n.POPUP_OPENED);this.$FBRTCCallSummary21++;this.$FBRTCCallSummary24();};o.prototype.setPcStats=function(p){'use strict';this.$FBRTCCallSummary11=p;this.$FBRTCCallSummary24();};o.prototype.setVideoCaptureStats=function(p,q){'use strict';this.$FBRTCCallSummary12={w:p,h:q};this.$FBRTCCallSummary24();};o.prototype.setCallType=function(p){'use strict';this.$FBRTCCallSummary27=p;this.$FBRTCCallSummary24();};o.prototype.setVideoDurations=function(p,q){'use strict';this.$FBRTCCallSummary28=p;this.$FBRTCCallSummary29=q;this.$FBRTCCallSummary24();};o.prototype.onOfferAckSent=function(p){'use strict';this.onMessageSent({type:h.PayloadType.OFFER_ACK,flag:p.flag});};o.prototype.onMessageSent=function(p){'use strict';var q=p.flag===1;switch(p.type){case h.PayloadType.OFFER:this.$FBRTCCallSummary32(q,n.SENT_OFFER,n.SENT_RETRIED_OFFER);this.$FBRTCCallSummary33(p,this.$FBRTCCallSummary13,this.$FBRTCCallSummary15);break;case h.PayloadType.ANSWER:this.$FBRTCCallSummary32(q,n.SENT_ANSWER,n.SENT_RETRIED_ANSWER);this.$FBRTCCallSummary33(p,this.$FBRTCCallSummary13,this.$FBRTCCallSummary15);break;case h.PayloadType.OK:this.$FBRTCCallSummary31(n.SENT_OK);break;case h.PayloadType.PRANSWER:this.$FBRTCCallSummary31(n.SENT_PRANSWER);break;case h.PayloadType.OFFER_ACK:this.$FBRTCCallSummary32(q,n.SENT_OFFER_ACK,n.SENT_RETRIED_OFFER_ACK);break;case h.PayloadType.ANSWER_ACK:this.$FBRTCCallSummary32(q,n.SENT_ANSWER_ACK,n.SENT_RETRIED_ANSWER_ACK);break;case h.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary33(p,this.$FBRTCCallSummary13,this.$FBRTCCallSummary15);break;default:}this.$FBRTCCallSummary24();};o.prototype.$FBRTCCallSummary33=function(p,q,r){'use strict';var s=null,t=null,u=this.$FBRTCCallSummary25.extractIceInfo(p.sdp);for(var v=0;v<u.length;v++){s=u[v].gen;t=u[v].type;if(s===0)this.$FBRTCCallSummary34(q,t);this.$FBRTCCallSummary34(r,t);}};o.prototype.$FBRTCCallSummary34=function(p,q){'use strict';if(!p[q]){p[q]=1;}else p[q]=p[q]+1;};o.prototype.$FBRTCCallSummary35=function(p){'use strict';if(p.isFromMobile())this.addExtraInfo(j.Key.PEER_IS_MOBILE,'1');};o.prototype.onFullMessageReceived=function(p){'use strict';var q=p.msg,r=q.flag===1;switch(q.type){case h.PayloadType.OFFER:this.$FBRTCCallSummary35(p);this.$FBRTCCallSummary32(r,n.RECV_OFFER,n.RECV_RETRIED_OFFER);this.$FBRTCCallSummary33(q,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case h.PayloadType.ANSWER:this.$FBRTCCallSummary35(p);this.$FBRTCCallSummary32(r,n.RECV_ANSWER,n.RECV_RETRIED_ANSWER);this.$FBRTCCallSummary33(q,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;case h.PayloadType.OK:this.$FBRTCCallSummary31(n.RECV_OK);break;case h.PayloadType.PRANSWER:this.$FBRTCCallSummary31(n.RECV_PRANSWER);break;case h.PayloadType.OFFER_ACK:this.$FBRTCCallSummary32(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);break;case h.PayloadType.ANSWER_ACK:this.$FBRTCCallSummary32(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);break;case h.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary33(q,this.$FBRTCCallSummary14,this.$FBRTCCallSummary16);break;default:}this.$FBRTCCallSummary24();};o.prototype.onMsgAckReceived=function(p,q){'use strict';var r=p.msg.flag===1;if(q){this.$FBRTCCallSummary32(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummary32(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);};o.prototype.onCallConnected=function(){'use strict';this.$FBRTCCallSummary31(n.NETWORK_READY);this.$FBRTCCallSummary31(n.CALL_CONNECTED);this.$FBRTCCallSummary24();};o.prototype.onCallEnded=function(p,q,r,s){'use strict';this.$FBRTCCallSummary10=r;this.$FBRTCCallSummary5=p;this.$FBRTCCallSummary6=s;this.$FBRTCCallSummary7=q;this.$FBRTCCallSummary31(n.CALL_ENDED);this.$FBRTCCallSummary24();};o.prototype.toString=function(){'use strict';var p={};p.core_metrics=this.$FBRTCCallSummary36();p.time_series=null;return JSON.stringify(p);};o.prototype.$FBRTCCallSummary36=function(){'use strict';var p={};p.ver=o.CURRENT_SUMMARY_VERSION;p.caller=this.$FBRTCCallSummary1;p.call_type=this.$FBRTCCallSummary27;p.conn=this.$FBRTCCallSummary37();p.peer_id=this.peerID;p.has_video=true;p.open_count=this.$FBRTCCallSummary21;p.signaling=this.$FBRTCCallSummary38();p.sender=this.$FBRTCCallSummary39();p.receiver=this.$FBRTCCallSummary40();p.end=this.$FBRTCCallSummary41();p.video=this.$FBRTCCallSummary42();return p;};o.prototype.$FBRTCCallSummary37=function(){'use strict';var p={dtls:1};if(this.$FBRTCCallSummary11.sender&&this.$FBRTCCallSummary11.sender.rtt)p.rtt=this.$FBRTCCallSummary11.sender.rtt;return p;};o.prototype.$FBRTCCallSummary38=function(){'use strict';var p={};if(this.$FBRTCCallSummary3)p.trigger=this.$FBRTCCallSummary3;p.start_time=this.$FBRTCCallSummary2;p.time_from_start=this.$FBRTCCallSummary4;var q=this.$FBRTCCallSummary4[n.CALL_CONNECTED],r=this.$FBRTCCallSummary4[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummary9){r=this.$FBRTCCallSummary9-this.$FBRTCCallSummary2;}else r=this.$FBRTCCallSummary43();var s=r-q;if(s>0)p.duration=s;}p.new_time_from_start=this.$FBRTCCallSummary19;q=this.$FBRTCCallSummary19[n.CALL_CONNECTED];r=this.$FBRTCCallSummary19[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummary18>0){r=this.$FBRTCCallSummary18;}else r=this.$FBRTCCallSummary30();s=r-q;if(s>0)p.new_duration=s;}return p;};o.prototype.$FBRTCCallSummary39=function(){'use strict';var p={};if(this.$FBRTCCallSummary13)p.ice_g0=this.$FBRTCCallSummary13;if(this.$FBRTCCallSummary15)p.ice=this.$FBRTCCallSummary15;if(this.$FBRTCCallSummary11.sender)Object.assign(p,this.$FBRTCCallSummary11.sender);return p;};o.prototype.$FBRTCCallSummary40=function(){'use strict';var p={};if(this.$FBRTCCallSummary14)p.ice_g0=this.$FBRTCCallSummary14;if(this.$FBRTCCallSummary16)p.ice=this.$FBRTCCallSummary16;return p;};o.prototype.$FBRTCCallSummary41=function(){'use strict';var p={};if(this.$FBRTCCallSummary5!==null){p.end_call_reason_string=h.callEndReasonString(this.$FBRTCCallSummary5);if(this.$FBRTCCallSummary6!==null)p.end_call_subreason_string=this.$FBRTCCallSummary6;p.remote_ended=this.$FBRTCCallSummary7;}if(this.$FBRTCCallSummary11.end)Object.assign(p,this.$FBRTCCallSummary11.end);return p;};o.prototype.$FBRTCCallSummary42=function(){'use strict';var p={capture:{}};if(this.$FBRTCCallSummary11.video&&this.$FBRTCCallSummary11.video.sender)Object.assign(p,this.$FBRTCCallSummary11.video.sender);if(this.$FBRTCCallSummary12)Object.assign(p.capture,this.$FBRTCCallSummary12);return {sender:p,ld:this.$FBRTCCallSummary28,rd:this.$FBRTCCallSummary29};};o.prototype.$FBRTCCallSummary43=function(){'use strict';return new Date().valueOf()-this.$FBRTCCallSummary2;};o.prototype.$FBRTCCallSummary30=function(){'use strict';var p=l()-this.$FBRTCCallSummary17;return Math.floor(this.$FBRTCCallSummary18+p);};o.prototype.$FBRTCCallSummary31=function(p){'use strict';if(this.$FBRTCCallSummary4[p])return;this.$FBRTCCallSummary4[p]=this.$FBRTCCallSummary43();this.$FBRTCCallSummary19[p]=this.$FBRTCCallSummary30();};o.prototype.$FBRTCCallSummary32=function(p,q,r){'use strict';if(p){this.$FBRTCCallSummary31(r);}else this.$FBRTCCallSummary31(q);};o.prototype.$FBRTCCallSummary24=function(){'use strict';this.$FBRTCCallSummary8=new Date().valueOf();};o.prototype.$FBRTCCallSummary23=function(){'use strict';return {device:k.deviceName,os:k.platformName,os_version:k.platformFullVersion,browser:k.browserName,browser_version:k.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};f.exports=o;},null);
__d('FBRTCCallSummaryStore',['CacheStorage','FBRTCCallSummary','FBRTCLogger','areEqual'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l='localstorage',m='RTC_CALL_SUMMARY_',n='summary',o=2000,p=3,q=3*60*1000,r=null;s.getInstance=function(){'use strict';if(!r)r=new s();return r;};function s(){'use strict';this.$FBRTCCallSummaryStore1=new h(l,m);this.$FBRTCCallSummaryStore2=j.getInstance();}s.prototype.storeCallSummary=function(t,u,v){'use strict';var w=this;this.$FBRTCCallSummaryStore3(function(x){if(!x[t])x[t]={};var y=x[t][u];if(y){var z=w.$FBRTCCallSummaryStore4(y);if(z&&z.getLastUpdatedTime()>v.getLastUpdatedTime()){w.$FBRTCCallSummaryStore2.logToConsole('Outdated summaries');return null;}}x[t][u]=w.$FBRTCCallSummaryStore5(v);return x;},w.$FBRTCCallSummaryStore2.logError.bind(w.$FBRTCCallSummaryStore2,t,u));};s.prototype.retrieveCallSummary=function(t,u){'use strict';var v=this.$FBRTCCallSummaryStore6(),w=null;if(v[t])w=v[t][u];if(w){return this.$FBRTCCallSummaryStore4(w);}else return null;};s.prototype.removeCallSummary=function(t,u){'use strict';this.removeCallSummaries([{peerID:t,callID:u}]);};s.prototype.removeCallSummaries=function(t){'use strict';var u=this;this.$FBRTCCallSummaryStore3(function(v){var w=t.length;for(var x=0;x<w;x++){var y=t[x].peerID,z=t[x].callID;if(v[y]&&v[y][z]){delete v[y][z];if(u.$FBRTCCallSummaryStore7(v[y]))delete v[y];}}return v;},u.$FBRTCCallSummaryStore2.logError.bind(u.$FBRTCCallSummaryStore2,null,null));};s.prototype.getLoggableSummaries=function(){'use strict';var t=this.$FBRTCCallSummaryStore6(),u=[];for(var v in t)if(t.hasOwnProperty(v))for(var w in t[v])if(t[v].hasOwnProperty(w)){var x=this.$FBRTCCallSummaryStore4(t[v][w],q);if(x)u.push(x);}return u;};s.prototype.$FBRTCCallSummaryStore7=function(t){'use strict';for(var u in t)if(t.hasOwnProperty(u))return false;return true;};s.prototype.$FBRTCCallSummaryStore5=function(t){'use strict';var u={__t:Date.now(),__d:t.toJsonString()};return u;};s.prototype.$FBRTCCallSummaryStore4=function(t,u){'use strict';if(t)if(!u||Date.now()-t.__t>=u)return i.fromJsonString(t.__d);return null;};s.prototype.$FBRTCCallSummaryStore6=function(){'use strict';var t=this.$FBRTCCallSummaryStore1.get(n)||{};return t;};s.prototype.$FBRTCCallSummaryStore3=function(t,u,v,w){'use strict';if(v===undefined||v===null)v=p;var x=this.$FBRTCCallSummaryStore6(),y=this.$FBRTCCallSummaryStore6(),z=t(x);if(z===null)return;var aa=this.$FBRTCCallSummaryStore6();if(k(y,aa)){this.$FBRTCCallSummaryStore1.set(n,z);this.$FBRTCCallSummaryStore2.logToConsole('Updated summaries');}else if(v>0){u('Retry lock');if(w){var ba=this;setTimeout(function(){ba.$FBRTCCallSummaryStore3(t,u,v-1,true);},o);}else this.$FBRTCCallSummaryStore3(t,u,v-1,true);}else u('Failed to lock');};f.exports=s;},null);
__d('FBRTCScreenSharingLogger',['Log','MarauderLogger','formatDate','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l='webrtc_screen_sharing',m=k({P2P_VIDEO_CALL:null}),n=k({screen_sharing_action:null,screen_sharing_error:null}),o=k({PEER_ID:null,SESSION_ID:null,CONTEXT_TYPE:null,CONTENT:null}),p=k({SCREEN_SHARING_TOGGLED:null,SCREEN_SHARING_CANCELLED:null,SCREEN_SHARING_ENABLED:null,SCREEN_SHARING_DISABLED:null,SCREEN_SHARING_EXT_DIALOG:null,SCREEN_SHARING_EXT_LINK:null}),q=null;r.getInstance=function(){if(!q)q=new r();return q;};r.prototype.logAction=function(s,t,u,v){var w={};w[n.screen_sharing_action]=u;w[o.PEER_ID]=s;w[o.SESSION_ID]=t;w[o.CONTEXT_TYPE]=m.P2P_VIDEO_CALL;w[o.CONTENT]=v;this.$FBRTCScreenSharingLogger1(n.screen_sharing_action,w);this.logToConsole(s,t,u);};r.prototype.logError=function(s,t,u){var v={};v[o.PEER_ID]=s;v[o.SESSION_ID]=t;v[o.CONTEXT_TYPE]=m.P2P_VIDEO_CALL;v[o.CONTENT]=u;this.$FBRTCScreenSharingLogger1(n.screen_sharing_error,v);this.logToConsole(s,t,u);};r.prototype.logToConsole=function(s,t,u){};r.prototype.$FBRTCScreenSharingLogger1=function(s,t){i.log(s,l,t);};function r(){}r.Action=p;f.exports=r;},null);
__d("FBRTCVersionDetection",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isChrome:function(){return !!navigator.webkitGetUserMedia;},isFirefox:function(){return !!navigator.mozGetUserMedia;},webrtcVersion:function(){if(this.isFirefox())return parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);if(this.isChrome()){var i=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(i!==null){return parseInt(i[2],10);}else return 999;}return 0;}};f.exports=h;},null);
__d('FBRTCScreenSharingUtils',['FBRTCScreenSharingLogger','FBRTCStruct','FBRTCVersionDetection','RTCConfig','VideoCallSupport','keyMirror'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=m({OPEN_IN_NEW:null,WINDOW_CLOSED:null}),o=new i(['UNKNOWN','NOT_INSTALLED','INSTALLED']),p=o.UNKNOWN,q={ActionTypes:n,RECIPIENT:'SC_CONTENT_SCRIPT',isScreenSharingSupported:function(){return k.ScreenSharingGK;},isSupportedBrowser:function(){return j.isChrome()&&j.webrtcVersion()>=34;},canReceiveScreenSharing:function(){return k.ReceiveScreenGK&&l.isOSSupported()&&q.isSupportedBrowser();},isExtensionInstalled:function(){return p===o.INSTALLED;},checkExtensionInstalled:function(){if(p!==o.UNKNOWN)return;window.addEventListener('message',q.updateExtensionStatus);q._loopForExtensionStatus(5);},_loopForExtensionStatus:function(r){setTimeout(function(){setTimeout(function(){if(p===o.UNKNOWN)window.postMessage({recipient:'SC_CONTENT_SCRIPT',type:'SC_IS_EXT_INSTALLED',text:'is extension installed'},'*');},1);if(r>1)q._loopForExtensionStatus(r-1);},1000);},updateExtensionStatus:function(event){if(event.origin!=window.location.origin||!event.data.type)return;if(event.data.type==='SC_EXT_INSTALLED'){window.removeEventListener('message',q.updateExtensionStatus);p=o.INSTALLED;}},logFailedAttempt:function(r,s){h.getInstance().logAction(r,s,h.Action.SCREEN_SHARING_TOGGLED,'feature not available');}};f.exports=q;},null);
__d('FBRTCConfig',['FBRTCScreenSharingUtils','UserAgent'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={},k={setConfig:function(l,m,n){j=l;},statsInterpreterConfig:function(){return {rtt_weight:2,frr_weight:800,plr_weight:500,score_threshold:1000,bad_score_count:3};},settingsEnabled:function(){return j.enable_settings;},shouldAutoDisableVideo:function(){return false;},unsupportedBrowserUrl:function(){if(j.troubleshooting_urls&&j.troubleshooting_urls.unsupported_browser)return j.troubleshooting_urls.unsupported_browser;return 'https://www.facebook.com/help/211644178877843';},userMediaErrorUrl:function(){if(j.troubleshooting_urls&&j.troubleshooting_urls.user_media_error)return j.troubleshooting_urls.user_media_error;return 'https://www.facebook.com/help/232232800134371';},userMediaPermissionErrorUrl:function(){if(j.troubleshooting_urls&&j.troubleshooting_urls.user_media_permission_error)return j.troubleshooting_urls.user_media_permission_error;return 'https://www.facebook.com/help/232232800134371';},supportedSignalingExperiments:function(){var l=[];if(i.isBrowser('Chrome')||i.isBrowser('Opera'))l.push('sdp_update');if(h.canReceiveScreenSharing())l.push('screen_sharing');return l;},isMessengerDotCom:function(){return j.is_messenger_dot_com;},useMessengerCallUI:function(){return j.messenger_call_ui;},shouldCreateDataChannel:function(){return j.data_channel;},disableURLManager:function(){return j.disable_url_manager;}};f.exports=k;},null);
__d('FBRTCUtils',['emptyFunction','randomInt','AsyncRequest','FBID','RTCConfig'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=6000,n={attachMediaStream:function(o,p){if(window.webkitRTCPeerConnection){o.src=window.webkitURL.createObjectURL(p);}else{o.mozSrcObject=p;o.play();}},reattachMediaStream:function(o,p){if(window.webkitRTCPeerConnection){o.src=p.src;}else{o.mozSrcObject=p.mozSrcObject;o.play();}},generateRandomInt:function(){return i(0,4294967294)+1;},aboutEqual:function(o,p){return o-p<.01&&p-o<.01;},sendServerRequest:function(o,p,q,r,s,t){p=p||h;q=q||h;r=r||false;s=s||m;t=t||{};var u=new j().setURI(o).setData(t).setAllowCrossPageTransition(true).setHandler(p).setErrorHandler(q).setTimeoutHandler(s,function(){q();});if(r)u.setOption('asynchronous',false);u.send();},isCollabCallable:function(o){return !k.isUser(o)&&l.CollaborationVideoGroupCallGK;}};f.exports=n;},null);
__d("XVideoCallInitController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/init\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null,{});
__d("XVideoCallController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/videocall\/incall\/",{peer_id:{type:"Int",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false}});},null,{});
__d('FBRTCUrlManager',['FBRTCConfig','FBRTCLogger','FBRTCUtils','XVideoCallInitController','XVideoCallController'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=3,n=function(r,s,t,u){i.getInstance().logCallAction(r,s,i.CallAction.OLD_URI);return l.getURIBuilder().setInt('peer_id',r).setInt('call_id',s).setBool('is_caller',t).setBool('audio_only',u).getURI();},o=function(r,s,t,u,v,w,x){if(x===undefined||x===null)x=m;var y=k.getURIBuilder().setInt('peer_id',r).setInt('call_id',s).setBool('is_caller',t).setBool('audio_only',u).getURI();j.sendServerRequest(y,function(z){v(z.payload.uri);},function(z){if(x>0){o(r,s,t,u,v,w,x-1);}else v(n(r,s,t,u));});},p=function(r){if(h.disableURLManager())return;window.history.replaceState({},'',r);},q={init:function(r){this._peerID=r;},onCallStarted:function(){p(n(this._peerID));},getCallUri:o};f.exports=q;},null);
__d('FBRTCCallUI',['BanzaiLogger','UserAgent','FBRTCCallSummary','FBRTCCallSummaryStore','FBRTCConstants','FBRTCLogger','FBRTCUrlManager','pageID'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=null,q={openAsCaller:function(r,s,t,u){if(!p&&window.rtcCallChildWindow){p=window.rtcCallChildWindow;window.rtcCallChildWindow=null;}if(this._shouldFocusCallWindow(r)){p.focus();return;}if(this._shouldCloseCallWindow())p.close();h.log('VideoCallLoggerConfig',{event:'open_as_caller'});m.getInstance().logCallAction(r,s,m.CallAction.START_CALL,null,t);var v=new j({peerID:r,callID:s,isCaller:true});v.onCallStarted(t);this._open(r,s,true,v,false,u);},openAsCallee:function(r,s,t,u,v){h.log('VideoCallLoggerConfig',{event:'open_as_callee'});this._open(r,s,false,t,u,v);},_shouldFocusCallWindow:function(r){return p&&!p.closed&&p.rtcCallInProgessWith===r;},_shouldCloseCallWindow:function(){return p&&!p.closed&&!p.rtcCallInProgessWith;},_open:function(r,s,t,u,v,w){var x=this._windowPosition(),y=['menubar=no','location=no','scrollbars=no','status=no','personalbar=no',x.height,x.width,x.top,x.left].join(',');if(this._isSparkBrowser())y='';u.addExtraInfo(m.Key.INITIATED_BY_PAGE_ID,o);u.onCallEnded(l.CallEndReason.CLIENT_ERROR,false,true,'PopupPending');u.save(k.getInstance());h.log('VideoCallLoggerConfig',{event:'open_popup'});if(!v){p=window.open('','Video Call',y);this._setUri(p,r,s,t,w);}else{m.getInstance().logCallAction(r,s,m.CallAction.OPEN_POPUP);p=window.open(v,'Video Call',y);}if(window.focus)p.focus();},_setUri:function(r,s,t,u,v){n.getCallUri(s,t,u,v,function(w){m.getInstance().logCallAction(s,t,m.CallAction.OPEN_POPUP);r.location=w;},function(){m.getInstance().logCallAction(s,t,m.CallAction.FAILED_GETTING_URI);});},_windowPosition:function(){var r=960,s=540,t,u,v,w;if(screen&&screen.width>1280){r=1280;s=720;}if(window.innerWidth!==undefined){u=window.innerWidth;t=window.innerHeight;}else{u=screen.width;t=screen.height;}if(window.screenLeft!==undefined){v=window.screenLeft;w=window.screenTop;}else{v=window.screenX;w=window.screenY;}var x=Math.floor(u/2-r/2+v),y=Math.floor(t/2-s/2+w);return {height:'height='+s.toString(),width:'width='+r.toString(),top:'top='+y.toString(),left:'left='+x.toString()};},_isSparkBrowser:function(){return i.isBrowser('Chrome < 34')&&i.isBrowser('Chrome > 33');}};f.exports=q;},null);
__d('FBRTCCore',['Bootloader','FBRTCAvailability','FBRTCCallUI','VideoCallSupport','invariant','randomInt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=false,o={startOutgoingCall:function(p,q,r){!!isNaN(parseInt(p,10))?l(0):undefined;if(n)return;n=true;setTimeout(function(){n=false;},1000);if(k.isWebrtcSupported()){var s=this._generateCallID();j.openAsCaller(p,s,q,r);}else h.loadModules(["FBRTCUnsupportedBrowserMessage"],function(t){t.showForOutgoingCall();});},isAvailableForWebrtcCalling:function(p){return i.isCallable(p);},shouldEnableVideoCalling:function(){return k.isOSSupported();},_generateCallID:function(){return m(0,4294967295);}};f.exports=o;},null);
__d('FBRTCMessageListener',['Arbiter','ChannelConstants','RTCConfig','VideoCallSupport','invariant','mixInEventEmitter'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=45*1000,o='rtc_child_window_ready',p='rtc_child_window_message',q=[],r=null,s=null,t=null,u={init:function(v){h.subscribe(i.getArbiterType('webrtc'),(function(w,x){this._onMessage(x.obj);}).bind(this));if(j.PassMessagesBetweenWindowsGK){if(k.isWebrtcSupported()&&window.addEventListener)window.addEventListener('message',this._handleWindowMessage.bind(this),false);if(v)this._connectToParentWindow();}},setMessageHandler:function(v,w){!!r?l(0):undefined;r=w?v.bind(w):v;while(q.length)r(q.shift());},_onMessage:function(v){this.emit('messageReceived',v);if(r){r(v);}else q.push(v);this._passMessageToChildWindow(v);},_connectToParentWindow:function(){if(window.opener&&window.opener.postMessage){var v={type:o};window.opener.postMessage(v,window.location.origin);}},_handleWindowMessage:function(event){if(event.origin!==window.location.origin||!event.data)return;if(event.data.type===o)this._setChildWindow(event.source);if(event.data.type===p)this._onMessage(event.data.message);},_setChildWindow:function(v){s=v;clearTimeout(t);t=setTimeout(function(){s=null;},n);},_passMessageToChildWindow:function(v){if(s){var w={type:p,message:v};s.postMessage(w,window.location.origin);}}};m(u,{messageReceived:true});f.exports=u;},null);
__d('VideoCallCore',['Bootloader','FBRTCCallSummaryUploader','FBRTCCore','FBRTCLogger','FBRTCMessageListener','VideoCallSupport'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=null,o={showOutgoingCallDialog:function(r,s,t){j.startOutgoingCall(r,t||k.Trigger.CHAT_TAB_ICON,s);}};function p(){if(!n)h.loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(r,s,t,u){n=new r(s,u,new t(o));l.setMessageHandler(n.onMessageReceived,n);});}function q(r){return j.isAvailableForWebrtcCalling(r);}if(m.isReceiveWebrtcSupported()){i.init();l.init(false);l.once('messageReceived',function(r){p();});}f.exports=o;},null);
__d('ChatPerfInstrumentation',['BanzaiLogger','ChatPerfEvent','Promise','emptyFunction','performanceAbsoluteNow'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();'use strict';var m={_startTime:(Number),init:function(){this._startTime=l();return new j(function(n){return n();});},_log:function(event){h.log('ChatPerfLoggerConfig',{event:event,duration:l()-this._startTime});},logTTI:function(){this.logTTI=k;this._log(i.TTI);},logCHAT_CONVERSATION_TTI:function(){this.logCHAT_CONVERSATION_TTI=k;this._log(i.CHAT_CONVERSATION_TTI);}};f.exports=m;},null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonMixin','MercuryThreads','mixin','mapObject'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r,s,t=l.SUCCESS;r=p(i);s=r&&r.prototype;Object.assign(u,r);u.prototype=Object.create(r.prototype);u.prototype.constructor=u;u.__superConstructor__=r;function u(x){'use strict';s.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=x;this.$MercuryRoger4=m.getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=o.getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',(function(y,z){for(var aa in z){var ba=this.$MercuryRoger1[aa]||j.OrderedMap();ba=ba.withMutations((function(ca){for(var da in z[aa]){var ea=this.$MercuryRoger5.getThreadMetaNow(aa);if(ea&&ea.participants)if(ea.participants.indexOf(da)==-1){this.$MercuryRoger2.push(w(this.$MercuryRoger1));continue;}var fa=ca.get(da),ga=z[aa][da];if(!fa||ga>fa)ca.set(da,ga);}}).bind(this));this.$MercuryRoger1[aa]=ba.sort();}z&&this.inform('change',z);}).bind(this));h.subscribe(k.DUMP_EVENT,(function(y,z){z.bad_read_receipts={receipts:this.$MercuryRoger2};}).bind(this));}u.prototype.getSeenBy=function(x,y){'use strict';if(!x)return [];var z=[],aa=this.$MercuryRoger1[x.thread_id];if(!aa)return z;aa.forEach(function(ba,ca){if(v(x,ba,ca,y))z.push(ca);});return z;};u.prototype.wasSeenByAll=function(x){'use strict';if(!x)return false;var y=this.$MercuryRoger1[x.thread_id];if(!y)return false;return y.every(function(z,aa){return v(x,z,aa);});};u.prototype.getSeenTimestamps=function(x){'use strict';var y=this.$MercuryRoger1[x];if(!y){y=j.OrderedMap();this.$MercuryRoger1[x]=y;}return y;};u.prototype.getSeenTimestamp=function(x,y){'use strict';var z=this.$MercuryRoger1[x];return z?z.get(y):null;};Object.assign(u,n);function v(x,y,z,aa){return !!(y>x.timestamp&&(x.status===undefined||x.status===t)&&(!aa||z!=x.author));}function w(x){return q(x,function(y){return y.toJS();});}f.exports=u;},null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','setTimeoutAcrossTransitions','MercuryMessages','MercuryRoger','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=c('MercuryMessages').get(),n=c('MercuryRoger').get(),o=c('MercuryThreadInformer').get(),p=c('MercuryThreads').get(),q={},r={},s=k['roger.seen_delay'],t={getSeenBy:function(z,aa){if(r[z])return [];return n.getSeenBy(u(z),aa);},wasSeenByAll:function(z){if(r[z])return false;return n.wasSeenByAll(u(z));}};Object.assign(t,h);function u(z){if(!q[z]){var aa=p.getThreadMetaNow(z);if(aa)q[z]={thread_id:z,author:aa.participants[0],timestamp:aa.timestamp};}return q[z];}function v(z){var aa=false;m.getThreadMessagesRange(z,0,1,function(ba){var ca=ba[0];if(!ca)return;var da=ca.timestamp;if(ca.action_id||ca.status==j.SUCCESS)da-=i.getServerTimeOffset();var ea=t.getSeenBy(z);if(r[z]){clearTimeout(r[z]);delete r[z];}var fa=da+s,ga=fa-Date.now();if(ga>0)r[z]=l(function(){delete r[z];w(z);},ga);q[z]=ca;var ha=t.getSeenBy(z);if(ea.length||ha.length)aa=true;});return aa;}function w(z){var aa={};aa[z]=true;x(aa);}function x(z){t.inform('state-changed',z);t.inform('change');}function y(event,z){var aa={};for(var ba in z)if(v(ba))aa[ba]=true;for(var ca in aa){x(aa);break;}}n.subscribe('change',function(z,aa){for(var ba in aa)!r[ba]&&w(ba);});o.subscribe('messages-received',y);o.subscribe('messages-reordered',y);o.subscribe('messages-updated',y);f.exports=t;},null);
__d('MercuryDeliveryReceipts',['ArbiterMixin','Map','MercuryDispatcher','MercurySingletonMixin','mixin'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m,n;m=l(h);n=m&&m.prototype;Object.assign(o,m);o.prototype=Object.create(m.prototype);o.prototype.constructor=o;o.__superConstructor__=m;function o(p){'use strict';n.constructor.call(this);this.$MercuryDeliveryReceipts1=p;this.$MercuryDeliveryReceipts2=new i();this.$MercuryDeliveryReceipts3=j.getForFBID(this.$MercuryDeliveryReceipts1);this.$MercuryDeliveryReceipts3.subscribe('update-delivery',(function(q,r){if(r.delivery_receipts)for(var s in r.delivery_receipts){var t=r.delivery_receipts[s],u=this.$MercuryDeliveryReceipts2.get(s)||0;if(t>u){this.$MercuryDeliveryReceipts2.set(s,t);this.informDeliveryStatusChanged(s);}}}).bind(this));}o.prototype.informDeliveryStatusChanged=function(p){'use strict';var q=new i();q.set(p,true);this.inform('change',q);};o.prototype.getDeliveryTime=function(p){'use strict';return this.$MercuryDeliveryReceipts2.get(p)||0;};Object.assign(o,k);f.exports=o;},null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonMixin','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();'use strict';var p=h.delivery_timeout||120000;function q(r){this.$MercuryDeliveryState1=r;this.$MercuryDeliveryState2=j.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=l.getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=[];this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState5.bind(this));n.subscribe(o(this.$MercuryDeliveryState6,300,this));}q.prototype.$MercuryDeliveryState5=function(r,s){for(var t in s){var u=s[t];u.forEach((function(v){if(this.$MercuryDeliveryState7(v))this.$MercuryDeliveryState4.push(v);}).bind(this));}if(n.isActive(p))this.$MercuryDeliveryState6();};q.prototype.$MercuryDeliveryState6=function(){if(this.$MercuryDeliveryState4.length===0)return;var r=this.$MercuryDeliveryState4.filter(this.$MercuryDeliveryState7,this).map(function(s){return s.message_id;});if(r)this.$MercuryDeliveryState2.sendDeliveryReceipts(r);this.$MercuryDeliveryState4=[];};q.prototype.$MercuryDeliveryState7=function(r){var s=r.author?i.getUserIDFromParticipantID(r.author):null;if(s===this.$MercuryDeliveryState1)return false;if(!r.is_unread)return false;if(!m.allows(s))return false;return true;};Object.assign(q,k);f.exports=q;},null);
__d('MercuryFilters',['MessagingTag','arrayContains'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=[h.UNREAD],k={ALL:'all',UNREAD:h.UNREAD,getSupportedFilters:function(){return j.concat();},isSupportedFilter:function(l){return i(j,l);}};f.exports=k;},null);
__d('MercuryOrderedThreadlist',['LogHistory','MercuryActionType','MercuryDispatcher','MercuryConfig','MercuryFilters','MercuryFolders','MercuryGlobalActionType','MercuryPayloadSource','MercurySingletonMixin','MercuryThreadIDMap','MessagingTag','PageMessageEnumTag','RangedCallbackManager','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();'use strict';var y=h.getInstance('ordered_threadlist_model'),z=l.getSupportedFilters().concat([l.ALL,r.GROUPS]),aa=m.getSupportedFolders();function ba(la,ma,na,oa){var pa=[],qa=false,ra=false,sa=(ma||[]).filter(function(za){var ab=za.filter||l.ALL;return (za.folder==na||!za.folder&&na==r.INBOX)&&ab==oa;}),ta=la._threadlistOrderMap[na][oa].getAllResources(),ua;sa.forEach(function(za){pa=pa.concat(za.thread_ids);if(za.error){if(za.end>ta.length)ra=za.error;}else{var ab=za.end-za.start;if(za.thread_ids.length<ab)qa=true;}if(!ua||za.end>ua)ua=za.end;});fa(la,pa,na,oa);if(qa){la._threadlistOrderMap[na][oa].setReachedEndOfArray();}else if(ra){la._threadlistOrderMap[na][oa].setError(ra);}else{var va=la._threadlistOrderMap[na][oa].getCurrentArraySize();if(ua&&va<ua){var wa={},xa=ta.concat(pa),ya=xa.filter(function(za){var ab=wa[za];wa[za]=true;return ab;});if(ya.length){y.warn('duplicate_threads',{folder:na,expected_final_size:ua,actual_final_size:va,duplicate_thread_ids:ya});la._serverRequests.fetchThreadlistInfo(ua,ya.length,na,oa==l.ALL?null:oa);}}}}function ca(la,ma){aa.forEach(function(na){z.forEach(function(oa){ba(la,ma,na,oa);});});}function da(la,ma){var na={};aa.forEach(function(oa){na[oa]={};z.forEach(function(pa){na[oa][pa]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ma.forEach(function(oa){if(oa.is_forward)return;var pa=oa.thread_id,qa=ga(la,pa),ra=ha(la,pa);function sa(){ra.forEach(function(ua){if(!x(z,ua))return;na[qa][ua].to_add.push(pa);if(!la._threadlistOrderMap[qa][ua].hasReachedEndOfArray()&&!la._threadlistOrderMap[qa][ua].hasResource(pa))na[qa][ua].to_remove_if_last_after_add[pa]=true;});}function ta(ua){if(x(z,ua))if(x(ra,ua)){na[qa][ua].to_add.push(pa);}else na[qa][ua].to_remove.push(pa);}if(!qa){if(oa.action_type===i.CHANGE_FOLDER||oa.action_type===i.CHANGE_ARCHIVED_STATUS)aa.forEach(function(ua){if(ua!==qa)z.forEach(function(va){la._threadlistOrderMap[ua][va].removeResources([pa]);});});return;}switch(oa.action_type){case i.DELETE_THREAD:ra.forEach(function(ua){if(!x(z,ua))return;na[qa][ua].to_remove.push(pa);});break;case i.CHANGE_ARCHIVED_STATUS:case i.CHANGE_FOLDER:sa();break;case i.CHANGE_READ_STATUS:ta(r.UNREAD);break;case i.USER_GENERATED_MESSAGE:case i.LOG_MESSAGE:ra.forEach(function(ua){if(!x(z,ua))return;if(ia(la,pa,qa,ua))na[qa][ua].to_add.push(pa);});break;case i.CHANGE_FLAG:ta(s.FLAG);break;}});aa.forEach(function(oa){z.forEach(function(pa){var qa=la._threadlistOrderMap[oa][pa];fa(la,na[oa][pa].to_add,oa,pa);for(var ra=qa.getCurrentArraySize()-1;ra>=0;ra--){var sa=qa.getResourceAtIndex(ra);if(!na[oa][pa].to_remove_if_last_after_add[sa])break;na[oa][pa].to_remove.push(sa);}qa.removeResources(na[oa][pa].to_remove);});});}function ea(la,ma){var na={};aa.forEach(function(oa){na[oa]={};z.forEach(function(pa){na[oa][pa]=[];});});ma.forEach(function(oa){var pa=ga(la,oa.thread_id),qa=ha(la,oa.thread_id);if(pa)qa.forEach(function(ra){if(ia(la,oa.thread_id,pa,ra))na[pa][ra].push(oa.thread_id);});});aa.forEach(function(oa){z.forEach(function(pa){if(na[oa][pa].length>0)fa(la,na[oa][pa],oa,pa);});});}function fa(la,ma,na,oa){oa=oa||l.ALL;la._threadlistOrderMap[na][oa].addResources(ma);aa.forEach(function(pa){if(pa!=na)la._threadlistOrderMap[pa][oa].removeResources(ma);});}function ga(la,ma){var na=la._threads.getThreadMetaNow(ma),oa=null;if(!na){oa='No thread metadata';}else if(!na.folder)oa='No thread folder';if(oa){var pa={error:oa,tid:ma};y.warn('no_thread_folder',pa);return null;}var qa=na.folder;if(na.is_archived)qa=r.ACTION_ARCHIVED;if(la._threadlistOrderMap[qa]){return qa;}else return null;}function ha(la,ma){var na=la._threads.getThreadMetaNow(ma),oa=[l.ALL];if(!na){var pa={error:'no_thread_metadata',tid:ma};y.warn('no_thread_metadata',pa);return [];}if(na.unread_count)oa.push(r.UNREAD);if(!na.is_canonical)oa.push(r.GROUPS);var qa=na.page_thread_info;if(qa&&qa.flagged)oa.push(s.FLAG);return oa;}function ia(la,ma,na,oa){var pa=la._threads.getThreadMetaNow(ma);return pa&&pa.timestamp&&ga(la,ma)==na&&x(ha(la,ma),oa);}function ja(la){this._fbid=la;this._serverRequests=u.getForFBID(this._fbid);this._threadIDMap=q.getForFBID(this._fbid);this._threadInformer=v.getForFBID(this._fbid);this._threads=w.getForFBID(this._fbid);this._dispatcher=j.getForFBID(this._fbid);this._threadlistOrderMap={};aa.forEach((function(ma){this._threadlistOrderMap[ma]={};z.forEach((function(na){this._threadlistOrderMap[ma][na]=new t((function(oa){return this._threads.getThreadMetaNow(oa).timestamp;}).bind(this),function(oa,pa){return pa-oa;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}).bind(this));this._dispatcher.subscribe('update-threadlist',(function(ma,na){if(!ka(na))return;if(k.MessengerJewelUnread!=='none')if(na.global_actions)na.global_actions.forEach((function(qa){if(qa.action_type==n.MARK_ALL_READ)this.getThreadlistOrderMap(qa.folder,l.UNREAD).removeAllResources();}).bind(this));var oa=na.ordered_threadlists;if(oa&&oa.length){ca(this,oa);}else{var pa=(na.actions||[]).filter(function(qa){return qa.thread_id;});ea(this,na.threads||[]);da(this,pa);}this._threadInformer.updatedThreadlist();}).bind(this));}Object.assign(ja.prototype,{getThreadlistOrderMap:function(la,ma){if(!this._threadlistOrderMap[la][ma]){z=z.concat([ma]);aa.forEach((function(na){this._threadlistOrderMap[na][ma]=new t((function(oa){return this._threads.getThreadMetaNow(oa).timestamp;}).bind(this),function(oa,pa){return pa-oa;},this._threadIDMap.canLinkExternally.bind(this._threadIDMap));}).bind(this));}return this._threadlistOrderMap[la][ma];},getThreadlist:function(la,ma,na,oa,pa,qa){return this.getFilteredThreadlist(la,ma,na,l.ALL,oa,pa,qa);},getFilteredThreadlist:function(la,ma,na,oa,pa,qa,ra){var sa=this.getThreadlistOrderMap(na,oa),ta=sa.executeOrEnqueue(la,ma,pa,qa),ua=sa.getUnavailableResources(ta),va=sa.getError(la,ma,qa);if(ua.length||va){if(sa.getCurrentArraySize()<la){var wa={start:la,limit:ma,filter:oa,resources_size:sa.getCurrentArraySize()};y.warn('range_with_gap',wa);}sa.setError(false);this._serverRequests.fetchThreadlistInfo(sa.getCurrentArraySize(),ua.length,na,oa==l.ALL?null:oa,ra);}return ta;},getThreadlistUntilTimestamp:function(la,ma,na){na=na||l.ALL;return this.getThreadlistOrderMap(ma,na).getElementsUntil(la);},getAvailableThreadlistNow:function(la,ma){ma=ma||l.ALL;return this.getThreadlistOrderMap(la,ma).getAllResources();},getThreadCount:function(la,ma){ma=ma||l.ALL;return this.getThreadlistOrderMap(la,ma).getCurrentArraySize();},hasLoadedThreadlist:function(la,ma){ma=ma||l.ALL;return this.getThreadlistOrderMap(la,ma).hasReachedEndOfArray();},unsubscribe:function(la,ma,na){na=na||l.ALL;this.getThreadlistOrderMap(ma,na).unsubscribe(la);}});Object.assign(ja,p);function ka(la){switch(la.payload_source){case o.CLIENT_CHANGE_ARCHIVED_STATUS:case o.CLIENT_CHANGE_READ_STATUS:case o.CLIENT_CHANGE_FOLDER:case o.CLIENT_CHANNEL_MESSAGE:case o.CLIENT_DELETE_MESSAGES:case o.CLIENT_DELETE_THREAD:case o.CLIENT_SEND_MESSAGE:case o.SERVER_SEND_MESSAGE:case o.SERVER_FETCH_THREADLIST_INFO:case o.SERVER_THREAD_SYNC:return true;case o.SERVER_INITIAL_DATA:return la.ordered_threadlists;default:return false;}}f.exports=ja;},null);
__d('MercuryStateCheck',['Arbiter','ChannelConstants','LogHistory','MercuryAPIArgsSource','MercuryFolders','MercuryOrderedThreadlist','MercuryServerRequests','MercurySingletonMixin','MessagingTag','URI'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=j.getInstance('mercury_state_check');function s(t){'use strict';this.$MercuryStateCheck1=t;this.$MercuryStateCheck2=n.getForFBID(this.$MercuryStateCheck1);this.$MercuryStateCheck3=m.getForFBID(this.$MercuryStateCheck1);h.subscribe(i.ON_INVALID_HISTORY,this.$MercuryStateCheck4.bind(this,i.ON_INVALID_HISTORY));e(['ChannelConnection'],(function(u){u.subscribe(u.CONNECTED,(function(v,w){if(!w.init)this.$MercuryStateCheck5(u.CONNECTED);}).bind(this));}).bind(this));}s.prototype.$MercuryStateCheck4=function(t){'use strict';var u;if(q.getRequestURI().getPath().search(/messages/)!==-1){u=l.getSupportedFolders();}else u=[p.INBOX];r.debug('check',{folders:u,source:t});this.$MercuryStateCheck2.fetchMissedMessages(u,k.MERCURYSYNC);};s.prototype.$MercuryStateCheck5=function(t){'use strict';var u=this.$MercuryStateCheck3.getAvailableThreadlistNow(p.INBOX)||[];u=u.slice(0,20);r.debug('full_check',{threads:u,source:t});this.$MercuryStateCheck2.fetchThreadData(u,k.MERCURYSYNC);this.$MercuryStateCheck4(t);};Object.assign(s,o);f.exports=s;},null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonMixin','MercuryThreadInfo','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){if(c.__markCompiled)c.__markCompiled();var w=o.MAX_UNSEEN_COUNT,x='unseen_thread_hash',y='unseen_thread_list',z=j.getInstance('mercury_unseen_state');function aa(pa){this._fbid=pa;this._serverRequests=r.getForFBID(this._fbid);this._threadIDMap=p.getForFBID(this._fbid);this._threads=t.getForFBID(this._fbid);this._threadInformer=s.getForFBID(this._fbid);this._dispatcher=l.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new i();this._dispatcher.subscribe('update-unseen',(function(qa,ra){ga(this,ra);}).bind(this));this._dispatcher.subscribe('update-thread-ids',(function(qa,ra){ma(this,ra);}).bind(this));}Object.assign(aa.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){z.error('unguarded_unseen_count_fetch',{});return 0;}return fa(this)||0;},exceedsMaxCount:function(){return this._maxCount||fa(this)>w;},markAsSeen:function(){var pa=fa(this);if(pa===null){this._pendingServerUpdates=true;}else if(pa>0||this._maxCount){this._serverRequests.markSeen();var qa=this._serverRequests.getLastActionTimestamp();ha(this,qa,[]);}}});Object.assign(aa,m);function ba(pa,qa,ra){var sa={};sa[qa]=0;ja(pa,sa,ra);}function ca(pa,qa){pa._unseenResources.setResource(x,qa);pa._unseenResources.setResource(y,Object.keys(qa));}function da(pa,qa){var ra=pa._unseenResources.executeOrEnqueue(x,qa),sa=pa._unseenResources.getUnavailableResources(ra);if(sa.length)pa._serverRequests.fetchUnseenThreadIDs();}function ea(pa){return pa._unseenResources.getResource(x);}function fa(pa){var qa=pa._unseenResources.getResource(y);if(qa){return qa.length;}else return pa._initialUnseenCount;}function ga(pa,qa){var ra=oa(qa);if(qa.unseen_thread_fbids){qa.unseen_thread_fbids.forEach(function(cb){if(cb.folder!=q.INBOX)return;var db=cb.thread_fbids||[];db=db.concat(cb.other_user_fbids||[]);var eb=la(pa,db),fb=pa._lastSeenTimestamp;if(ra&&ra.seen_timestamp)fb=ra.seen_timestamp;ha(pa,fb,eb);if(ra&&ra.unseen_count>w)pa._maxCount=true;});}else if(ra&&ra.seen_timestamp){pa._lastSeenTimestamp=ra.seen_timestamp;if(ra.unseen_count>w){pa._maxCount=true;ca(pa,{});}else{pa._initialUnseenCount=ra.unseen_count;if(pa._initialUnseenCount===0)ca(pa,{});}}else{if(pa._maxCount)return;var sa=qa.actions;if(!sa||!sa.length)return;var ta={},ua={};for(var va=0;va<sa.length;va++){var wa=sa[va];if(wa.is_forward)continue;var xa=wa.action_type,ya=wa.other_user_fbid?wa.other_user_fbid:wa.thread_fbid,za=wa.thread_id?wa.thread_id:ya;if(xa==k.MARK_THREAD_SEEN){ba(pa,za,wa.persistent);continue;}if(!na(pa,wa))continue;if(xa==k.USER_GENERATED_MESSAGE||xa==k.LOG_MESSAGE){var ab=ta[za]?wa.timestamp>ta[za]:false,bb=ab||!ta[za];if(wa.is_unread&&bb)pa._threads.getThreadMeta(za,function(cb){var db=false;if(cb&&cb.last_read_timestamp)if(cb.last_read_timestamp>=wa.timestamp)db=true;if(!n.isMuted(cb)&&!db)ta[za]=wa.timestamp;});}else if(xa==k.CHANGE_READ_STATUS&&wa.mark_as_read)ua[za]=wa.timestamp;}ia(pa,ta);ja(pa,ua);}if(pa._pendingServerUpdates){pa._pendingServerUpdates=false;pa.markAsSeen();}}function ha(pa,qa,ra){var sa=ea(pa);if(sa===undefined||qa>pa._lastSeenTimestamp||pa._maxCount){pa._lastSeenTimestamp=qa;ra=ra||[];if(ra.length<=w)pa._maxCount=false;var ta={},ua=ea(pa)||{};for(var va in ua)if(ua[va]!==true){var wa=ua[va];if(ka(pa,wa))ta[va]=wa;}var xa=Object.assign(u(ra,true),ta);ca(pa,xa);pa._threadInformer.updatedUnseenState();}}function ia(pa,qa){if(pa._maxCount)return;var ra={},sa=false;for(var ta in qa){var ua=qa[ta];if(ka(pa,ua)){ra[ta]=ua;sa=true;}}if(!sa)return;da(pa,function(va){for(var wa in ra){var xa=ra[wa];if(!va[wa]&&ka(pa,xa))va[wa]=ra[wa];}ca(pa,va);pa._threadInformer.updatedUnseenState();});}function ja(pa,qa,ra){var sa=false;if(!v(qa))sa=true;if(sa)da(pa,function(ta){var ua=false;for(var va in qa){var wa=qa[va],xa=wa>ta[va];if(ta[va]&&(!wa||xa)){delete ta[va];ua=true;}}if(ua){ca(pa,ta);pa._threadInformer.updatedUnseenState();if(ra&&fa(pa)===0)pa._serverRequests.markSeen();}});}function ka(pa,qa){return qa>pa._lastSeenTimestamp;}function la(pa,qa){return qa.map(pa._threadIDMap.convertThreadIDIfAvailable,pa._threadIDMap);}function ma(pa,qa){var ra=ea(pa);if(!ra)return;for(var sa in qa){var ta=qa[sa];if(ra[sa]){ra[ta]=ra[sa];delete ra[sa];}}ca(pa,ra);}function na(pa,qa){var ra=qa.thread_id?pa._threads.getThreadMetaNow(qa.thread_id):null,sa=ra?h.getFromMeta(ra):qa.folder;return sa===q.INBOX||sa===undefined;}function oa(pa){var qa=pa.message_counts||[];for(var ra=0;ra<qa.length;ra++)if(qa[ra].folder==q.INBOX)return qa[ra];return null;}f.exports=aa;},null);
__d('ChatBehavior',['Arbiter','AvailableList','AvailableListConstants','MercuryConstants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryConstants').ChatNotificationConstants,l=false,m=i.getWebChatNotification&&i.getWebChatNotification(),n=l,o=true,p=Object.assign(new h(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}i.subscribe&&i.subscribe(j.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=i.getWebChatNotification();m=s;if(r!=s)q();});h.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});h.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});f.exports=p;},null);
__d('ChatCookieInterface',['ChatConfig','InitialServerTime','LogHistory','PresenceState','PresenceUtil','areJSONRepresentationsEqual'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=j.getInstance('chat_cookie'),o=i.serverTime,p=h.get('tab_max_load_age')||3600000,q=o-p,r={store:function(v,w){if(v.uct2==w.lastChangeTime)return v;var x=u(v,w),y={};if(!x){y.old_tabs=v&&v.t2&&JSON.stringify(v.t2);y.old_promoted=v&&v.lm2;y.old_time=v&&v.uct2;y.old_reason=v&&v.tr;y.old_window=v&&v.tw;var z=[];w.tabs.forEach(function(aa){if(!aa.fragile){var ba={i:aa.id,si:aa.server_id};if(aa.raised)ba.r=1;z.push(ba);}});v.t2=z;v.lm2=w.promotedID;v.uct2=w.lastChangeTime;v.tr=w.lastChangeReason;v.tw=l.getSessionID();y.new_tabs=JSON.stringify(v.t2);y.new_promoted=v.lm2;y.new_time=v.uct2;y.new_reason=v.tr;y.new_window=v.tw;n.debug('store',y);}else{y.tabs=v&&v.t2&&JSON.stringify(v.t2);y.promoted=v&&v.lm2;y.time=v&&v.uct2;y.reason=v&&v.tr;y.window=v&&v.tw;y.last_change_time=w.lastChangeTime;y.last_change_reason=w.lastChangeReason;y.min_change_time=q;n.warn('store_bad_state',y);}return v;},load:function(v,w){if(!v){n.warn('load_bad_state',v);return false;}var x=u(v,w);if(!x||x===w.lastChangeTime)return false;var y={};y.old_tabs=JSON.stringify(w.tabs);y.old_promoted=w.promotedID;y.old_time=w.lastChangeTime;y.old_reason=w.lastChangeReason;y.window_id=l.getSessionID();y.cookie_tabs=v&&v.t2&&JSON.stringify(v.t2);y.cookie_promoted=v&&v.lm2;y.cookie_time=v&&v.uct2;y.cookie_reason=v&&v.tr;y.cookie_window=v&&v.tw;w.lastChangeTime=x;w.lastChangeReason='load';var z=s(w,v.t2,v.lm2||null);y.load_result=z;y.new_tabs=JSON.stringify(w.tabs);y.new_promoted=w.promotedID;y.new_time=w.lastChangeTime;y.new_reason=w.lastChangeReason;var event='load';if(!w.isInitialized)event+='_init';n.log(event,y);return z;}};function s(v,w,x){var y;if(!t(v,w,x))return false;var z=v.tabs.filter(function(ca){return !!ca.fragile;}),aa={};v.promotedID=null;v.tabs=w.map(function(ca){var da={id:ca.i,server_id:ca.si};if(da.id==x)v.promotedID=da.id;if(ca.r)da.raised=true;aa[da.id]=da;return da;});v.tabs=v.tabs.filter(function(ca){return !!ca;});if(v.localRaised)for(var ba in v.localRaised)if(!aa[ba]||!aa[ba].raised)delete v.localRaised[ba];z=z.filter(function(ca){return !aa[ca.id];});(y=v.tabs).push.apply(y,z);return true;}function t(v,w,x){if(x!=v.promotedID)return true;var y=v.tabs.filter(function(ba){return !ba.fragile;});if(w.length!=y.length)return true;for(var z=0,aa=w.length;z<aa;z++)if(!m(w[z],y[z]))return true;return false;}function u(v,w){var x=k.verifyNumber(v.uct2);if(!x||typeof x!=='number'){n.warn('bad_cookie_version',v);return null;}if(x<w.lastChangeTime||x<q)return null;return x;}f.exports=r;},null);
__d('ChatTabModel',['Arbiter','ArbiterMixin','ChatBehavior','ChatDispatcher','ChatConfig','ChatCookieInterface','ChatTabActions','InitialServerTime','LogHistory','JSLogger','MercuryAssert','MercuryLocalIDs','PresenceState','PresenceUtil','MercuryThreadIDMap','MercuryThreads','MercuryTimestampTracker'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=Object.assign||function(za){for(var ab=1;ab<arguments.length;ab++){var bb=arguments[ab];for(var cb in bb)if(Object.prototype.hasOwnProperty.call(bb,cb))za[cb]=bb[cb];}return za;},w=c('MercuryThreadIDMap').get(),x=c('MercuryThreads').get(),y=c('MercuryTimestampTracker').get(),z=o.serverTime,aa=l.get('tab_max_load_age')||3600000,ba=20,ca=p.getInstance('chat_tab_model'),da={tabs:[],promotedID:null,lastChangeTime:0,lastChangeReason:null,isInitialized:false,localRaised:null};function ea(za){var ab=m.load(za,da);ab&&ia();return ab;}function fa(za,ab,bb){var cb=ea(t.get());if(ab===undefined||ab>da.lastChangeTime){if(za()){cb=true;da.lastChangeReason=bb||null;ha(ab);}}else ca.error('rejected',{change_time:ab,state_time:da.lastChangeTime});cb&&ga();}function ga(){if(da.isInitialized)xa.inform('change');}function ha(za){if(za===undefined)za=Math.max(y.getLastUserMessageTimestamp()||1,da.lastChangeTime+1);da.lastChangeTime=za;t.doSync();}function ia(za){var ab=da.tabs.length-ba;if(ab>0)da.tabs=da.tabs.filter(function(bb){return bb.raised||bb.id==za||(ab--)<=0;});if(ab>0)da.tabs=da.tabs.filter(function(bb){return bb.id==da.promotedID||bb.id==za||(ab--)<=0;});}function ja(za){for(var ab=0;ab<da.tabs.length;ab++)if(da.tabs[ab].id==za)return ab;return -1;}function ka(za,ab){var bb=x.getThreadMetaNow(za);if(!bb)return false;if(bb.is_canonical_user){return na(za,ab);}else{var cb=ma(za);if(cb)w.getFBIDFromClientID(za,function(db){if(qa(za,db)){ha();ga();}});return cb;}}function la(za){r.isThreadID(za);if(ma(za))ga();}function ma(za){if(ja(za)===-1){da.tabs.push({id:za,fragile:true});ca.log('open_fragile_tab',{tabs:JSON.stringify(da.tabs),opened:za,window_id:u.getSessionID()});return true;}return false;}function na(za,ab){var bb=ja(za);if(bb!=-1)if(da.tabs[bb].fragile){da.tabs.splice(bb,1);}else{ab&&(da.tabs[bb].signatureID=ab);return true;}for(var cb=0;cb<=da.tabs.length;cb++)if(cb==da.tabs.length||da.tabs[cb].fragile){da.tabs.splice(cb,0,{id:za,signatureID:ab});ia(za);ca.log('open_tab',{tabs:JSON.stringify(da.tabs),opened:za,window_id:u.getSessionID()});return true;}}function oa(za,ab,bb){r.isThreadID(za);var cb=false;if(da.localRaised&&ab){da.localRaised[za]=true;cb=true;}fa(function(){if(ka(za,bb))cb=true;var db=ja(za);if(db!=-1&&!da.tabs[db].raised){da.tabs[db].raised=true;cb=true;ca.log('raise_tab',{tabs:JSON.stringify(da.tabs),raised:za,window_id:u.getSessionID()});}return cb;});}function pa(za){if(ja(za)!==-1&&da.promotedID!==za){da.promotedID=za;return true;}return false;}function qa(za,ab){var bb=ja(za);if(bb!=-1&&da.tabs[bb].fragile){var cb=da.tabs[bb];cb.fragile=false;cb.server_id=ab;var db=[];da.tabs.forEach(function(eb){if(eb.id!=za){if(cb&&eb.fragile){db.push(cb);cb=null;}db.push(eb);}});if(cb)db.push(cb);da.tabs=db;ca.log('make_permanent',{tabs:JSON.stringify(da.tabs),tab_id:za,window_id:u.getSessionID()});return true;}return false;}function ra(za,ab){r.isThreadID(za);var bb=false;if(da.localRaised){delete da.localRaised[za];bb=true;}fa(function(){if(sa(za))bb=true;return bb;},undefined,ab);}function sa(za){var ab=ja(za);if(za==da.promotedID)da.promotedID=null;if(ab!=-1){da.tabs.splice(ab,1);ca.log('close_tab',{tabs:JSON.stringify(da.tabs),closed:za,window_id:u.getSessionID()});return true;}return false;}function ta(){if(da.tabs.length){ca.log('close_all_tabs',{closed_tabs:JSON.stringify(da.tabs),window_id:u.getSessionID()});da.tabs=[];da.promotedID=null;if(da.localRaised)da.localRaised={};ha();ga();}}function ua(){var za=[];for(var ab=0;ab<da.tabs.length;ab++)if(da.tabs[ab].fragile&&!x.isNewEmptyLocalThread(da.tabs[ab].id)){za.push(da.tabs[ab]);da.tabs.splice(ab);ga();break;}ca.log('close_fragile_tabs',{tabs:JSON.stringify(da.tabs),fragile_closed:za,window_id:u.getSessionID()});}function va(za){r.isThreadID(za);var ab=false;if(da.localRaised){delete da.localRaised[za];ab=true;}fa(function(){var bb=ja(za);if(bb!=-1&&da.tabs[bb].raised){delete da.tabs[bb].raised;ca.log('lower_tab',{tabs:JSON.stringify(da.tabs),lowered:za,window_id:u.getSessionID()});ab=true;}return ab;});}function wa(){if(da.localRaised){fa(function(){var za=false;da.tabs.forEach(function(ab){if(ab.raised!=da.localRaised[ab.id]){za=true;if(da.localRaised[ab.id]){ab.raised=true;}else delete ab.raised;}});return za;});ca.log('persist_local_raise',{tabs:JSON.stringify(da.tabs),window_id:u.getSessionID()});}}t.registerStateStorer(function(za){return m.store(za,da);});t.registerStateLoader(function(za){if(ea(za))ga();});function xa(){}Object.assign(xa,i,{isTabPromoted:function(za){if(za)return za==da.promotedID;return false;},indexOf:function(za){return ja(za);},getTab:function(za){r.isThreadID(za);var ab=this.indexOf(za);if(ab>-1){var bb=da.tabs[ab];return v({},bb);}return null;},getEmptyTab:function(){var za;for(var ab=0;ab<da.tabs.length;ab++){za=da.tabs[ab].id;if(x.isNewEmptyLocalThread(za))return za;}za=s.generateThreadID();x.createNewLocalThread(za,[]);return za;},get:function(){var za=da.tabs.map(function(ab){var bb=v({},ab);delete bb.fragile;if(da.localRaised)bb.raised=da.localRaised[bb.id];return bb;});return {tabs:za,promoted:da.promotedID};},promoteThreadInPlaceOfThread:function(za,ab,bb,cb){r.isThreadID(za);r.isThreadID(ab);fa(function(){var db=ja(za),eb=ja(ab);if(cb){da.promotedID=za;}else if(da.promotedID===ab)return true;var fb=da.tabs[db];if(bb){r.isThreadID(bb);var gb=ja(bb),hb=da.tabs[eb];da.tabs[eb]=fb;da.tabs.splice(db,1);da.tabs.splice(gb,0,hb);}else{da.tabs[db]=da.tabs[eb];da.tabs[eb]=fb;}return true;});},addListener:function(za){return xa.subscribe('change',za);}});h.subscribe(q.DUMP_EVENT,function(za,ab){ab.chat_tabs={promoted:da.promotedID,tabs:da.tabs.map(function(bb){return v({},bb);}),time:da.lastChangeTime,max_load_age:aa};});function ya(){var za=j.ignoresRemoteTabRaise();if(za&&!da.localRaised){ca.log('start_ignore_remote_raise');da.localRaised={};ga();}else if(!za&&da.localRaised){ca.log('stop_ignore_remote_raise');da.localRaised=null;ga();}}k.register(function(za){switch(za.actionType){case n.Types.CLOSE_TAB:ra(za.threadID,za.reason);break;case n.Types.CLOSE_ALL_TABS:ta();break;case n.Types.CLOSE_FRAGILE_TABS:ua();break;case n.Types.LOWER_TAB:va(za.threadID);break;case n.Types.OPEN_FRAGILE_TAB:la(za.threadID);break;case n.Types.OPEN_TAB:r.isThreadID(za.threadID);fa(function(){return ka(za.threadID);});break;case n.Types.PERSIST_LOCAL_STATE:wa();break;case n.Types.PROMOTE_TAB:r.isThreadID(za.threadID);fa(pa.bind(null,za.threadID));break;case n.Types.RAISE_TAB:oa(za.threadID,za.userAction,za.signatureID);break;}});j.subscribe(j.ON_CHANGED,ya);ya();ea(t.getInitial(),true);if(da.lastChangeTime===0)da.lastChangeTime=z-600000;da.isInitialized=true;f.exports=xa;},null);
__d('ChatTabPresence',['AvailableList','ChatTabModel','MercuryIDs'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={};function l(m){var n=j.getUserIDFromThreadID(m);if(n&&h.shouldUpdateForID(n))h.updateForID(n);}i.addListener(function(){var m=i.get();m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});f.exports={};},null);
__d('ChatMentionsNotifications',['fbt','CurrentUser','MercuryParticipants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={notifyIfMessageToMe:function(l){var m='fbid:'+i.getID(),n=l.body;j.get(m,function(o){var p=new RegExp(o.short_name,"i");if(p.test(n))k._notify(l);});},_notify:function(l){var m=48,n=l.body;if(n.length>m)n=n.substr(0,m-3)+"...";new Notification(h._("You were tagged in a message!"),{body:n,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};f.exports=k;},null);
__d('ChatTabViewInstances',['Map'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('ChatNewMessageHandler',['ChatActivity','ChatMentionsNotifications','ChatTabModel','ChatTabViewInstances','JSLogger','MercuryAssert','MercuryBrowserAlerts','UserActivity','MercuryConfig','MercuryThreadlistConstants'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){if(c.__markCompiled)c.__markCompiled();var r=l.create('chat_new_message'),s={_notify:function(t,u,v){if(p.DesktopNotificationsGK)i.notifyIfMessageToMe(u);var w=k.get(t);v.view_is_visible=w&&w.isVisible();v.view_is_focused=w&&w.isFocused();if(!v.view_is_visible)r.log('message_to_hidden');v.is_active=h.isActive();n.messageReceived(u);},newMessage:function(t,u){m.isThreadID(t);var v=j.getTab(t),w={thread_id:t,message_id:u.message_id,to_new_tab:!v,to_raised_tab:v?!!v.raised:true};this._notify(t,u,w);r.log('message',w);}};n.subscribe('before-alert',function(t,event){var u=event.threadID,v=k.get(u),w=j.getTab(u),x=q.MESSAGE_NOTICE_INACTIVITY_THRESHOLD;if(w&&w.raised&&v&&v.isVisible()&&v.isFocused()&&o.isActive(x)){v.tryMarkAsRead();event.cancelAlert();}});f.exports=s;},null);
__d('ChatTabLRUManager',['ChatTabViewInstances','ChatTabModel','InitialServerTime','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('MercuryThreads').get(),l={getLRUVisibleTab:function(m){if(m.hasRoomForRaisedTab())return undefined;var n=Object.keys(m.getTabsToShow()||{}),o=1*60,p=null,q=Infinity;for(var r=0;r<n.length;r++){var s=n[r],t=k.getThreadMetaNow(s);if(i.isTabPromoted(s))continue;if(!h.get(s).hasEmptyInput()||!t)continue;var u=(j.serverTime-t.timestamp)/1000;if(!t.timestamp||t.timestamp&&t.timestamp<q&&u>o){p=t.thread_id;q=t.timestamp;}}return p;}};f.exports=l;},null);
__d('ChatTabPolicy',['ChatBehavior','ChatConfig','JSLogger','MercuryActionType','MercuryLogMessageType','MercuryAssert','MercuryConfig','MercuryGroupThreadMentions','MercuryIDs','MercuryParticipantTypes','MercurySourceType','MercuryThreadInfo','MercuryViewer','MessagingTag','PresencePrivacy','ShortProfiles','MercuryBlockedParticipants','MercuryThreadActions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){if(c.__markCompiled)c.__markCompiled();var x=c('MercuryBlockedParticipants').get(),y=c('MercuryThreadActions').get(),z=j.create('tab_policy');f.exports={messageIsAllowed:function(aa,ba,ca){var da=aa.thread_id,ea=ba.message_id;m.isThreadID(da);m.isParticipantID(ba.author);var fa;if(s.isMuted(aa)){fa={thread_id:da,message_id:ea,mute_settings:aa.mute_settings};z.log('message_thread_muted',fa);if(n.GroupChatMentionsGK)o.messageMentionsViewer(ba,function(ia){if(ia)ca();});return;}if(aa.read_only){fa={thread_id:da,message_id:ea,mode:aa.mode};z.log('message_read_only',fa);return;}if(ba.source==r.EMAIL||ba.source==r.TITAN_EMAIL_REPLY){fa={thread_id:da,message_id:ea,source:ba.source};z.log('message_source_not_allowed',fa);return;}var ga=p.getUserIDFromParticipantID(ba.author);if(!ga){z.log('message_bad_author',{thread_id:da,message_id:ea,user:ga});return;}if(ba.action_type!=k.USER_GENERATED_MESSAGE&&!this._messageIsNewlyCreatedGroup(ba,aa)){fa={thread_id:da,message_id:ea,type:ba.action_type};z.log('message_non_user_generated',fa);return;}if(aa.is_canonical_user&&!h.notifiesUserMessages()){z.log('message_jabber',{thread_id:da,message_id:ea});y.markSeen(da,true);return;}if(aa.is_canonical&&!aa.canonical_fbid){z.log('message_canonical_contact',{thread_id:da,message_id:ea});return;}if(aa.folder!=u.INBOX){z.log('message_folder',{thread_id:da,message_id:ea,folder:aa.folder});return;}if(x.isPresentInGroupThread(aa)){fa={thread_id:da,message_id:ea};z.log('message_blocked_participants',fa);return;}var ha=p.getUserIDFromParticipantID(t.getID());w.getMulti([ga,ha],function(ia){if(!v.allows(ga)){z.log('message_privacy',{thread_id:da,message_id:ea,user:ga});return;}var ja=ia[ga].employee&&ia[ha].employee,ka=i.get('IsWorkUser',false);if(!ja&&!ka&&!ia[ga].isCommercePage&&ia[ga].type!==q.FRIEND){z.log('message_non_friend',{thread_id:da,message_id:ea,user:ga});return;}ca();});},_messageIsNewlyCreatedGroup:function(aa,ba){return aa.action_type===k.LOG_MESSAGE&&aa.log_message_type===l.THREAD_NAME&&ba.message_count===1;}};},null);
__d('ChatTabViewEvents',['Arbiter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('MercuryParticipantListRenderer',['fbt'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';function i(){this.$MercuryParticipantListRenderer1=false;this.$MercuryParticipantListRenderer2=false;this.$MercuryParticipantListRenderer3=false;this.$MercuryParticipantListRenderer4=(function(s){return this.$MercuryParticipantListRenderer2?s.short_name:s.name;}).bind(this);}i.prototype.renderParticipantList=function(s){var t=s.map(this.$MercuryParticipantListRenderer4);switch(t.length){case 0:return j(this.$MercuryParticipantListRenderer1);case 1:return k(t);case 2:return this.$MercuryParticipantListRenderer3?m(t):l(t);case 3:return this.$MercuryParticipantListRenderer3?o(t):n(t);default:return this.$MercuryParticipantListRenderer3?q(t):p(t);}};i.prototype.setIsNewThread=function(s){this.$MercuryParticipantListRenderer1=s;return this;};i.prototype.setNameRenderer=function(s){this.$MercuryParticipantListRenderer4=s;return this;};i.prototype.setUseShortName=function(s){this.$MercuryParticipantListRenderer2=s;return this;};i.prototype.setUseAndSeparator=function(s){this.$MercuryParticipantListRenderer3=s;return this;};function j(s){if(s){return h._("New Message");}else return h._("No Participants");}function k(s){return s[0];}function l(s){return h._("{participant1}, {participant2}",[h.param('participant1',s[0]),h.param('participant2',s[1])]);}function m(s){return h._("{participant1} and {participant2}",[h.param('participant1',s[0]),h.param('participant2',s[1])]);}function n(s){return h._("{participant1}, {participant2}, {participant3}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2])]);}function o(s){return h._("{participant1}, {participant2} and {participant3}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2])]);}function p(s){return h._("{participant1}, {participant2}, {participant3}, {others_link}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('participant3',s[2]),h.param('others_link',r(s.length-3))]);}function q(s){return h._("{participant1}, {participant2} and {others_link}",[h.param('participant1',s[0]),h.param('participant2',s[1]),h.param('others_link',r(s.length-2))]);}function r(s){if(s>1){return h._({"*":"{others_count} others"},[h.param('others_count',s,[0])]);}else return h._("1 other");}f.exports=i;},null);
__d('MercuryThreadTitle.react',['MercuryIDs','MercuryParticipantListRenderer','MercuryParticipants','React','TextWithEmoticons.react','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();'use strict';var n=k.PropTypes,o=k.createClass({displayName:'MercuryThreadTitle',propTypes:{isNewThread:n.bool,thread:n.object.isRequired,viewer:n.string.isRequired,showUnreadCount:n.bool,useShortName:n.bool,useAndSeparator:n.bool},getDefaultProps:function(){return {isNewThread:false,showUnreadCount:false,useShortName:false,useAndSeparator:false};},getInitialState:function(){return {participantNames:''};},componentDidMount:function(){this._renderParticipantsList(this.props);},componentWillReceiveProps:function(p){this._renderParticipantsList(p);},render:function(){return (k.createElement('span',{className:this.props.className},this.props.thread.name?this._renderThreadTitle():this.state.participantNames,this.props.children));},getTitle:function(){return this.state.participantNames;},_renderThreadTitle:function(){var p=this.props.thread,q=k.createElement(l,{renderEmoticons:true,renderEmoji:true,text:p.name});if(!p.unread_count||!this.props.showUnreadCount)return q;return this._renderTitleWithUnreadCount(q,p.unread_count);},_renderParticipantsList:function(p){if(p.thread.name)return;var q=h.getParticipantIDFromUserID(p.viewer),r=p.thread.participants;if(r.length>1)r=r.filter(function(s){return s!=q;});j.getMulti(r,(function(s){if(!this.isMounted())return;var t=r.map(function(w){return s[w];}),u=new i().setUseShortName(this.props.useShortName).setUseAndSeparator(this.props.useAndSeparator).setIsNewThread(this.props.isNewThread).renderParticipantList(t),v=p.showUnreadCount&&p.thread.unread_count?this._renderTitleWithUnreadCount(u,p.thread.unread_count):u;this.setState({participantNames:v});}).bind(this));},_renderTitleWithUnreadCount:function(p,q){return m._("{conversation-title} ({unread-count})",[m.param('conversation-title',p),m.param('unread-count',q)]);}});f.exports=o;},null);
__d('ChatTabViewSelector',['Arbiter','ArbiterMixin','CSS','ChatTabActions','CurrentUser','DOM','DataStore','Event','MenuDeprecated','MercuryThreadTitle.react','NubController','React','ChatTabTemplates','Toggler','MercuryThreadInformer','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){if(c.__markCompiled)c.__markCompiled();var v=c('MercuryThreadInformer').get(),w=c('MercuryThreads').get();function x(y){var z=t[':fb:chat:tab:selector'].build(),aa=z.getRoot(),ba=z.getNode('menu'),ca=m.find(ba,'.uiMenuInner'),da={},ea=new r().init(aa);j.hide(aa);m.insertBefore(y,aa);function fa(ia){var ja=0;for(var ka in da){var la=da[ka],ma=w.getThreadMetaNow(ka),na=la.getNode('unreadCount'),oa=ma&&ma.unread_count||0;ja+=oa;if(oa>9)oa='+';j.conditionClass(na,'invisible_elem',!oa);m.setContent(na,oa);}var pa=z.getNode('numMessages');j.conditionShow(pa,ja);m.setContent(pa,ja);}this.setTabData=function(ia){var ja=da;da={};if(ia.length<1){j.hide(aa);return;}j.show(aa);m.empty(ca);ia.forEach(function(ma){var na=t[':fb:chat:tab:selector:item'].build(),oa=na.getNode('content');da[ma.id]=na;w.getThreadMeta(ma.id,function(qa){s.render(s.createElement(q,{thread:qa,useAndSeparator:true,viewer:l.getID()}),oa);});m.prependContent(ca,na.getRoot());n.set(na.getRoot(),'threadID',ma.id);var pa=na.getNode('closeButton');o.listen(pa,'click',function(event){k.closeTab(ma.id,'selector/close-tab');event.kill();});});for(var ka in ja)if(ja.hasOwnProperty(ka)){var la=ja[ka].getNode('content');la&&s.unmountComponentAtNode(la);}ea.flyoutContentChanged();m.setContent(z.getNode('numTabs'),ia.length);fa();};function ga(event,ia){if(ia.menu!=ba)return;var ja=n.get(ia.item,'threadID');x.inform('selected',ja);u.hide(aa);}function ha(event,ia){p.register(ba);}p.subscribe('select',ga.bind(this));u.listen('show',aa,function(){h.inform('layer_shown',{type:'ChatTabSelector'});ha();});u.listen('hide',aa,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});v.subscribe('threads-updated',fa);}Object.assign(x,i);f.exports=x;},null);
__d('ChatTabController',['Arbiter','BanzaiLogger','ChatActivity','ChatConfig','ChatNewMessageHandler','ChatTabActions','ChatTabLRUManager','ChatTabModel','ChatTabPolicy','ChatTabViewEvents','ChatTabViewInstances','ChatTabViewSelector','JSLogger','MercuryViewer','Style','UserAgent_DEPRECATED','VideoCallCore','ChatTabPresence','ChatTypeaheadBehavior','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();c('ChatTabPresence');c('ChatTypeaheadBehavior');var y=c('MercuryThreadInformer').get(),z=c('MercuryThreadActions').get(),aa=c('MercuryThreads').get(),ba=k.get('tab_auto_close_timeout')||7200000,ca=t.create('tab_controller');function da(oa,pa,qa){var ra=o.get().tabs,sa=ra[oa],ta,ua;if(ra.length===0)return false;var va=ra.slice(oa+1),wa=ra.slice(0,oa),xa=va.concat(wa);if(!pa)xa.reverse();if(sa)xa.push(sa);for(var ya=0;ya<xa.length;ya++){ta=xa[ya];ua=r.get(ta.id);if(ua&&ua.isVisible()&&(!qa||ta.raised)){ua.focus();return true;}}return false;}function ea(oa,pa){var qa=pa&&pa.getRightmostHiddenTab();if(qa===oa)return null;return qa;}function fa(){return Math.floor(Math.random()*2147483648).toString(16);}function ga(oa,pa,qa,ra){m.raiseTab(oa,true,qa);var sa=pa&&pa.getLeftmostVisibleTab(),ta=pa&&pa.getTabsToShow();if(ta&&!ta[oa]&&sa){o.promoteThreadInPlaceOfThread(oa,sa,ea(oa,pa),true);}else m.promoteTab(oa);h.inform('chat/open-tab',oa);if(ra)return;var ua=r.get(oa);ua&&ua.focus();}function ha(oa,pa){if(!o.getTab(oa))m.raiseTab(oa,false);var qa=pa&&n.getLRUVisibleTab(pa),ra=pa&&pa.getTabsToShow();if(ra&&!ra[oa]&&qa)o.promoteThreadInPlaceOfThread(oa,qa,ea(oa,pa));}function ia(oa){s.subscribe('selected',function(qa,ra){ga(ra,oa);});h.subscribe('page_transition',function(qa,ra){m.closeFragileTabs();});h.subscribe('chat-visibility/go-offline',function(){m.closeAllTabs();});j.subscribe('idle',function(qa,ra){if(ra>ba){var sa=o.get().tabs;sa.forEach(function(ta){var ua=ta.id;aa.getThreadMeta(ua,function(va){if(!va.unread_count){ca.log('autoclose_idle_seen',{thread_id:ua,idleness:ra});m.closeTab(ua,'autoclose_idle_seen');}});});}});q.subscribe('nub-activated',function(qa,ra){ga(ra,oa);});q.subscribe('focus-tab',function(qa,ra){var sa=o.getTab(ra);if(sa&&sa.raised)ga(ra,oa,sa.signatureID,false);});function pa(qa,ra){i.log('VideoCallLoggerConfig',{event:'chat_tab_call_click'});x.showOutgoingCallDialog(ra.userID,ra.audioOnly,ra.clickSource);}q.subscribe('video-call-clicked',pa);q.subscribe('interaction-with-tab',function(qa,ra){var sa=o.getTab(ra);sa&&sa.raised&&z.markSeen(ra);});q.subscribe('esc-pressed',function(qa,ra){ca.log('close_esc',{thread_id:ra});var sa=o.indexOf(ra);m.closeTab(ra,'close_esc');setTimeout(function(){da(sa-1,true,true);},0);});y.subscribe('messages-received',function(qa,ra){for(var sa in ra){var ta=ra[sa];for(var ua=0;ua<ta.length;ua++){var va=ta[ua];if(va.author!=u.getID()){if(!va.is_unread){ca.log('message_already_read',{action_id:va.action_id,thread_id:va.thread_id});continue;}aa.getThreadMeta(sa,function(wa){p.messageIsAllowed(wa,va,function(){ha(sa,oa);l.newMessage(sa,va);});});}}}});y.subscribe('thread-read-changed',function(qa,ra){for(var sa in ra)if(!ra[sa].mark_as_read){ca.log('autoclose_marked_unread',{thread_id:sa});m.closeTab(sa,'autoclose_marked_unread');}});q.subscribe('tab-pressed',function(qa,ra){return !da(o.indexOf(ra.id),ra.shiftPressed);});h.subscribe(t.DUMP_EVENT,function(qa,ra){ra.chat_controller={auto_close_timeout:ba};});this.openTab=function(qa,ra,sa,ta){ga(qa,ra,fa(),ta);if(sa)sa(r.get(qa));};}if(w.firefox()){var ja=function(){return v.get(document.body,'overflowX')+' '+v.get(document.body,'overflowY');},ka=ja(),la=function(){var oa=ja();if(oa!==ka){ka=oa;h.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ma=new MutationObserver(la),na={attributes:true,attributeFilter:['class','style']};ma.observe(document.documentElement,na);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))la();},false);}f.exports=ia;},null);
__d('ChatTabViewPlaceholder',['DOM','ErrorUtils','React','cx'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';function l(m,n,o,p,q,r){this.$ChatTabViewPlaceholder1={threadID:n,serverThreadID:o,signatureID:p,root:q,prevTab:r};this.$ChatTabViewPlaceholder2={visible:true,raised:true};m.then((function(s){try{var u=new s(this.$ChatTabViewPlaceholder1.threadID,this.$ChatTabViewPlaceholder1.serverThreadID,this.$ChatTabViewPlaceholder1.signatureID,this.$ChatTabViewPlaceholder1.root,this);u.setVisibleState(this.$ChatTabViewPlaceholder2.visible,this.$ChatTabViewPlaceholder2.raised);this.destroy();this.$ChatTabViewPlaceholder3=u.getTabElem();if(this.$ChatTabViewPlaceholder4)this.$ChatTabViewPlaceholder4(this.$ChatTabViewPlaceholder1.threadID,u);}catch(t){i.reportError(t,false);}}).bind(this));this.render(this.$ChatTabViewPlaceholder1.root,this.$ChatTabViewPlaceholder1.prevTab);}l.prototype.getTabElem=function(){return this.$ChatTabViewPlaceholder3;};l.prototype.onBeingReplaced=function(m){this.$ChatTabViewPlaceholder4=m;};l.prototype.updateSignatureID=function(m){this.$ChatTabViewPlaceholder1.signatureID=m;};l.prototype.getScrollTop=function(){return 0;};l.prototype.appendTo=function(m){h.appendContent(m,this.$ChatTabViewPlaceholder3);};l.prototype.insertBefore=function(m){h.insertBefore(m.getTabElem(),this.$ChatTabViewPlaceholder3);};l.prototype.isFocused=function(){return false;};l.prototype.hasEmptyInput=function(){return true;};l.prototype.destroy=function(){j.unmountComponentAtNode(this.$ChatTabViewPlaceholder3);h.remove(this.$ChatTabViewPlaceholder3);};l.prototype.nextTabIs=function(m){var n=m&&m.getTabElem();return !!(this.$ChatTabViewPlaceholder3&&this.$ChatTabViewPlaceholder3.nextSibling===n);};l.prototype.setVisibleState=function(m,n){this.$ChatTabViewPlaceholder2={visible:m,raised:!!n};this.render(this.$ChatTabViewPlaceholder1.root,this.$ChatTabViewPlaceholder1.prevTab);};l.prototype.render=function(m,n){var o=!this.$ChatTabViewPlaceholder2.visible,p=this.$ChatTabViewPlaceholder2.raised,q="fbNub"+(' '+"_50-v")+(o?' '+"hidden_elem":'')+(p?' '+"opened":'')+(' '+"placeholder")+(' '+"_50mz");if(!this.$ChatTabViewPlaceholder3){var r=h.create('div',{className:q});this.$ChatTabViewPlaceholder3=r;j.render(j.createElement('div',null,j.createElement('span',{className:"fbNubButton"}),'opened ? (',j.createElement('div',{className:"fbNubFlyout fbDockChatTabFlyout _16bz"},j.createElement('div',{className:"fbNubFlyoutTitlebar"}),j.createElement('div',{className:"fbNubFlyoutBody"})),')'),r);if(n&&n.getTabElem()){this.insertBefore(n);}else this.appendTo(m);}else this.$ChatTabViewPlaceholder3.className=q;};f.exports=l;},null);
__d('ChatTabViewLoader',['Bootloader','ChatTabViewPlaceholder','Promise','Run','requireWeak'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();'use strict';var m,n;l('ChatTabView',function(p){return n=p;});var o={make:function(p,q,r,s,t){if(n){return new n(p,q,r,s,t);}else{if(!m)m=new j(function(u){k.onAfterLoad(function(){h.loadModules(["ChatTabView"],function(v){n=v;u(v);});});});return new i(m,p,q,r,s,t);}}};f.exports=o;},null);
__d('ChatTabViewCoordinator',['Arbiter','ChatTabModel','ChatTabViewLoader','ChatTabViewSelector','CSS','JSLogger','VideoCallSupport'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();var o=m.create('chat_tab_coordinator');function p(q,r){var s=new k(q),t={},u=false;function v(){var z=i.get(),aa={};z.tabs.forEach(function(ca){aa[ca.id]=1;});o.log('process_tab_changed',{model_tabs:Object.keys(aa),view_tabs:Object.keys(t)});for(var ba in t)if(!aa[ba]){o.log('remove_tab',{tab_id:ba});t[ba].destroy();delete t[ba];}w(z);x(z);if(z.tabNeedsFocus&&!z.tabNeedsFocus.isFocused())z.tabNeedsFocus.focus();}function w(z){var aa=null;z.tabs.forEach(function(ba){var ca=ba.id,da=false;if(!t[ca]){o.log('add_tab',{tab_id:ca});t[ca]=j.make(ca,ba.server_id,ba.signatureID,q,aa);da=true;if(t[ca].onBeingReplaced)t[ca].onBeingReplaced(function(fa,ga){t[fa]=ga;});}else t[ca].updateSignatureID(ba.signatureID);if(t[ca].isFocused())z.tabNeedsFocus=t[ca];if(!da&&!t[ca].nextTabIs(aa)){var ea=t[ca].getScrollTop();if(aa){t[ca].insertBefore(aa);}else t[ca].appendTo(q);if(ea)t[ca].setScrollTop(ea);}aa=t[ca];});}function x(z){var aa=r.getTabsToShow(z),ba=[],ca=false;z.tabs.forEach(function(da){if(!aa[da.id]){t[da.id].setVisibleState(false,da.raised);ba.push(da);}});z.tabs.forEach(function(da){if(aa[da.id]){t[da.id].setVisibleState(true,da.raised);ca|=da.raised;}});s.setTabData(ba);y(ca);}function y(z){if(!z&&u){h.inform('layer_hidden',{type:'ChatTab'});u=false;}else if(z&&!u){h.inform('layer_shown',{type:'ChatTab'});u=true;}}if(n.isVideoCallSupported())l.addClass(q,'videoCallEnabled');r.subscribe('tabs-changed',v);v();}f.exports=p;},null);
__d('TabsViewport',['Arbiter','ArbiterMixin','ChatTabModel','Dock','DOM','DOMDimensions','Event','Parent','Vector','ViewportBounds','areJSONRepresentationsEqual','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();var t=175,u=269,v=0;function w(){return t;}function x(){return u;}function y(z){this._root=z;var aa=this._recalculateWidth.bind(this);n.listen(window,'resize',aa);k.subscribe('resize',aa);h.subscribeOnce('sidebar/initialized',aa,h.SUBSCRIBE_NEW);j.subscribe('change',(function(){return this._recalculateTabs(true);}).bind(this));this._recalculateWidth();this._initialized=true;}Object.assign(y.prototype,i,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var z=y._getAvailableDockWidth(this._root),aa=Math.max(1,Math.floor(z/x())),ba=aa!=this._maxShown;if(!this._viewState||ba||z<=this._viewState.usedWidth||z>this._viewState.widthToShowNext){this._availableWidth=z;this._maxShown=aa;this._viewState=null;this._recalculateTabs(ba);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(z){var aa=y._getTabsToShow(j.get(),this._availableWidth);if(z||!r(this._viewState,aa)){this._viewState=aa;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>x();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},getShowingTabsOrder:function(){var z=j.get(),aa=this._viewState.tabsToShow;return z.tabs.filter(function(ba){return aa[ba.id];});},getRightmostHiddenTab:function(){var z=j.get(),aa=this._viewState.tabsToShow,ba=z.tabs.filter(function(da){return !aa[da.id];}),ca=ba.shift();return ca?ca.id:null;},getLeftmostVisibleTab:function(){var z=this.getShowingTabsOrder(),aa=z.pop();return aa?aa.id:null;},getRaisedVisibleTabs:function(){var z=[],aa=this.getShowingTabsOrder(),ba=aa.length;for(var ca=0;ca<ba;ca++)if(j.getTab(aa[ca].id).raised)z.push(aa[ca].id);return z;},shouldPromoteOnRaise:function(z){if(!this._viewState.tabsToShow[z])return true;if(this._viewState.nextToHide!=z)return false;var aa=j.getTab(z),ba=aa&&aa.raised;return !ba&&this._availableWidth-this._viewState.usedWidth<x()-w();}});Object.assign(y,{_getAvailableDockWidth:function(z){var aa=m.getViewportWithoutScrollbarDimensions().width;aa-=q.getLeft()+q.getRight();aa-=50;var ba=o.byClass(z,'fbDock'),ca=l.find(ba,"._56ox"),da=ca?p.getElementDimensions(ca).x:0;aa-=da;var ea=l.scry(ba,"._56oy");da+=p.getElementDimensions(ea.pop()).x;var fa=p.getElementDimensions(ba),ga=fa.x-da;if(ga>v)v=ga;aa-=v;aa-=15;return Math.max(aa,0);},_getTabsToShow:function(z,aa){aa=Math.max(aa,x()+1);function ba(ra,sa){return ra.raised||!sa?x():w();}var ca=JSON.parse(JSON.stringify(z.tabs)),da=-1,ea=null;if(z.promoted)ca.forEach(function(ra,sa){if(ra.id===z.promoted){da=sa;ea=ra;}});var fa=0,ga=false,ha=0,ia=!ea;ca.forEach(function(ra,sa){var ta=ba(ra,ga);ga=ga||!ra.raised;ra.leftmostOffset=fa+ta;fa+=ta;if(ra.leftmostOffset<aa)ha++;ia|=sa==da;ra.alreadyPlacedPromoted=ia;});function ja(ra,sa,ta){var ua={};for(var va=0;va<sa;va++){var wa=ra[va];if(!wa.alreadyPlacedPromoted&&va==sa-1){ua[ta]=true;}else ua[wa.id]=true;}return ua;}var ka=ja(ca,ha,z.promoted),la=ja(ca,ha-1,z.promoted),ma=null;for(var na in ka)if(!la[na])ma=na;var oa=ca[ha-1],pa=oa?oa.leftmostOffset:0,qa=Infinity;if(ha<ca.length)qa=ca[ha].leftmostOffset;return {nextToHide:ma,tabsToShow:ka,usedWidth:pa,widthToShowNext:qa};}});f.exports=y;},null);
__d('MessengerDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';var i=h({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null}});f.exports=i;},null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';k=h;l=k&&k.prototype;Object.assign(m,k);m.prototype=Object.create(k.prototype);m.prototype.constructor=m;m.__superConstructor__=k;function m(){l.constructor.call(this,i);this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}m.prototype.__onDispatch=function(n){var o=n.type;switch(o){case j.DIALOG.SHOW:this.$MNCommerceDialogStateStore1=n.dialogContainer;this.$MNCommerceDialogStateStore2=n.state;this.__emitChange();break;case j.DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};m.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};m.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new m();},null);
__d('MNCommerceDialogContainer.react',['MNCommerceDialogStateStore','PureStoreBasedStateMixin','React'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';var k=j.createClass({displayName:'MNCommerceDialogContainer',mixins:[i(h)],statics:{calculateState:function(){var l=h.getDialogContainer();return {dialogContainer:l};}},render:function(){var l=this.state.dialogContainer;if(!l)return null;return j.createElement(l,null);}});f.exports=k;},null);
__d('P2PActionConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PRODUCT_ITEM_BANNER_UPDATED:'product_item_banner_updated',PRODUCT_ITEM_BANNER_DISMISSED:'product_item_banner_dismissed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated'};f.exports=h;},null);
__d('P2PDispatcher',['Dispatcher'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';f.exports=new h();},null);
__d('P2PDialogStore',['EventEmitter','P2PActionConstants','P2PDispatcher'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l;'use strict';var m,n={};k=h;l=k&&k.prototype;Object.assign(o,k);o.prototype=Object.create(k.prototype);o.prototype.constructor=o;o.__superConstructor__=k;function o(){l.constructor.call(this);m=j.register(this.onEventDispatched.bind(this));n={dialogClass:null,dialogProps:null};}o.prototype.getState=function(){return n;};o.prototype.onEventDispatched=function(p){var q=p.type,r=p.data;switch(q){case i.DIALOG_SHOWN:n.dialogClass=r.dialogClass;n.dialogProps=r.dialogProps;this.emit('change');break;case i.DIALOG_CLOSED:n.dialogClass=null;n.dialogProps=null;this.emit('change');break;}};f.exports=new o();},null);
__d('P2PDialogContainer.react',['P2PDialogStore','React','ReactLayeredComponentMixin'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';var k=i.createClass({displayName:'P2PDialogContainer',mixins:[j],getInitialState:function(){return h.getState();},componentDidMount:function(){this.dialogStoreSub=h.addListener('change',this.onDialogStoreChange);},componentWillUnmount:function(){if(this.dialogStoreSub){this.dialogStoreSub.remove();this.dialogStoreSub=null;}},onDialogStoreChange:function(){this.setState(h.getState());},renderLayers:function(){if(!this.state.dialogClass)return {};var l=this.state.dialogClass;return {dialog:i.createElement(l,this.state.dialogProps)};},render:function(){return null;}});f.exports=k;},null);
__d('HotLikeSound',['MercuryConfig','SoundPlayer','StickerConstants'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();'use strict';i.init(['audio/ogg','audio/mpeg']);var k=[h['sound.hot_like_grow_mp3_url'],h['sound.hot_like_grow_ogg_url']],l=[h['sound.hot_like_pop_mp3_url'],h['sound.hot_like_pop_ogg_url']],m=[h['sound.hot_like_outgoing_small_mp3_url'],h['sound.hot_like_outgoing_small_ogg_url']],n=[h['sound.hot_like_outgoing_medium_mp3_url'],h['sound.hot_like_outgoing_medium_ogg_url']],o=[h['sound.hot_like_outgoing_large_mp3_url'],h['sound.hot_like_outgoing_large_ogg_url']],p=function(){return false;},q={setCheckSoundEnabledFunc:function(r){p=r;},start:function(){this._play(k);},stop:function(){i.stop(k);},pop:function(){this.stop();this._play(l);},snap:function(r){this.stop();if(r===j.HOT_LIKE_SMALL_STICKER_ID)this._play(m);if(r===j.HOT_LIKE_MEDIUM_STICKER_ID)this._play(n);if(r===j.HOT_LIKE_LARGE_STICKER_ID)this._play(o);},_play:function(r){if(p())i.play(r);}};f.exports=q;},null);
__d('ChatApp',['CSS','ChatPerfInstrumentation','DOM','JSLogger','Promise','React','csx'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();'use strict';var o={init:function(u,v,w){if(this._isInitialized){k.create('chat_app').error('repeated_init');return;}this._rootElem=u;l.resolve().then(function(){return i.init();}).then(function(){return p();}).then(function(){return q(w);}).then(function(){return r(v,u);}).then(function(){return s();}).then((function(){this._isInitialized=this._isLoaded=true;i.logTTI();}).bind(this)).then(function(){return t(w);});},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;h.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){h.show(this._rootElem);this.tabsViewport.checkWidth();e(['Dock'],function(u){u.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){e(['UIPagelet'],function(u){u.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');u.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};function p(){return new l(function(u){e(['MercuryBlockedParticipants','MercuryChannelHandler','MercuryDelayedRoger','MercuryDeliveryReceipts','MercuryDeliveryState','MercuryParticipants','MercuryStateCheck','MercuryThreads','MercuryUnreadState','MercuryUnseenState'],function(v,w,x,y,z,aa,ba,ca,da,ea){v.get();w.get().turnOn();x;y.get();z.get();aa;ca.get();ea.get();da.get();ba.get();u();});});}function q(u){return new l(function(v){e(['MercuryServerPayloadPreprocessor'],function(w){w.get().handleUpdate(u);v();});});}function r(u,v){return new l(function(w){e(['ChatTabController','ChatTabViewCoordinator','TabsViewport','MNCommerceDialogContainer.react','P2PDialogContainer.react'],function(x,y,z,aa,ba){o.tabsViewport=new z(u);o.tabViewCoordinator=new y(u,o.tabsViewport);o.tabController=new x(o.tabsViewport);var ca=j.find(v,"._26-x");m.render(m.createElement(aa,null),ca);var da=j.find(v,"._26-y");m.render(m.createElement(ba,null),da);w();});});}function s(){return new l(function(u){e(['HotLikeSound','ChatOptions'],function(v,w){v.setCheckSoundEnabledFunc(function(){return w.getSetting('sound');});u();});});}function t(u){return new l(function(v){if(!u.threads_to_auto_open||!o.tabsViewport.hasRoomForRaisedTab())v();e(['ChatOpenTab'],function(w){w.openThread(u.threads_to_auto_open.thread_fbid,"autoOpenTab",'',null,true);v();});});}f.exports=o;},null);