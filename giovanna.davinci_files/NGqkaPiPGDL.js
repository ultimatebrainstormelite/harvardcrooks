/*!CK:34316151!*//*1439790638,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["qMBbW"]); }

__d('ChatSidebarDropdownConstants',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={SOUND:'sound',ADVANCED_SETTINGS:'advanced_settings',TURN_OFF_DIALOG:'turn_off_dialog',CLOSE_ALL_TABS:'close_all_tabs',SIDEBAR:'sidebar',HIDE_GROUPS:'hide_groups',ONLINE:'online',VIDEOCALL_ON:'videoon',VIDEOCALL_OFF:'videooff',PAUSE:'pause',SHOW_APPS:'show_apps',HIDE_APPS:'hide_apps',SHOW_TICKER:'show_ticker',HIDE_TICKER:'hide_ticker'};f.exports=h;},null);
__d('ChatSidebarSheetChatOffline.react',['Link.react','React','ReactComponentWithPureRenderMixin','fbt'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();'use strict';var l=i.PropTypes,m=i.createClass({displayName:'ChatSidebarSheetChatOffline',mixins:[j],propTypes:{onGoOnlineClick:l.func.isRequired},render:function(){return (i.createElement('div',null,k._("{=Go online} to see who's available.",[k.param('=Go online',i.createElement(h,{className:'fbChatGoOnlineLink',onClick:this.props.onGoOnlineClick},k._("Turn on chat")))])));}});f.exports=m;},null);
__d('ChatSidebarSheet',['ArbiterMixin','ChannelConnection','ChannelConstants','ChatBehavior','ChatSidebarSheetChatOffline.react','ChatSidebarSheetChatReconnectMsg.react','ChatSidebarSheetChatShutdownMsg.react','ChatVisibility','CSS','DOM','Event','JSLogger','PresencePrivacy','React','fbt','mixin','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){if(c.__markCompiled)c.__markCompiled();var y,z,aa=s.create('sidebar_sheet');function ba(ea,fa){return u.render(u.createElement(n,{hint:ea}),fa);}function ca(ea,fa){return u.render(u.createElement(m,{msecs:ea}),fa);}y=w(h);z=y&&y.prototype;Object.assign(da,y);da.prototype=Object.create(y.prototype);da.prototype.constructor=da;da.__superConstructor__=y;function da(ea){'use strict';z.constructor.call(this);this._root=ea;this._message=q.find(ea,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));t.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}da.prototype._handleConnectionChange=function(ea,fa){'use strict';this._channelStatus=ea;this._channelData=fa;this._render();};da.prototype._renderChannelDisconnect=function(){'use strict';if(this._channelStatus===i.SHUTDOWN){return ba(this._channelData,this._message);}else if(this._channelStatus===i.RECONNECTING){var ea=this._channelData;ca(ea,this._message);if(ea>1000){if(ea>j.WARNING_COUNTDOWN_THRESHOLD_MSEC)this._warningMsgEventListener=r.listen(this._message,'click',function(event){if(p.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=x(this._handleConnectionChange.bind(this,i.RECONNECTING,ea-1000),1000);}}};da.prototype._renderOffline=function(){'use strict';return u.render(u.createElement(l,{onGoOnlineClick:function(ea){aa.log('sidebar_go_online');o.goOnline();}}),this._message);};da.prototype._clear=function(){'use strict';if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}p.removeClass(this._root,'offline');p.removeClass(this._root,'error');p.removeClass(this._root,'notice');q.empty(this._message);};da.prototype._render=function(){'use strict';this._clear();if(!o.isOnline()){p.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){p.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){p.addClass(this._root,'notice');var ea=v._("Alerts are off while you use another client to chat.");q.setContent(this._message,ea);}this.inform('updated');};Object.assign(da.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});f.exports=da;},null);
__d('ChatSidebarDropdown.react',['AppsDivebarDisplayController','Arbiter','AsyncRequest','ChatVisibility','ChatConfig','ChatOptions','ChatSidebarDropdownConstants','ChatTabActions','ContextualDialogArrow','ContextualLayerAutoFlip','FBRTCCallBlockingStore','Link.react','LogHistory','MenuSeparator.react','PopoverMenu.react','PresencePrivacy','PresenceState','ReactComponentWithPureRenderMixin','React','ReactXUIMenu','SidebarType','SubscriptionsHandler','TrackingNodes','URI','VideoCallSupport','cx','emptyFunction','fbt','ge','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){if(c.__markCompiled)c.__markCompiled();'use strict';var la=aa.Item,ma=aa.SelectableItem,na=aa.SelectableMenu,oa=z.PropTypes,pa=t.getInstance('blackbird'),qa=z.createClass({displayName:'ChatSidebarDropdown',mixins:[y],propTypes:{className:oa.string,onHide:oa.func,onShow:oa.func,onToggleSidebar:oa.func.isRequired,sidebarType:oa.string.isRequired},getDefaultProps:function(){return {className:'',onHide:ha,onShow:ha};},getInitialState:function(){return {appsVisible:h.isVisible(),isOnline:k.isOnline(),isTickerVisible:this._getTickerVisibility(),isCallBlocked:r.getBlockingStatus(),pendingChange:false};},componentDidMount:function(){this._subscriptions=new ca();this._subscriptions.addSubscriptions(i.subscribe(['Ticker/resized','ticker/show'],(function(){this.setState({isTickerVisible:this._getTickerVisibility()});}).bind(this)),i.subscribe(['AppsDivebar/show-apps','AppsDivebar/hide-apps'],(function(){this.setState({appsVisible:h.isVisible()});}).bind(this)),w.subscribe('privacy-user-presence-changed',(function(){this.setState({isOnline:k.isOnline()});}).bind(this)),i.subscribe(['sidebar/hide','buddylist/hide'],(function(){this.refs.menu.hidePopover();}).bind(this)),r.addListener((function(){this.setState({isCallBlocked:r.getBlockingStatus()});}).bind(this)));},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();},_getTickerVisibility:function(){var ra=ja('pagelet_ticker');return !!(ra&&ra.offsetHeight!==0);},_logVisibilityChange:function(ra,sa){var ta=sa?'sidebar_dropdown_visibility_error':'sidebar_dropdown_set_visibility';pa.debug(ta,{action:ra});},_changeSetting:function(ra,sa){if(this.state.pendingChange)return;this.setState({pendingChange:true});var ta={};ta[ra]=!sa;m.setSetting(ra,!sa,'mini_sidebar_menu');new j('/ajax/chat/settings.php').setHandler(x.doSync).setErrorHandler(function(){return m.setSetting(ra,sa,'mini_sidebar_menu_error');}).setFinallyHandler((function(){return this.setState({pendingChange:false});}).bind(this)).setData(ta).setAllowCrossPageTransition(true).send();},_onClickOption:function(ra,sa){var ta=true;switch(ra){case n.SOUND:this._changeSetting(ra,sa);break;case n.ADVANCED_SETTINGS:case n.TURN_OFF_DIALOG:i.inform('chat/advanced-settings-dialog-opened');this._logVisibilityChange(ra,false);break;case n.CLOSE_ALL_TABS:o.closeAllTabs();this._logVisibilityChange(ra,false);break;case n.HIDE_GROUPS:this._changeSetting(ra,sa);break;case n.SIDEBAR:this.props.onToggleSidebar();ta=false;break;case n.ONLINE:!this.state.isOnline?k.goOnline():this._logVisibilityChange(ra,true);break;case n.VIDEOCALL_ON:r.turnOnVideoCalling();break;case n.VIDEOCALL_OFF:break;case n.PAUSE:break;case n.SHOW_TICKER:i.inform('ChatSidebarDropdown/openTicker');break;case n.HIDE_TICKER:i.inform('ChatSidebarDropdown/closeTicker');break;case n.SHOW_APPS:h.showApps();break;case n.HIDE_APPS:h.hideApps();break;}if(ta&&this.refs.menu)this.refs.menu.hidePopover();},_onItemClick:function(ra,sa){var ta=sa.item.getValue(),ua=sa.item.isSelected&&sa.item.isSelected();this._onClickOption(ta,!!ua);},_renderChatSoundOption:function(){return (z.createElement(ma,{value:n.SOUND,selected:m.getSetting(n.SOUND)},ia._("Chat Sounds")));},_renderAdvancedSettingsOption:function(){return (z.createElement(la,{href:new ea('/ajax/chat/privacy/settings_dialog.php'),rel:'dialog',value:n.ADVANCED_SETTINGS},ia._("Advanced Settings...")));},_renderCloseAllOption:function(){return (z.createElement(la,{value:n.CLOSE_ALL_TABS},ia._("Close All Chat Tabs")));},_renderHideSidebarOption:function(){return (z.createElement(la,{className:"_2xvi",value:n.SIDEBAR},ia._("Hide Sidebar")));},_renderHideGroupsOption:function(){if(this.props.sidebarType===ba.MINI_SIDEBAR)return null;return (z.createElement(ma,{value:n.HIDE_GROUPS,selected:m.getSetting(n.HIDE_GROUPS)},ia._("Hide Groups")));},_renderOnlineOption:function(){var ra=k.isOnline(),sa=ra?new ea('/ajax/chat/privacy/settings_dialog.php').addQueryData('dialog_type','turn_off_dialog'):'#',ta=ra?ia._("Turn Off Chat"):ia._("Turn On Chat"),ua=ra?n.TURN_OFF_DIALOG:n.ONLINE;return (z.createElement(la,{href:sa,rel:ra?'dialog':'',value:ua},ta));},_renderVideoCallingOption:function(){if(!fa.isVideoCallBlockingSupported())return;var ra=this.state.isCallBlocked,sa=ra?'#':new ea('/videocall/off/'),ta=ra?ia._("Turn On Video Calling"):ia._("Turn Off Video Calling"),ua=ra?n.VIDEOCALL_ON:n.VIDEOCALL_OFF;return (z.createElement(la,{href:sa,rel:ra?'':'dialog',value:ua},ta));},_renderAppsOption:function(){if(!l.get('has_apps_option')||this.props.sidebarType!==ba.SIDEBAR)return null;var ra=this.state.appsVisible,sa=ra?ia._("Hide Games"):ia._("Show Games"),ta=ra?n.HIDE_APPS:n.SHOW_APPS;return [z.createElement(u,{key:'apps_separator'}),z.createElement(la,{value:ta,key:'apps_menu'},sa)];},_renderTickerToggleOption:function(){if(!l.get('has_ticker_toggle_option')||this.props.sidebarType!==ba.SIDEBAR)return null;var ra=this.state.isTickerVisible,sa=ra?ia._("Hide Ticker"):ia._("Show Ticker"),ta=ra?n.HIDE_TICKER:n.SHOW_TICKER;return [z.createElement(u,{key:'ticker_separator'}),z.createElement(la,{value:ta,key:'ticker_menu'},sa)];},_renderMenu:function(){return (z.createElement(na,{className:'fbChatSidebarDropdown/PopoverMenu',multiple:true,onItemClick:this._onItemClick},this._renderChatSoundOption(),this._renderAdvancedSettingsOption(),z.createElement(u,null),this._renderCloseAllOption(),this._renderHideSidebarOption(),this._renderHideGroupsOption(),this._renderOnlineOption(),this._renderVideoCallingOption(),this._renderAppsOption(),this._renderTickerToggleOption()));},render:function(){var ra=l.get('divebar_new_design',false),sa=ia._("Options"),ta=ka(this.props.className,"_5qth"+(' '+"_5vm9")+(!k.isOnline()?' '+"_5vma":'')+(ra?' '+"_ggq":'')),ua=da.getTrackingInfo(da.types.DROPDOWN_BUTTON);return (z.createElement(v,{alignh:'right',alignv:'top',className:ta,layerBehaviors:[q,p],menu:this._renderMenu(),onHide:this.props.onHide,onShow:this.props.onShow,ref:'menu'},z.createElement(s,{'aria-label':sa,className:"_5vmb button",'data-ft':ua,'data-hover':'tooltip',href:'#'})));}});f.exports=qa;},null);