/*!CK:1918018545!*//*1439790638,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["1A0P4"]); }

__d('loadImage',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,j){var k=new Image();k.onload=function(){j(k.width,k.height,k);};k.src=i;}f.exports=h;},null);
__d('PhotoResizeMath',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={getScaledPhotoDimensions:function(i,j,k,l,m){var n=i/j,o=k/l;if(k&&l&&m==='stretch')return {width:k,height:l};if(!k&&l||m==='contain'!==n>=o)return {width:l*n,height:l};if(k)return {width:k,height:k/n};return {width:i,height:j};}};f.exports=h;},null);
__d('PixelzFocus',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';var h={search:function(i,j){var k=0,l=i.length-1;while(k<=l){var m=k+Math.floor((l-k)/2),n=i[m];if(n>j){l=m-1;}else if(n<j){k=m+1;}else return m;}return Math.min(k,l);},forceSpecificPoint:function(i,j,k){var l=1e-09,m=h.search(i,j-k-l)+1,n=h.search(i,j+k);return i.slice(m,n+1);},findBiggestSets:function(i,j){var k=[],l=-1;for(var m=0;m<i.length;++m){var n=i[m],o=m,p=h.search(i,n+j),q=p-o;if(q>l)k=[];if(q>=l){l=q;k.push({low:o,high:p});}}return k;},getBestSet:function(i,j,k){var l=-1,m=null;for(var n=0;n<j.length;++n){var o=j[n],p=i[o.low],q=i[o.high],r=p+(q-p)/2,s=Math.min(p-(r-k),r+k-q);if(s>l){l=s;m=o;}}return m;},getFocusFromSet:function(i,j){var k=i[j.low],l=i[j.high];return k+(l-k)/2;},clampFocus:function(i,j){var k=j/2,l=1-j/2;if(i<k)return k;if(i>l)return l;return i;},convertFromCenterToCSS:function(i,j){if(Math.abs(1-j)<1e-05)return 0;return (i-j/2)/(1-j);},convertFromCSSToCenter:function(i,j){return i*(1-j)+j/2;},getVisible:function(i,j){if(i<j)return i/j;return j/i;},getHidden:function(i,j){return 1-h.getVisible(i,j);},focusHorizontally:function(i,j){return i<j;},convertVectorFromCenterToCSS:function(i,j,k){var l=h.focusHorizontally(j,k),m;if(l){m=i.x/100;}else m=i.x/100;var n=h.convertFromCenterToCSS(m,h.getVisible(j,k));if(l){return {x:n,y:0};}else return {x:0,y:n};},getCropRect:function(i,j,k){var l=h.focusHorizontally(j,k),m=h.getVisible(j,k);if(l){var n=(1-m)*i.x;return {left:n,top:0,width:m,height:1};}else{var o=(1-m)*i.y;return {left:0,top:o,width:1,height:m};}}};f.exports=h;},null);
__d('Pixelz.react',['arrayContains','cx','loadImage','joinClasses','React','PhotoResizeMath','PixelzFocus'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n){if(c.__markCompiled)c.__markCompiled();'use strict';var o=Object.assign||function(r){for(var s=1;s<arguments.length;s++){var t=arguments[s];for(var u in t)if(Object.prototype.hasOwnProperty.call(t,u))r[u]=t[u];}return r;},p=l.PropTypes,q=l.createClass({displayName:'Pixelz',propTypes:{width:p.number,height:p.number,resizeMode:p.oneOf(['contain','cover','stretch']),alt:p.string,letterbox:p.bool,borderRadius:p.number,insetBorderColor:p.string,animated:p.bool,upscale:p.bool,cropRect:function(r,s,t){var u=r[s],v='Invalid prop `'+s+'` supplied to `'+t+'`, expected a rectangle with values normalized '+'between 0 and 1.';if(u.left<0||u.top<0||u.width<0||u.height<0||u.left+u.width>1||u.top+u.height>1)return new Error(v);},focus:function(r,s,t){var u=r[s],v='Invalid prop `'+s+'` supplied to `'+t+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1.';if(Array.isArray(u)){for(var w=0;w<u.length;++w)if(!(u[w].x>=0&&u[w].x<=1)||!(u[w].y>=0&&u[w].y<=1))return new Error(v);}else{if(!u.type)u.type='css';if(!(u.x>=0&&u.x<=1)||!(u.y>=0&&u.y<=1)||!h(['center','css'],u.type))return new Error(v);}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var r=this.props.src,s=this.state.srcDimensions[r];if(s)return s;j(r,(function(t,u){var v={};v[r]={width:t,height:u};this.isMounted()&&this.setState({srcDimensions:v});}).bind(this));return null;},getCropSrcDimensions:function(){var r=this.getSrcDimensions();return {width:r.width*this.props.cropRect.width,height:r.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var r=this.getCropSrcDimensions();return m.getScaledPhotoDimensions(r.width,r.height,this.props.width,this.props.height,this.props.resizeMode);},getCropDimensions:function(){var r=this.getUpscaleCropDimensions(),s=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(r.width,s.width),height:Math.min(r.height,s.height)};return r;},getCropAspectRatio:function(){var r=this.getCropDimensions();return r.width/r.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var r=this.getContainerDimensions();return r.width/r.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var r=this.props.focus;if(!Array.isArray(r)&&r.type==='css')return {x:r.x,y:r.y};var s=this.getContainerAspectRatio(),t=this.getCropAspectRatio(),u=n.getVisible(s,t),v=n.focusHorizontally(s,t),w;if(!Array.isArray(r)){w=n.convertFromCenterToCSS(v?r.x:r.y,u);}else{var x=r.map(function(aa){return v?aa.x:aa.y;});x.sort();var y=n.findBiggestSets(x,u),z=n.getBestSet(x,y,u);w=n.getFocusFromSet(x,z);}return {x:v?w:.5,y:v?.5:w};},getCropPosition:function(){var r=this.getCropDimensions(),s=this.getContainerDimensions(),t=this.getFocus();return {left:t.x*(s.width-r.width),top:t.y*(s.height-r.height)};},getScaleDimensions:function(){var r=this.getCropDimensions();return {width:r.width/this.props.cropRect.width,height:r.height/this.props.cropRect.height};},getScalePosition:function(){var r=this.getScaleDimensions();return {left:-r.width*this.props.cropRect.left,top:-r.height*this.props.cropRect.top};},getClipCropRectangle:function(){var r=this.getContainerDimensions(),s=this.getCropDimensions(),t=this.getContainerPosition(),u=this.getCropPosition(),v=Math.max(t.left,u.left),w=Math.max(t.top,u.top),x=Math.min(t.top+r.height,u.top+s.height),y=Math.min(t.left+r.width,u.left+s.width);return {left:v,top:w,width:y-v,height:x-w};},getClipCropPosition:function(){var r=this.getClipCropRectangle();return {left:r.left,top:r.top};},getClipCropDimensions:function(){var r=this.getClipCropRectangle();return {width:r.width,height:r.height};},getClipScalePosition:function(){var r=this.getScalePosition(),s=this.getClipCropPosition(),t=this.getCropPosition();return {left:r.left+(t.left-s.left),top:r.top+(t.top-s.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(r,s){return r.width===s.width&&r.height===s.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var r=this.getContainerDimensions(),s=this.getClipCropDimensions(),t=this.getClipScaleDimensions();if(this.areDimensionsEqual(r,s)||this.areDimensionsEqual(s,t))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var r=this.getContainerDimensions(),s=this.getClipScaleDimensions();if(this.areDimensionsEqual(r,s))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(r,s){if(this.shouldAddAllNodesAndStyles()||s.left)r.left=Math.round(s.left);if(this.shouldAddAllNodesAndStyles()||s.top)r.top=Math.round(s.top);},applyDimensionsStyle:function(r,s){r.width=Math.round(s.width);r.height=Math.round(s.height);},applyBorderRadiusStyle:function(r){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)r.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var r={},s=this.getClipCropDimensions(),t=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(s,t)){this.applyPositionStyle(r,this.getClipScalePosition());}else this.applyPositionStyle(r,this.getClipCropPosition());this.applyDimensionsStyle(r,this.getClipScaleDimensions());this.applyBorderRadiusStyle(r);return r;},getCropStyle:function(){var r={};this.applyPositionStyle(r,this.getClipCropPosition());this.applyDimensionsStyle(r,this.getClipCropDimensions());this.applyBorderRadiusStyle(r);return r;},getInsetBorderStyle:function(){var r={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(r,this.getClipCropPosition());this.applyDimensionsStyle(r,this.getClipCropDimensions());this.applyBorderRadiusStyle(r);return r;},getContainerStyle:function(){var r={};this.applyDimensionsStyle(r,this.getContainerDimensions());this.applyBorderRadiusStyle(r);return r;},getScale:function(){var r=this.getScaleStyle(),s=r.width,t=r.height;r=o({},r);delete r.width;delete r.height;return (l.createElement('img',o({},this.props,{alt:this.props.alt,className:k(this.props.className,"_56wb"+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),src:this.props.src,style:o({},this.props.style||{},r),width:s,height:t})));},getCrop:function(){var r=this.getScale();if(!this.hasCrop())return r;return (l.createElement('div',{className:"_56ma"+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''),style:this.getCropStyle()},r));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.createElement('div',{className:"_56lv"+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''),style:this.getInsetBorderStyle()}));},getContainer:function(){var r=this.getCrop();if(!this.hasContainer())return r;var s=this.getInsetBorder();return (l.createElement('div',{className:"_56jj"+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":''),style:this.getContainerStyle()},r,s));},render:function(){var r=this.getSrcDimensions();if(!r)return l.createElement('span',null);return this.getContainer();}});f.exports=q;},null);
__d('XComposerPhotoUploader',['AsyncUploadRequest','FileInputUploader','JSLogger','PhotosMimeType','PhotosUploadID','createArrayFromMixed','curry','emptyFunction','performanceNow'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){if(c.__markCompiled)c.__markCompiled();'use strict';function q(r){this.$XComposerPhotoUploader1=r.uploadData||{};this.$XComposerPhotoUploader2=r.uploadEndpoint;this.$XComposerPhotoUploader3=r.retryLimit;this.$XComposerPhotoUploader4=r.concurrentLimit;this.$XComposerPhotoUploader5=r.resizer;this.$XComposerPhotoUploader6=r.onUploadEnqueued||o;this.$XComposerPhotoUploader7=r.onUploadsEnqueued||o;this.$XComposerPhotoUploader8=r.onResizeStart||o;this.$XComposerPhotoUploader9=r.onResizeProgress||o;this.$XComposerPhotoUploader10=r.onResizeSuccess||o;this.$XComposerPhotoUploader11=r.onResizeFailure||o;this.$XComposerPhotoUploader12=r.onUploadSent||o;this.$XComposerPhotoUploader13=r.onUploadStart||o;this.$XComposerPhotoUploader14=r.onUploadProgress||o;this.$XComposerPhotoUploader15=r.onUploadSuccess||o;this.$XComposerPhotoUploader16=r.onUploadFailure||o;this.$XComposerPhotoUploader17=j.create('composer');}q.prototype.upload=function(r){var s=Object.assign({},this.$XComposerPhotoUploader1),t=null;if(!this.$XComposerPhotoUploader18(r)){var u=l.getNewID();r.uploadID=u;s.upload_id=u;this.$XComposerPhotoUploader6({uploadID:u,fileName:r.value.split('/').pop().split('\\').pop()});}else{t=m(r.files);t.forEach((function(x){if(!x.uploadID)x.uploadID=l.getNewID();this.$XComposerPhotoUploader6({uploadID:x.uploadID,fileName:x.name});}).bind(this));}this.$XComposerPhotoUploader7();var v=new i(r).setURI(this.$XComposerPhotoUploader2).setData(s).setAllowCrossOrigin(true).setNetworkErrorRetryLimit(this.$XComposerPhotoUploader3).setUploadInParallel(true);if(t&&t.length>0){v.setFiles({farr:t});if(this.$XComposerPhotoUploader5)v.setPreprocessHandler(this.$XComposerPhotoUploader19.bind(this));if(this.$XComposerPhotoUploader4)v.setConcurrentLimit(this.$XComposerPhotoUploader4);}v.subscribe('progress',(function(x,y){return (this.$XComposerPhotoUploader14(this.$XComposerPhotoUploader20(y,r),y));}).bind(this));v.subscribe('failure',(function(x,y){return (this.$XComposerPhotoUploader16(this.$XComposerPhotoUploader20(y,r),y,t));}).bind(this));v.subscribe('start',(function(x,y){return (this.$XComposerPhotoUploader13(this.$XComposerPhotoUploader20(y,r),y));}).bind(this));v.subscribe('success',(function(x,y){return (this.$XComposerPhotoUploader15(this.$XComposerPhotoUploader20(y,r),y));}).bind(this));try{v.send();this.$XComposerPhotoUploader12(r);}catch(w){this.$XComposerPhotoUploader17.error('error_send_unpublished_files',w);throw w;}};q.prototype.getAsyncUploadRequest=function(r,s){var t=new h().setData(Object.assign({},s&&s.data,this.$XComposerPhotoUploader1)).setFiles({farr:r}).setAllowCrossOrigin(true).setURI(this.$XComposerPhotoUploader2);if(this.$XComposerPhotoUploader4)t.setLimit(this.$XComposerPhotoUploader4);if(this.$XComposerPhotoUploader5)t.setPreprocessHandler(this.$XComposerPhotoUploader19.bind(this));t.subscribe('start',(function(u,v){return (this.$XComposerPhotoUploader13(v.getFile().uploadID,{upload:v}));}).bind(this));t.subscribe('progress',(function(u,v){return (this.$XComposerPhotoUploader14(v.getFile().uploadID,{upload:v,event:v.getProgressEvent()}));}).bind(this));t.subscribe('success',(function(u,v){return (this.$XComposerPhotoUploader15(v.getFile().uploadID,{upload:v,response:v.getResponse()}));}).bind(this));t.subscribe('failure',(function(u,v){return (this.$XComposerPhotoUploader16(v.getFile().uploadID,{upload:v,response:v.getResponse()},r));}).bind(this));return t;};q.prototype.$XComposerPhotoUploader20=function(r,s){if(r.upload){return r.upload.getFile().uploadID;}else return s.uploadID;};q.prototype.$XComposerPhotoUploader19=function(r,s){var t=r.getFile();if(!t||!k(t.type).isJpeg())return s(r);var u=p();this.$XComposerPhotoUploader8(t);this.$XComposerPhotoUploader5.resizeBlob(t,(function(v,w,x){w=w||t;if(v){var y=p()-u;this.$XComposerPhotoUploader11(t,w,v,y);return s(r);}w.uploadID=t.uploadID;w.filename=t.name;r.setFile(w);this.$XComposerPhotoUploader10(t,w,x,p()-u);s(r);}).bind(this),n(this.$XComposerPhotoUploader9,t.uploadID));};q.prototype.$XComposerPhotoUploader18=function(r){return !!r.files&&h.isSupported();};f.exports=q;},null);
__d('updatePhotoProgressBar',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();'use strict';function h(i,event){if(event.loaded!=event.total){i.setPosition(50*event.loaded/event.total);}else{i.setPosition(50);i.setTarget(100,2000);}}f.exports=h;},null);
__d('BanzaiScribe',['Banzai'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(k){return {log:function(l,m,n){var o=[m];if(n!=null)o.push(n);h.post('scribe:'+l,o,k);}};}var j=i({});j.create=i;f.exports=j;},null);
__d('SamplingPolicyBase',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){'use strict';throw 'Tried to instantiate SamplingPolicyBase';}h.prototype.getName=function(){'use strict';return this.name;};h.prototype.isSampled=function(){'use strict';if(typeof this.sampled=='undefined')this.sampled=this.decideIfSampled();return this.sampled;};f.exports=h;},null);
__d('FbtraceForcedByServerPolicy',['FbtraceForcedByServer','SamplingPolicyBase'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();'use strict';var j;function k(){this.name='FbtraceForcedByServerPolicy';}k.get=function(){if(typeof j=='undefined')j=new k();return j;};function l(){return h.forced;}Object.assign(k.prototype,i.prototype,{decideIfSampled:l});f.exports=k;},null);
/**
 * @generated SignedSource<<623c7cbcff19956af736c3d064fc689d>>
 *
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 * !! This file is a check-in of a static_upstream project!      !!
 * !!                                                            !!
 * !! You should not modify this file directly. Instead:         !!
 * !! 1) Use `fjs use-upstream` to temporarily replace this with !!
 * !!    the latest version from upstream.                       !!
 * !! 2) Make your changes, test them, etc.                      !!
 * !! 3) Use `fjs push-upstream` to copy your changes back to    !!
 * !!    static_upstream.                                        !!
 * !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 *
 * Copyright (C) 2010 by Johannes Baagoe <baagoe@baagoe.org>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @providesModule Alea
 * @preserve-header
 */__d('Alea',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){var j=4022871197,k=function(l){l=l.toString();for(var m=0;m<l.length;m++){j+=l.charCodeAt(m);var o=.02519603282416938*j;j=o>>>0;o-=j;o*=j;j=o>>>0;o-=j;j+=o*4294967296;}return (j>>>0)*2.3283064365386963e-10;};k.version='Mash 0.9';return k;}function i(){return (function(j){var k=0,l=0,m=0,n=1;if(j.length===0)j=[new Date()];var o=new h();k=o(' ');l=o(' ');m=o(' ');for(var p=0;p<j.length;p++){k-=o(j[p]);if(k<0)k+=1;l-=o(j[p]);if(l<0)l+=1;m-=o(j[p]);if(m<0)m+=1;}o=null;var q=function(){var r=2091639*k+n*2.3283064365386963e-10;k=l;l=m;m=r-(n=r|0);return m;};q.version='Alea 0.9';q.args=j;return q;})(Array.prototype.slice.call(arguments));}f.exports=i;},null);
__d('Random',['Alea','ServerNonce'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();'use strict';var i=c('ServerNonce').ServerNonce,j=h(i),k={random:j,uint32:function(){return Math.floor(j()*4294967296);}};f.exports=k;},null);
__d("guardFunction",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){return function(){if(i.apply(k||this,arguments))j.apply(k||this,arguments);};}f.exports=h;},null);
__d('Fbtrace',['Arbiter','BanzaiScribe','ErrorUtils','FbtraceForcedByServer','FbtraceForcedByServerPolicy','Random','SiteData','guardFunction'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){if(c.__markCompiled)c.__markCompiled();var p=Object.assign||function(ja){for(var ka=1;ka<arguments.length;ka++){var la=arguments[ka];for(var ma in la)if(Object.prototype.hasOwnProperty.call(la,ma))ja[ma]=la[ma];}return ja;},q,r;'use strict';var s='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',t='AAAAAAAAAAA';q=Error;r=q&&q.prototype;Object.assign(u,q);u.prototype=Object.create(q.prototype);u.prototype.constructor=u;u.__superConstructor__=q;function u(ja){r.constructor.call(this,ja);}function v(ja){j.reportError(new u(ja));}function w(){var ja=function(){var ma=0,na=0,oa='';for(var pa=10;pa>=0;pa--){if(ma<6){na=m.uint32();ma=32;}if(pa===0)na=na&7;oa=s.charAt(na&63)+oa;na>>=6;ma-=6;}return oa;},ka,la;for(ka=3;ka>0;ka--){la=ja();if(la!=t)return la;}v('failed to generate valid Fbtrace id');return t;}function x(){Object.assign(this,x);}Object.assign(x,{isOn:function(){return false;},replySend:function(ja,ka){},requestSend:function(ja,ka,la){da(ja,ka);return {metadata:function(){return undefined;},replyReceive:function(ma){}};}});var y=new x();function z(ja,ka,la){if(!ja)throw {name:'ArgumentError',message:'no valid service name specified'};if(!ka)throw {name:'ArgumentError',message:'no valid version specified'};var ma=i,na=0,oa=w(),pa=w(),qa=ca(oa),ra={service:ja,version:ka},sa=function(xa){if(typeof xa=='undefined')return 'undefined';if(typeof xa!='string')xa=sa(JSON.stringify(xa));return xa;},ta=function(xa){var ya='';for(var za in xa){if(ya.length>0)ya+='\x02';ya+=sa(za)+'\x03'+sa(xa[za]);}return ya;},ua=function(xa,ya,event,za,ab){na++;return [ab,na,oa,xa,ya,sa(event),ta(za)].join('\x01');},va=function(xa,ya,event,za,ab){if(!ab&&typeof ab=='undefined')ab=Date.now()*1000;var bb=ua(xa,ya,event,za,ab);ma.log('fbtrace',bb,qa);},wa=function(){return pa;};va(t,pa,'#rqrecv',Object.assign(la||{},ra));Object.assign(this,z,{replySend:function(xa,ya){ya=p({},ya,ra,{success:xa?'true':'false'});va(t,pa,'#rpsend',ya);},requestSend:function(xa,ya,za){da(xa,ya);var ab=wa(),bb=w();za=p({},za,ra,{op:xa,'remote:service':ya});va(ab,bb,'#rqsend',za);return {metadata:function(){return oa+bb;},replyReceive:function(cb){va(ab,bb,'#rprecv',Object.assign(cb||{},ra));},parentNode:this};}});}Object.assign(z,{isOn:function(){return true;}});function aa(){return y;}function ba(ja,ka,la){la=la||{};la.init=true;var ma=l.get();if(ma.isSampled()){return new z(ja,ka,la);}else return new x();}function ca(ja){var ka=ja.charAt(ja.length-1);return s.indexOf(ka)%32;}function da(ja,ka){if(!ja)throw {name:'ArgumentError',message:'no valid operation specified'};if(!ka)throw {name:'ArgumentError',message:'no valid remote:service specified'};}function ea(ja,ka){var la=y,ma;y=ja;try{ma=ka();}finally{y=la;}return ma;}var fa=function(ja,ka){var la=aa(),ma=ka.request,na=false;if(!la.isOn()&&k.forced&&/\/upload\/(?:composer|photos)\/|\/ajax\/composerx\/attachment\/media\//.test(ma.uri.toString())){la=ba('photo_upload_kludge',String(n.revision||'dev'),{policy:'PhotoUpload'});na=true;}if(la.isOn()){var oa=na?{policy:'PhotoUpload'}:{};if(ma.userActionId)oa.user_action_id=ma.userActionId;var pa=la.requestSend(ma.uri.toString(),'www',oa);ma.fbtraceRemoteNode=pa;ma.transport.setRequestHeader('X-Fbtrace-Meta',pa.metadata());}},ga=function(ja,ka){ka.request.fbtraceRemoteNode.replyReceive({is_last:ka.response.is_last,success:true});setTimeout(function(){ka.request.fbtraceRemoteNode.parentNode.replySend(true,{});},0);},ha=function(ja,ka){ka.request.fbtraceRemoteNode.replyReceive({is_last:ka.response.is_last,success:false,error_code:ka.response.error,error_summary:ka.response.errorSummary,error_description:ka.response.errorDescription});setTimeout(function(){ka.request.fbtraceRemoteNode.parentNode.replySend(false,{});},0);},ia=function(ja,ka){return ka.request.fbtraceRemoteNode;};h.subscribe('AsyncRequest/will_send',fa);h.subscribe('AsyncRequest/response',o(ia,ga));h.subscribe('AsyncRequest/error',o(ia,ha));f.exports={defaultNode:aa,requestReceive:ba,withDefaultNode:ea};},null);
__d('PhotosMultiUploadInput',['Arbiter','Animation','AsyncUploadRequest','ComposerWaterfallEvent','ComposerXController','ComposerXDragDropUtils','ComposerXMarauderLogger','ComposerXMediaUploadHandler','CSS','Dialog','DOM','DragDropTarget','Event','JpegResizer','Parent','PhotosMimeType','PhotosUploadID','PhotosUploadWaterfallXMixin','PUWApplications','PUWMethods','PUWSteps','ProgressBar','Tooltip','WaterfallIDGenerator','XComposerPhotoUploader','$','csx','cx','mixin','performanceNow','fbt','updatePhotoProgressBar','Fbtrace'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){if(c.__markCompiled)c.__markCompiled();var na,oa,pa=1366052;c("Fbtrace");function qa(wa,xa,ya,za){'use strict';this._grid=ta.getInstance(za.gridID);this._grid.setProgressBarMarkup(wa).setVideoIconMarkup(xa).setConfig(za);ya.getInput().multiple=za.maxselect!=1&&j.isSupported();ya.subscribe('change',(function(ab,event){if(event.getTarget().value)this._grid.doFileUpload(ya);}).bind(this));if(!this._grid.sessionStarted){this._grid.sessionStarted=true;this._grid.logStep(ba.CLIENT_FLOW_BEGIN,{custom_tags:{high_quality:za.initWithHighQuality}});}this._grid.logStep(ba.CLIENT_SELECT_BEGIN);h.inform('PhotosMultiUploadInput/loaded/'+za.gridID,null,h.BEHAVIOR_PERSISTENT);}qa.prototype.getGrid=function(){'use strict';return this._grid;};qa.prototype.onQualitySettingChanged=function(wa){'use strict';this._grid.setQuality(wa);};Object.assign(qa,{imageUploadDone:function(wa,xa,ya,za,ab){ra[wa].imageUploadDone(xa,ya,za,ab);},addCameraImage:function(wa,xa,ya){ra[wa].addCameraImage(xa,ya);},initDragDrop:function(wa,xa){h.inform('PhotosMultiUploadInput/initDragDrop/'+wa,{dragDropArea:xa},h.BEHAVIOR_PERSISTENT);},imageUploadFail:function(wa,xa){ra[wa].removeLoadingIndicator(xa.getFile().uploadID);},doFileUpload:function(wa,xa){ra[wa].doFileUpload(xa);},onFilesDrop:function(wa,xa){ra[wa].onFilesDrop(xa);},getWaterfallID:function(wa){return ta.getInstance(wa).getWaterfallID();},clearSession:function(wa){ra[wa].clearSession();},getConfig:function(wa){return ra[wa].getConfig();}});var ra={},sa=0;na=ja(y);oa=na&&na.prototype;Object.assign(ta,na);ta.prototype=Object.create(na.prototype);ta.prototype.constructor=ta;ta.__superConstructor__=na;function ta(wa){'use strict';oa.constructor.call(this);this._loadingIndicators={};this._numRemainingFiles=0;this._progressBarMarkup=null;this._videoIconMarkup=null;this._gridID=wa;this._dragDropTarget=null;this._submitListener=null;this._fileInputInstances=[];this._uploadTimers={};this._sessionsStarted=false;this._waterfallID=null;this._resizer=null;this._numUploadsSucceeded=0;this._numUploadsFailed=0;this._uploadIDToFileUpload={};this._failedUploadIDs={};h.subscribe('multi-upload/video-removed/'+this._gridID,(function(){r.remove(this._videoIconMarkup);this._submitListener&&this._submitListener.remove();this._submitListener=null;this._fileInputInstances.forEach(function(xa){xa.clear();});}).bind(this));h.subscribe('multi-upload/image-removed/'+this._gridID,(function(){this._logComposerWaterfallEvent(k.PHOTO_REMOVE);}).bind(this));h.subscribe('PhotosMultiUploadInput/initDragDrop/'+this._gridID,(function(xa,ya){this.initDragDrop(ya.dragDropArea);}).bind(this));h.subscribe('AttachmentsPhotoEditor/logPhotoEditorLaunched'+this._gridID,(function(xa,ya){this.logStep(ba.CLIENT_PHOTO_EDIT_BEGIN);}).bind(this));h.subscribe('AttachmentsPhotoEditor/newImage'+this._gridID,this._onEditedImage.bind(this));}ta.prototype.getWaterfallID=function(){'use strict';if(!this._waterfallID)this._waterfallID=ea.generate();return this._waterfallID;};ta.prototype.getWaterfallAppName=function(){'use strict';return z.WEB_COMPOSER;};ta.prototype.getLoadingIndicator=function(wa){'use strict';var xa=this._loadingIndicators[wa];return xa;};ta.prototype.initDragDrop=function(wa){'use strict';this._dragDropTarget&&this._dragDropTarget.disable();this._dragDropTarget=new s(wa).setOnFilesDropCallback((function(xa){this.onFilesDrop(xa,aa.DRAGDROP);}).bind(this)).setFileFilter(m.filterImages).enable();};ta.prototype.setConfig=function(wa){'use strict';this._config=wa;this._isHighQuality=wa.hasOwnProperty('initWithHighQuality')?wa.initWithHighQuality:true;if(!u.isSupported()){this.logStep(ba.CLIENT_PROCESS_UNAVAILABLE);}else if(this._config.useResizer){this._resizer=new u(this._config.maxselect===1?1:u.DEFAULT_POOL_SIZE);this._resizer.setHighQuality(this._isHighQuality);}if(!this._waterfallID)this._waterfallID=wa.waterfallID;this._concurrentLimit=wa.concurrentLimit;return this;};ta.prototype.setProgressBarMarkup=function(wa){'use strict';this._progressBarMarkup=wa;return this;};ta.prototype.setVideoIconMarkup=function(wa){'use strict';this._videoIconMarkup=wa;var xa=r.find(wa,"._3ev");t.listen(xa,'click',this._onVideoRemoved.bind(this));return this;};ta.prototype.setQuality=function(wa){'use strict';this._isHighQuality=wa;this._resizer&&this._resizer.setHighQuality(wa);this.logStep(ba.CLIENT_QUALITY_SWITCH,{custom_tags:{high_quality:this._isHighQuality}});};ta.prototype.imageUploadDone=function(wa,xa,ya,za){'use strict';this._numUploadsSucceeded++;var ab=this.getLoadingIndicator(xa);if(!ab)return;if(r.contains(document.body,ab.getRoot()))r.replace(ab.getRoot(),wa);var bb={};bb[xa]=ya;this._informImagesAdded(bb,za);this._markUploadAsFinished();this._loadingIndicators[xa]=null;};ta.prototype.addCameraImage=function(wa,xa){'use strict';this.insertIntoGrid(wa);this._informImagesAdded({'0':xa},{});this.logStep(ba.CLIENT_ATTACH_PHOTO,{method:aa.CAMERA,fbid:xa});};ta.prototype._informImagesAdded=function(wa,xa){'use strict';h.inform(['multi-upload/images-added/'+this._gridID,'multi-upload/images-added'],{fbids:wa,tagInfo:{exifLocation:xa}});h.inform('composer/updateViewerLocationEstimate',xa);};ta.prototype._generateLoadingIndicatorForPhoto=function(wa){'use strict';this._generateLoadingIndicator(wa.uploadID);};ta.prototype._generateLoadingIndicator=function(wa){'use strict';this._numRemainingFiles++;var xa=this._progressBarMarkup.cloneNode(true);t.listen(xa,'click',this._clickHandler.bind(this,wa));this.insertIntoGrid(xa);this._loadingIndicators[wa]=new ca(xa);};ta.prototype._generateUploadIDsAndLoadingIndicators=function(wa){'use strict';for(var xa=0;xa<wa.length;xa++){if(!wa[xa].uploadID)wa[xa].uploadID=x.getNewID();this._generateLoadingIndicator(wa[xa].uploadID);}};ta.prototype._clickHandler=function(wa,xa){'use strict';var ya=xa.target,za="_639";if(v.byClass(ya,za))if(this._failedUploadIDs[wa]){this.removeLoadingIndicator(wa);}else this.fileUploadCanceled(wa,this._uploadIDToFileUpload[wa]);var ab="_2zo7";if(v.byClass(ya,ab)){p.hide(r.find(this.getLoadingIndicator(wa).getRoot(),"._2zo5"));this._retryFileUpload(this._uploadIDToFileUpload[wa].getFile());this._failedUploadIDs[wa]=false;}var bb="_2zo8";if(v.byClass(ya,bb))this.removeLoadingIndicator(wa);};ta.prototype.fileUploadFailure=function(wa,xa,ya){'use strict';this._numUploadsFailed++;this._failedUploadIDs[wa]=true;var za=Date.now()-this._uploadTimers[wa],ab=0;if(xa.upload)ab=xa.upload.getRetryCount?xa.upload.getRetryCount():0;var bb=xa.response.getErrorDescription(),cb=xa.response.getError();if(cb===pa)bb=JSON.stringify(ya);this.logStep(ba.CLIENT_TRANSFER_FAIL,{dt:za,error_code:cb,error_info:bb,bytes:xa.upload.getFile().size,auto_retry_count:ab,custom_tags:{high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried}});if(this._config.useNewErrorUI){var db=xa.response.isTransient()||xa.response.getError()==1004||xa.response.getError()==1006,eb=db&&this._uploadIDToFileUpload[wa];this._showNewUploadFailedMessage(wa,xa.upload.getFile().name||xa.upload.getFile().filename||'',xa.response.getErrorSummary(),xa.response.getErrorDescription(),eb,xa.upload.getFile());this._markUploadAsFinished();}else{this._showUploadFailedMessage(wa);this._fadeOutFileUpload(wa);}};ta.prototype._fadeOutFileUpload=function(wa){'use strict';new i(this.getLoadingIndicator(wa).getRoot()).duration(2000).checkpoint().from('opacity',1).to('opacity',0).duration(1000).ondone(this.removeFileUpload.bind(this,wa)).go();};ta.prototype._showUploadFailedMessage=function(wa){'use strict';p.hide(r.find(this.getLoadingIndicator(wa).getRoot(),"._5l83"));p.show(r.find(this.getLoadingIndicator(wa).getRoot(),"._5l82"));};ta.prototype._showNewUploadFailedMessage=function(wa,xa,ya,za,ab,bb){'use strict';var cb=this.getLoadingIndicator(wa).getRoot();p.hide(r.find(cb,"._5l83"));p.show(r.find(cb,"._2zo5"));var db=r.find(cb,"._2zo6");r.setContent(db,xa);var eb=r.find(cb,"._2zo5");da.set(eb,ya+': '+za);if(ab){var fb=r.find(cb,"._2zo7");p.show(fb);}else{var gb=r.find(cb,"._2zo8");p.show(gb);}};ta.prototype._finishUploadBatch=function(){'use strict';h.inform('multi-upload/images-upload-completed/'+this._gridID);if(this._numUploadsFailed>0){this.logStep(ba.CLIENT_TRANSFER_BATCH_FAIL,{volume:this._numUploadsFailed,batch_size:this._numUploadsSucceeded+this._numUploadsFailed});}else this.logStep(ba.CLIENT_TRANSFER_BATCH_SUCCESS,{volume:this._numUploadsSucceeded});this._numUploadsSucceeded=0;this._numUploadsFailed=0;};ta.prototype.fileUploadCanceled=function(wa,xa){'use strict';xa&&xa.abort();var ya={latency:Date.now()-this._uploadTimers[wa]};if(xa&&xa.getFile())ya.bytes=xa.getFile().size;this.logStep(ba.CLIENT_TRANSFER_CANCEL,ya);this.removeFileUpload(wa);};ta.prototype.removeFileUpload=function(wa){'use strict';this.removeLoadingIndicator(wa);this._markUploadAsFinished();};ta.prototype._markUploadAsFinished=function(){'use strict';this._numRemainingFiles=Math.max(0,this._numRemainingFiles-1);if(this._numRemainingFiles===0)this._finishUploadBatch();};ta.prototype.getVideoOrPhotoUploadCallback=function(wa,xa){'use strict';var ya=this;return function(za){if(za){var ab=v.byTag(ga(ya._gridID),'form'),bb=l.getComposerID(ab),cb=new o(bb);cb.handleVideoSelected(wa);}else if(xa){ya._photosSelected(wa);}else new q().setBody(la._("Sorry, you can only select video files.")).setTitle(la._("Unsupported File")).setModal(true).setButtons(q.OK).show();};};ta.prototype.doFileUpload=function(wa){'use strict';var xa=false,ya=false;switch(this._config.supportedFileTypes){case 'photos':ya=true;break;case 'videos':xa=true;break;case 'both':xa=ya=true;break;}this._submitListener&&this._submitListener.remove();var za=this.getVideoOrPhotoUploadCallback(wa,ya);if(xa){o.isVideoOrAnimatedGifAsync(wa,za);}else za(false);};ta.prototype.getConfig=function(){'use strict';return this._config;};ta.prototype._resizeUpload=function(wa,xa){'use strict';var ya=wa.getFile();if(!ya||!w(ya.type).isJpeg())return xa(wa);var za=ka();this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:ya.size,custom_tags:{high_quality:this._isHighQuality}});this._resizer.resizeBlob(ya,(function(ab,bb,cb){bb=bb||ya;if(ab){this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:ka()-za,bytes:bb.size,error_code:ab.code,error_info:ab.message,custom_tags:{high_quality:this._isHighQuality}});return xa(wa);}bb.uploadID=ya.uploadID;bb.filename=ya.name;wa.setFile(bb);this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:ka()-za,media_data_size:ya.size,bytes:bb.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:cb}});xa(wa);}).bind(this),this._onResizeProgress.bind(this,ya.uploadID));};ta.prototype._onResizeStart=function(wa){'use strict';this.logStep(ba.CLIENT_PROCESS_BEGIN,{bytes:wa.size,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeFail=function(wa,xa,ya,za){'use strict';this.logStep(ba.CLIENT_PROCESS_FAIL,{dt:za,bytes:xa.size,error_code:ya.code,error_info:ya.message,custom_tags:{high_quality:this._isHighQuality}});};ta.prototype._onResizeSuccess=function(wa,xa,ya,za){'use strict';this.logStep(ba.CLIENT_PROCESS_SUCCESS,{dt:za,media_data_size:wa.size,bytes:xa.size,custom_tags:{high_quality:this._isHighQuality,skipped_resizing:ya}});};ta.prototype._isExceedMaxSelect=function(wa){'use strict';return this._config.maxselect>1&&wa>this._config.maxselect;};ta.prototype._showTooManyPhotosDialog=function(){'use strict';new q().setTitle(la._("Too Many Photos")).setBody(la._({"*":"Sorry, you can only add {maxselect} photos to a message. If you'd like, you can add photos to additional messages."},[la.param('maxselect',this._config.maxselect,[0])])).setButtons(q.OK).setModal(true).show();};ta.prototype._photosSelected=function(wa){'use strict';var xa=wa.getInput(),ya=ua(xa);if(this._isExceedMaxSelect(ya)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this._upload(wa,ya);};ta.prototype._upload=function(wa,xa){'use strict';var ya=wa.getInput(),za=this._config.uploadData;if(this._config.waterfallID)za.qn=this._config.waterfallID;var ab=(function(){h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:xa});}).bind(this),bb=new fa({uploadEndpoint:this._config.photoEndpoint,uploadData:za,retryLimit:this._config.retryLimit,concurrentLimit:this._config.concurrentLimit,resizer:this._resizer,onUploadEnqueued:this._generateLoadingIndicatorForPhoto.bind(this),onUploadsEnqueued:ab,onUploadSent:function(){return wa.clear();},onResizeStart:this._onResizeStart.bind(this),onResizeProgress:this._onResizeProgress.bind(this),onResizeSuccess:this._onResizeSuccess.bind(this),onResizeFailure:this._onResizeFail.bind(this),onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFailure:this.fileUploadFailure.bind(this)});bb.upload(ya);this.logStep(ba.CLIENT_SELECT_SUCCESS,{times_selected:sa++,volume:xa,method:'file_selector'});};ta.prototype._onVideoRemoved=function(){'use strict';this._dragDropTarget&&this._dragDropTarget.enable();h.inform('multi-upload/video-removed/'+this._gridID);};ta.prototype.removeLoadingIndicator=function(wa){'use strict';var xa=this.getLoadingIndicator(wa);xa&&r.remove(xa.getRoot());delete this._loadingIndicators[wa];h.inform('multi-upload/loading-indicator-removed/'+this._gridID);};ta.prototype._onFileUploadStart=function(wa,xa){'use strict';this._uploadIDToFileUpload[wa]=xa.upload;var ya=r.find(this.getLoadingIndicator(wa).getRoot(),"._639");p.show(ya);this._uploadTimers[wa]=Date.now();var za={custom_tags:{high_quality:this._isHighQuality}};if(xa.upload&&xa.upload.getFile())za.size=xa.upload.getFile().size;this.logStep(ba.CLIENT_TRANSFER_BEGIN,za);this._logComposerWaterfallEvent(k.PHOTO_ADD);};ta.prototype._onUploadProgress=function(wa,xa){'use strict';var ya=this.getLoadingIndicator(wa);if(!ya||this._failedUploadIDs[wa])return;this._showProgressBar(ya);p.removeClass(ya.getRoot(),"_5v_0");ma(ya,xa.event);};ta.prototype._onResizeProgress=function(wa,event){'use strict';var xa=this.getLoadingIndicator(wa);if(!xa)return;this._showProgressBar(xa);p.addClass(xa.getRoot(),"_5v_0");xa.setPosition(100*event.written/event.total);};ta.prototype._showProgressBar=function(wa){'use strict';p.hide(r.find(wa.getRoot(),"._2om"));p.show(r.find(wa.getRoot(),"._5e4h"));};ta.prototype._onFileUploadSuccess=function(wa,xa){'use strict';var ya=Date.now()-this._uploadTimers[wa],za={dt:ya};if(xa.upload){za.bytes=xa.upload.getFile().size;za.auto_retry_count=xa.upload.getRetryCount?xa.upload.getRetryCount():0;za.custom_tags={high_quality:this._isHighQuality,manual_retry:!!xa.upload.getFile().manuallyRetried};}this.logStep(ba.CLIENT_TRANSFER_SUCCESS,za);this._logComposerWaterfallEvent(k.PHOTO_ADD_SUCCESS);};ta.prototype._logComposerWaterfallEvent=function(event){'use strict';if(!v.byClass(ga(this._gridID),"_119"))return;n.logEvent(event,this._getComposerID());};ta.prototype._getComposerID=function(){'use strict';return l.getComposerID(this._gridID);};ta.prototype._getAsyncUploadRequest=function(wa){'use strict';var xa=new fa({uploadEndpoint:this._config.photoEndpoint,uploadData:this._config.uploadData,concurrentLimit:this._config.concurrentLimit,onUploadStart:this._onFileUploadStart.bind(this),onUploadProgress:this._onUploadProgress.bind(this),onUploadSuccess:this._onFileUploadSuccess.bind(this),onUploadFail:this.fileUploadFailure.bind(this)});return xa.getAsyncUploadRequest(wa);};ta.prototype._onEditedImage=function(wa,xa){'use strict';this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators([xa.blob]);var ya=this._getGridItemElementByFBID(xa.fbid);if(ya){var za=this._loadingIndicators[xa.blob.uploadID].getRoot();r.insertBefore(ya,za);}h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1,method:aa.EDITOR});var ab=this._getAsyncUploadRequest([xa.blob]);ab.setData(Object.assign({},this._config.uploadData,{original_fbid:xa.fbid,xy_tags:xa.xyTags,stickers:xa.stickers,text_overlays:xa.textOverlays,has_crop:xa.hasCrop,has_filter:xa.hasFilter}));ab.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:1,method:aa.EDITOR});this.logStep(ba.CLIENT_PHOTO_EDIT_SUCCESS);};ta.prototype._getGridItemElementByFBID=function(wa){'use strict';var xa=r.scry(ga(this._gridID),".fbVaultGridItem");for(var ya=0;ya<xa.length;ya++)if(xa[ya].dataset.originalfbid==wa)return xa[ya];return null;};ta.prototype.onFilesDrop=function(wa,xa){'use strict';if(this._isExceedMaxSelect(wa.length)){this._showTooManyPhotosDialog();return;}this._onBeforeAddUploadedImages();this.logStep(ba.CLIENT_SELECT_BEGIN);this._generateUploadIDsAndLoadingIndicators(wa);h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:wa.length,method:xa||aa.DRAGDROP});var ya=this._getAsyncUploadRequest(wa);if(this._resizer)ya.setPreprocessHandler(this._resizeUpload.bind(this));ya.send();this.logStep(ba.CLIENT_SELECT_SUCCESS,{volume:wa.length,method:xa||aa.DRAGDROP});};ta.prototype._retryFileUpload=function(wa){'use strict';this._numRemainingFiles++;h.inform('multi-upload/images-upload-start/'+this._gridID,{imageCount:1});this.logStep(ba.CLIENT_TRANSFER_MANUAL_RETRY);wa.manuallyRetried=true;var xa=this._getAsyncUploadRequest([wa]);xa.send();};ta.prototype._onBeforeAddUploadedImages=function(){'use strict';if(!this.sessionStarted)this.logStep(ba.CLIENT_FLOW_BEGIN);if(this._config.maxselect==1)h.inform('multi-upload/composer-reset/'+this._gridID);this.sessionStarted=true;};ta.prototype.clearSession=function(){'use strict';this.sessionStarted=false;};ta.prototype.insertIntoGrid=function(wa){'use strict';var xa=r.scry(ga(this._gridID),"._577")[0];if(xa){r.insertBefore(xa,wa);}else r.prependContent(ga(this._gridID),wa);};ta.prototype._getUploadID=function(wa,xa){'use strict';if(wa.upload){return wa.upload.getFile().uploadID;}else return xa.uploadID;};ta.getInstance=function(wa){'use strict';ra[wa]=ra[wa]||new ta(wa);return ra[wa];};function ua(wa){if(!va(wa))return 1;return wa.files.length;}function va(wa){return !!wa.files&&j.isSupported();}f.exports=qa;},null);
__d('TimelineMapScrollableArea',['Animation','ArbiterMixin','CSS','DOM','Event','Run','Scroll','SimpleDrag','Style','Vector','$','shield'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){if(c.__markCompiled)c.__markCompiled();function t(u,v){u&&this.init(r(u),v);}Object.assign(t.prototype,i,{init:function(u,v){v=v||{};this._elem=u;this._wrap=k.find(u,'div.fbScrollableAreaWrap');this._body=k.find(this._wrap,'div.fbScrollableAreaBody');this._track=k.find(u,'div.fbScrollableAreaTrack');this._gripper=k.find(this._track,'div.fbScrollableAreaGripper');this._options=v;this.adjustGripper();this._listeners=[l.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(v.fade!==false)this._listeners.push(l.listen(u,'mouseenter',s(this.adjustGripper,this)),l.listen(u,'mouseenter',s(this.showScrollbar,this)),l.listen(u,'mousemove',this._handleMousemove.bind(this)),l.listen(u,'mouseout',s(this.hideScrollbar,this)));if(v.fade!==undefined)this._listeners.push(l.listen(this._track,'click',this.clickToScroll.bind(this)));if(v.verticalscroll)this._listeners.push(l.listen(this._wrap,'mousewheel',this.mouseWheel.bind(this)),l.listen(this._wrap,'DOMMouseScroll',this.mouseWheel.bind(this)));this.initDrag();if(!v.persistent)m.onLeave(this.destroy.bind(this));},getRoot:function(){return this._elem;},initDrag:function(){var u=new o(this._gripper);u.subscribe('start',(function(v,event){if(!(event.which&&event.which===1||event.button&&event.button===1))return;this.inform('dragstart');var w=q.getEventPosition(event).x,x=this._gripper.offsetLeft,y=u.subscribe('update',(function(aa,ba){var ca=q.getEventPosition(ba).x-w,da=this._elem.clientWidth,ea=this._body.offsetWidth,fa=this._track.offsetWidth,ga=da/ea*fa,ha=ea-this._wrap.offsetWidth,ia=x+ca,ja=fa-ga;ia=Math.max(Math.min(ia,ja),0);var ka=ia/ja*ha;n.setLeft(this._wrap,ka);}).bind(this)),z=u.subscribe('end',(function(){u.unsubscribe(y);u.unsubscribe(z);this.inform('dragend');}).bind(this));}).bind(this));},adjustGripper:function(){var u=this._elem.clientWidth,v=this._body.offsetWidth,w=this._track.offsetWidth,x=u/v*w;if(x<w){p.set(this._gripper,'width',x+'px');var y=n.getLeft(this._wrap)/v*w;p.set(this._gripper,'left',y+'px');j.show(this._gripper);}else j.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){var u=n.getLeft(this._wrap),v=this._wrap.scrollWidth-this._wrap.clientWidth;j.conditionClass(this._elem,'contentBefore',u>0);j.conditionClass(this._elem,'contentAfter',u<v);},destroy:function(){this._listeners.forEach(function(u){u.remove();});this._listeners.length=0;},_handleMousemove:function(event){var u=q.getElementPosition(this._track).y,v=q.getElementDimensions(this._track).y;if(Math.abs(u+v/2-q.getEventPosition(event).y)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();},hideScrollbar:function(){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}this._hideTimeout=setTimeout((function(){if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this._scrollbarAnimation=new h(this._track).from('opacity',1).to('opacity',0).duration(250).ondone(j.addClass.bind(null,this._track,'invisible_elem')).go();}).bind(this),750);return this;},showScrollbar:function(u){if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._scrollbarAnimation){this._scrollbarAnimation.stop();this._scrollbarAnimation=null;}this.adjustGripper();p.set(this._track,'opacity',1);j.removeClass(this._track,'invisible_elem');if(u!==false)this.hideScrollbar();return this;},clickToScroll:function(event){var u=q.getEventPosition(event).x,v=this._elem.clientWidth,w=this._body.offsetWidth,x=this._track.offsetWidth,y=v/w*x,z=q.getElementPosition(this._gripper);if(u>=z.x&&u<=z.x+y)return;var aa=u<z.x?-1:1,ba=this._wrap.offsetWidth*.8*aa;this.scrollBy(ba);},scrollBy:function(u){this.setScroll(n.getLeft(this._wrap)+u);},getMaxBodyOffset:function(){return this._body.offsetWidth-this._wrap.offsetWidth;},setScroll:function(u){var v=u;v=Math.max(Math.min(v,this.getMaxBodyOffset()),0);n.setLeft(this._wrap,v);},scrollIntoView:function(u){var v=this._wrap.clientWidth,w=u.offsetWidth,x=n.getLeft(this._wrap),y=x+v,z=u.offsetLeft,aa=z+w;if(z<x||v<w){this.setScroll(z);}else if(aa>y)this.setScroll(x+(aa-y));},mouseWheel:function(event){if(this.getMaxBodyOffset()<=0)return;var u=0;if(event.wheelDelta){var v=event.wheelDelta;if(event.wheelDeltaX&&event.wheelDeltaY)v=Math.abs(event.wheelDeltaX)>Math.abs(event.wheelDeltaY)?event.wheelDeltaX:event.wheelDeltaY;u=-v*10/40;}else if(event.detail)u=event.detail*10;this.scrollBy(u);event.prevent();}});f.exports=b.TimelineMapScrollableArea||t;},null);
__d('MercuryListUpdateRenderer',['DOM','ge'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j={updateList:function(k,l,m,n,o){var p=[];for(var q=0;q<l.length;q++){if(o){var r=o(q);r&&p.push(r);}var s=i(l[q]);if(s&&m(q)){p.push(s);}else p.push(n(q));}h.setContent(k,p);}};f.exports=j;},null);
__d('MessagingConst',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={APP_ID:313785040330,XD_MESSAGE:{SANDBOX_READY:'sandbox_ready',SET_CONTENT:'set_content',HTML_SIZE:'html_size',REFRESH_SIZE:'refresh_size'},SHINGLE_SCROLL_TRIGGER:5,EVENTS:{MESSAGE_SENT:'messaging/message_sent'},initConstants:function(i){Object.assign(h,i);}};f.exports=h;},null);
__d('WebMessengerDetailViewRecentMessagesControl',['Event','Animation','CSS','WebMessengerDetailViewUnreadMessagesNotice','DOM','Arbiter','GroupChatMessageBlockAlert','MercuryLastMessageIndicator.react','MercuryListUpdateRenderer','MercuryAPIArgsSource','MercuryConfig','MercuryLogMessageType','MercurySourceType','MercuryThreadlistConstants','MercuryViewer','MercuryMessageGroup','WebMessengerMessagesSelection','MessagingTag','MessengerContextBannerBootloader','React','ReactComponentRenderer','MercuryShareAttachmentRenderLocations','WebMessengerStateConstants','WebMessengerStateManager','Style','WebMessengerTemplates','WebMessengerThreadMessagesRenderer','UserActivity','WebMessengerConstants','WebMessengerInfoBoxRenderer','WebMessengerMessageIDFinder','WebMessengerSubscriptionsHandler','cx','debounce','formatDate','ge','fbt','MercuryBlockedParticipants','MercuryMessageActions','MercuryMessageObject','MercuryMessages','MercuryThreadInformer','MercuryThreadActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra){if(c.__markCompiled)c.__markCompiled();var sa=Object.assign||function(ub){for(var vb=1;vb<arguments.length;vb++){var wb=arguments[vb];for(var xb in wb)if(Object.prototype.hasOwnProperty.call(wb,xb))ub[xb]=wb[xb];}return ub;},ta=c('MercuryBlockedParticipants').get(),ua=c('MercuryMessageActions').get(),va=c('MercuryMessageObject').get(),wa=c('MercuryMessages').get(),xa=c('MercuryThreadInformer').get(),ya=c('MercuryThreadActions').get(),za=c('MercuryThreads').get();function ab(ub,vb,wb,xb,yb,zb,ac,bc){'use strict';this._manager=ub;this._rootElement=vb;this._loadingSpinner=wb;this._noSelectedConversation=xb;this._newMessageLink=yb;this._showUnreadLink=zb;this.contextBanner=ac;l.empty(this._rootElement);this._pagerExponent=-1;var cc=ga[':fb:web-messenger:read-view:recent-messages'].build();l.setContent(this._rootElement,cc.getRoot());this._selectedConversationView=cc.getRoot();this._messageList=cc.getNode('messagelist');this._loadMoreButton=cc.getNode('loadMoreButton');this._loadMoreLink=cc.getNode('loadMoreLink');this._loadMoreCount=cc.getNode('loadMoreCount');this._loadingMoreCount=cc.getNode('loadingMoreCount');this._indicatorNode=cc.getNode('lastMessageIndicator');this._unseenMessagesNotice=new k(this._manager);this._unseenMessagesNotice.setNoticeContextNode(bc);this._active=false;this._state=null;this._threadID=null;this._bugReportingEnabled=false;this._currentCountMap={};this._olderMessageID={};this._loadMessagesInFlight={};ha.setupSelectionListener(this._messageList);this._manager.addScrollCallback(oa(tb.bind(null,this),500));ma.addSubscriptions(h.listen(this._loadMoreLink,'click',lb.bind(null,this)),xa.subscribe('messages-reordered',(function(dc,ec){var fc=this._threadID&&ec[this._threadID];if(fc)hb(this);}).bind(this)),xa.subscribe('messages-updated',(function(dc,ec){var fc=this._threadID&&ec[this._threadID];if(fc)var gc=Object.keys(fc),hc=gc.length&&fc[gc[0]];if(fc&&hc)hb(this,ec[this._threadID]);}).bind(this)),xa.subscribe('messages-updated',tb.bind(null,this)),xa.subscribe('messages-received',(function(dc,ec){if(this._threadID&&ec[this._threadID])kb(this,ec);}).bind(this)),xa.subscribe('thread-read-changed',(function(dc,ec){if(ec[this._threadID])qb(this,ec[this._threadID]);}).bind(this)),this._manager.subscribe('scrolledNearTop',(function(){this._active&&lb(this);}).bind(this)));}ab.prototype.hideView=function(){'use strict';this._active=false;j.hide(this._rootElement);j.hide(this._loadingSpinner);j.hide(this._noSelectedConversation);j.hide(this.contextBanner);this._unseenMessagesNotice.hideView();this._manager._flexArea.setBottomAligned(false);};ab.prototype.updateView=function(){'use strict';this._unseenMessagesNotice.updateView();this._active=true;this._manager._flexArea.setBottomAligned(true);j.show(this._rootElement);if(this.contextBanner)j.show(this.contextBanner);var ub=cb(this);db(this);x.clear();if(ub){eb(this);}else ob(this);};ab.prototype.renderContextBanner=function(ub,vb){'use strict';if(this.contextBanner&&!this.contextBannerElem)z.bootload(ub,ca.WEB_INBOX,(function(wb){this.contextBannerElem=wb;fa.set(this._rootElement,'padding-top','80px');l.prependContent(this.contextBanner,this.contextBannerElem);j.show(this.contextBanner);}).bind(this),vb);};ab.prototype.unmountContextBanner=function(){'use strict';if(this.contextBannerElem){aa.unmountComponentAtNode(this.contextBannerElem);this.contextBannerElem=null;l.empty(this.contextBanner);}};ab.prototype.destroy=function(){'use strict';bb(this);this._unseenMessagesNotice.destroy();aa.unmountComponentAtNode(this._indicatorNode);this.unmountContextBanner();};function bb(ub){ub._messagesSubscription&&wa.unsubscribe(ub._messagesSubscription.subscriber_id,ub._messagesSubscription.thread_id);ub._messagesSubscription=null;}function cb(ub){var vb=ea.getCurrentStateData();if(!ub._threadID||ub._threadID!=vb.thread_id)return true;return false;}function db(ub){var vb=ea.getCurrentStateData();ub._state=ea.getCurrentDetailState();ub._threadID=vb.thread_id;ub._selectionEnabled=!!vb.message_action;ub._bugReportingEnabled=vb.bug_reporting_enabled;ha.updateSelection(ub._messageList);j.conditionClass(ub._messageList,'bugReportingEnabled',ub._bugReportingEnabled);}function eb(ub){l.scry(ub._rootElement,'.stickerContainer').forEach(function(wb){return aa.unmountComponentAtNode(wb);});l.empty(ub._messageList);ub.unmountContextBanner();var vb=null;if(ub._threadID!==undefined)vb=za.getThreadMetaNow(ub._threadID);if(vb&&ta.isPresentInGroupThread(vb)){n.show(ta.inGroupThread(vb),function(){return fb(ub);},function(){ua.send(va.constructLogMessageObject(t.TITAN_WEB,ub._threadID,s.UNSUBSCRIBE,{removed_participants:[v.getID()]}),null,q.WEBMESSENGER);fb(ub);});}else fb(ub);}function fb(ub){j.show(ub._loadingSpinner);j.hide(ub._loadMoreButton);bb(ub);ub._pagerExponent=-1;aa.unmountComponentAtNode(ub._indicatorNode);if(ub._lastMessageIndicator){ub._lastMessageIndicator.unmount();delete ub._lastMessageIndicator;}if(ub._threadID){j.show(ub._selectedConversationView);j.hide(ub._noSelectedConversation);ub._manager._flexArea.showAtTop(false);if(!ub._olderMessageID[ub._threadID]){gb(ub);}else hb(ub);ub._manager.scrollToBottom(false);}else{sb(ub);j.hide(ub._selectedConversationView);j.show(ub._noSelectedConversation);j.hide(ub._loadingSpinner);ub._manager._flexArea.showAtTop(true);}}function gb(ub){ub._loadMessagesInFlight[ub._threadID]=true;ub._currentCountMap[ub._threadID]=ja.INITIAL_MESSAGES_LIMIT;j.hide(ub._loadMoreButton);var vb=wa.getThreadMessagesRange(ub._threadID,0,ub._currentCountMap[ub._threadID],ib.bind(null,ub),null,q.WEBMESSENGER);if(vb){ub._messagesSubscription={subscriber_id:vb,thread_id:ub._threadID};}else hb(ub);}function hb(ub,vb){if(!ub._threadID||!ub._olderMessageID[ub._threadID])return;var wb=wa.getThreadMessagesSinceTimestamp(ub._threadID,rb(ub._olderMessageID[ub._threadID]));if(wb.length>ub._currentCountMap[ub._threadID])ub._currentCountMap[ub._threadID]=wb.length;jb(ub,wb,vb);}function ib(ub,vb){ub._loadMessagesInFlight[ub._threadID]=false;if(vb&&vb.length){var wb=vb[0].timestamp,xb=ub._olderMessageID[ub._threadID]?rb(ub._olderMessageID[ub._threadID]):null;if(!xb||wb<xb)ub._olderMessageID[ub._threadID]=vb[0].message_id;}}function jb(ub,vb,wb){j.hide(ub._loadingSpinner);j.conditionShow(ub._loadMoreButton,!wa.hasLoadedAllMessages(ub._threadID));var xb=za.getThreadMetaNow(ub._threadID);if(xb){var yb=xb.message_count-vb.length;yb=yb<0?0:yb;l.setContent(ub._loadMoreCount,yb);l.setContent(ub._loadingMoreCount,yb);}if(xb&&xb.is_canonical&&r.ShowContextBanner&&wa.hasLoadedAllMessages(ub._threadID))ub.renderContextBanner(ub._threadID);var zb=function(hc){var ic,jc=qa('wm:'+hc);if(jc)ic=la.findAll(jc);return ic||[];},ac=[],bc=w.calculateMessageGroups(vb),cc={},dc=[];bc.forEach(function(hc){var ic=hc[0].message_id,jc=false;if(wb){jc=hc.some(function(lc){return lc.message_id in wb;});if(!jc){ac=zb(ic);jc=ac.some(function(lc){return lc in wb;});}}if(!jc){ac=zb(ic);if(hc.length==ac.length){for(var kc=0;kc<hc.length;kc++)if(hc[kc].message_id!=ac[kc]){jc=true;break;}}else jc=true;}if(jc)cc[ic]=1;dc.push('wm:'+ic);});var ec=function(hc){return !cc[bc[hc][0].message_id];},fc=function(hc){var ic=bc[hc],jc=ha.renderMessageGroup(ic);if(hc==dc.length-1)ub._messageGroup=jc;return jc.getRoot();},gc=function(hc){return ha.renderMessageSeparatorForIndex(bc,hc);};p.updateList(ub._messageList,dc,ec,fc,gc);ub._lastMessage=vb[vb.length-1];nb(ub);ob(ub);ub._manager.poke();}function kb(ub,vb){var wb=vb[ub._threadID],xb=ub._manager._flexArea.getScrollableArea(),yb=xb.getScrollHeight();wb.forEach(function(bc){bc.timestamp_relative=pa(new Date(bc.timestamp),'g:ia');var cc=w.canAppendMessageToLastGroup(ub._lastMessage,bc);if(!cc){ub._messageGroup=ha.renderMessageGroup([bc]);var dc=bc.timestamp,ec=ub._lastMessage?ub._lastMessage.timestamp:0,fc=ja.READ_VIEW_SEPARATOR_TIME_LIMIT;if(!ec||dc-ec>=fc){var gc=ha.renderMessageSeparator(bc);l.appendContent(ub._messageList,gc);}l.appendContent(ub._messageList,ub._messageGroup.getRoot());}else ha.appendMessageToGroup(ub._messageGroup,bc);if(bc.author!=v.getID())j.addClass(ub._messageGroup.getRoot(),'unreadHighlight');ub._lastMessage=bc;});ub._manager._flexArea.poke();var zb=xb.getScrollHeight(),ac=xb.getScrollTop();ub._unseenMessagesNotice.updateOnMessagesReceived(yb,zb,ac,vb);nb(ub);if(ub._manager.isScrolledToBottom())ob(ub);}function lb(ub){j.addClass(ub._loadMoreButton,'async_saving');if(ub._loadMessagesInFlight[ub._threadID])return;ub._loadMessagesInFlight[ub._threadID]=true;ub._pagerExponent=Math.min(ub._pagerExponent+1,ja.EXPONENTIAL_PAGER_MAX_CYCLES);var vb=Math.pow(2,ub._pagerExponent),wb=ub._currentCountMap[ub._threadID]+vb*u.WEBMESSENGER_MORE_MESSAGES_COUNT;bb(ub);var xb=wa.getThreadMessagesRange(ub._threadID,0,wb,function(yb){j.removeClass(ub._loadMoreButton,'async_saving');ub._currentCountMap[ub._threadID]=wb;ib(ub,yb);ub._loadMessagesInFlight[ub._threadID]=false;},null,q.WEBMESSENGER);if(xb){ub._messagesSubscription={subscriber_id:xb,thread_id:ub._threadID};}else hb(ub);}function mb(ub){if(!ub._lastMessageIndicator){var vb;ub._lastMessageIndicator=new ba(o,ub._indicatorNode);ub._lastMessageIndicator.setProps({threadID:ub._threadID,className:"_510o",indicatorWillShow:function(){return (vb=ub._manager.isScrolledToBottom());},indicatorDidShow:function(){return (vb&&ub._manager.scrollToBottom(true));}});}return ub._lastMessageIndicator;}function nb(ub,vb){mb(ub).setProps({lastMessage:ub._lastMessage});}function ob(ub){if(ia.isActive(5000)){pb(ub);}else ia.subscribeOnce(pb.bind(null,ub));}function pb(ub){if(!ub._threadID||!ub._active)return;ya.markRead(ub._threadID);var vb=l.scry(ub._messageList,'.unreadHighlight');vb.forEach(function(wb){j.removeClass(wb,'unreadHighlight');j.addClass(wb,'unreadFading');new i(wb).from('background','#eceff5').to('background','#fff').from('borderColor','#d6d6d6').to('borderColor','#fff').ease(i.ease.both).duration(1500).ondone(function(){j.removeClass(wb,'unreadFading');fa.set(wb,'background','');fa.set(wb,'borderColor','');}).go();});}function qb(ub,vb){if(!vb.mark_as_read)return;var wb=l.scry(ub._messageList,'.unreadHighlight');for(var xb=0;xb<wb.length;xb++){var yb=wb[xb],zb=la.findAll(yb),ac=wa.getMessagesFromIDs(zb);if(ac[ac.length-1].timestamp<vb.timestamp)j.removeClass(yb,'unreadHighlight');}}function rb(ub){var vb=wa.getMessagesFromIDs([ub])[0];return vb?vb.timestamp:0;}function sb(ub){if(ub._builtNoSelectionBox)return;var vb=function(){var xb=ea.getCurrentStateData(),yb=sa({},xb);ea.updateDetailState(da.DETAIL.COMPOSE_MAIN,Object.assign(yb,{start:true,thread_id:undefined}));},wb=function(){var xb=ea.getCurrentStateData(),yb=sa({},xb);ea.updateMasterState(da.MASTER.RECENT_THREADS,Object.assign(yb,{folder:y.INBOX,filter:y.UNREAD}));};l.setContent(ub._noSelectedConversation,ka.render(ra._("No Conversation Selected"),[{text:ra._("New Message"),handler:vb},{text:ra._("Show Unread"),handler:wb}]));ub._builtNoSelectionBox=true;}function tb(ub){var vb=ub._manager._flexArea.getScrollableArea(),wb=ub._manager.getFlexAreaBoundingClientRect();m.inform('messengerScrolled/'+ub._threadID,{scrollTop:vb.getScrollTop(),top:wb.y,viewHeight:wb.height});}f.exports=ab;},null);
__d('WebMessengerEditThreadDialog',['Event','Button','ContextualDialog','CSS','DOM','FileInput','FileInputUploader','Input','InputSelection','LayerFadeOnHide','LayerFadeOnShow','LayerHideOnTransition','MercuryAPIArgsSource','MercuryLogMessageType','MercurySourceType','WebMessengerTemplates','URI','WebMessengerSubscriptionsHandler','csx','cx','MercuryMessageObject','MercuryMessageActions','MercuryThreads'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){if(c.__markCompiled)c.__markCompiled();var ba=c('MercuryMessageObject').get(),ca=c('MercuryMessageActions').get(),da=c('MercuryThreads').get(),ea=':fb:web-messenger:read-view:header:edit-multichat';function fa(){'use strict';var ga=w[ea].build();this._dialog=new j({position:'below',addedBehaviors:[q,r,s]},ga.getRoot());this._saveButton=ga.getNode('saveButton');this._cancelButton=ga.getNode('cancelButton');this._pictureInput=ga.getNode('newPicture');this._uploadButton=ga.getNode('uploadButton');this._uploadingThrobber=ga.getNode('uploadingThrobber');this._uploadedFileDetails=ga.getNode('uploadedFileDetails');this._fileNameNode=ga.getNode('fileName');this._cancelImageButton=ga.getNode('cancelImage');this._threadID=null;var ha=ga.getNode('newName');this._uploadedImage=null;if(!this._pictureInput){var ia=l.scry(ga.getRoot(),"._8-9")[0];this._pictureInput=l.create('input',{accept:'image/*',type:'file',className:"_n",name:'attachment[]',tabindex:2});new m(ia,this._uploadButton,this._pictureInput);}var ja=new x('/ajax/mercury/upload.php').setSubdomain('upload').toString();this._uploader=new n(this._pictureInput).setURI(ja).setAllowCrossOrigin(true).setData({images_only:true});y.addSubscriptions(this._uploader.subscribe('success',this._onFileUploadSuccess.bind(this)),this._uploader.subscribe('failure',this._onFileUploadFailure.bind(this)),h.listen(this._pictureInput,'change',this._onFileUploadChange.bind(this)),h.listen(this._cancelImageButton,'click',this._resetImageUpload.bind(this)));h.listen(this._saveButton,'click',(function(){this.save(o.getValue(ha));this._dialog.hide();}).bind(this));h.listen(this._cancelButton,'click',(function(){this._dialog.hide();}).bind(this));this._dialog.subscribe('show',(function(){var ka=da.getThreadMetaNow(this._threadID);o.setValue(ha,ka.name);this._resetImageUpload();}).bind(this));this._dialog.subscribe('aftershow',(function(){p.set(ha,0,o.getValue(ha).length);}).bind(this));}fa.prototype.toggleShown=function(ga,ha){'use strict';if(!this._dialog.isShown()){this._dialog.setContext(ga);this._threadID=ha;this._uploadedImage=null;this._dialog.show();}else this._dialog.hide();};fa.prototype.save=function(ga){'use strict';var ha=null,ia=da.getThreadMetaNow(this._threadID);if(ia)ha=ia.name;if((ga||ha)&&ga!=ha)ca.send(ba.constructLogMessageObject(v.CHAT_WEB,this._threadID,u.THREAD_NAME,{name:ga}),null,t.WEBMESSENGER);if(this._uploadedImage)ca.send(ba.constructLogMessageObject(v.CHAT_WEB,this._threadID,u.THREAD_IMAGE,{image:this._uploadedImage}));};fa.prototype._onFileUploadChange=function(event){'use strict';var ga=o.getValue(event.getTarget());if(ga){i.setEnabled(this._saveButton,false);k.hide(this._uploadButton);k.hide(this._uploadedFileDetails);k.show(this._uploadingThrobber);this._uploader.send();}};fa.prototype._onFileUploadSuccess=function(ga,ha){'use strict';var ia=ha.response.getPayload();this._uploadedImage=ia.metadata[0];l.setContent(this._fileNameNode,this._uploadedImage.filename);k.hide(this._uploadingThrobber);k.hide(this._uploadButton);k.show(this._uploadedFileDetails);i.setEnabled(this._saveButton,true);};fa.prototype._onFileUploadFailure=function(ga,ha){'use strict';i.setEnabled(this._saveButton,true);this._resetImageUpload();};fa.prototype._resetImageUpload=function(){'use strict';this._uploadedImage=null;this._pictureInput.value=null;k.hide(this._uploadingThrobber);k.hide(this._uploadedFileDetails);k.show(this._uploadButton);};f.exports=fa;},null);
__d('WebMessengerEditFilteringSettingDialog',['AsyncDialog','AsyncRequest','MercuryConstants','DOM','csx'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m='/ajax/mercury/edit_filtering_type.php',n='/ajax/mercury/change_filtering_type.php',o={show:function(){var p=function(r){var s=r.getRoot(),t=k.find(s,"._cq6").checked,u=k.find(s,"._cq7").checked,v='';if(t){v=j.MessagingFilteringType.MODERATE;}else if(u)v=j.MessagingFilteringType.STRICT;new i(n).setData({filtering_type:v}).send();r.hide();},q=function(r){r.subscribe('confirm',p.bind(null,r));r.show();};h.send(new i(m),q);}};f.exports=o;},null);
__d('WebMessengerMasterViewTabBarControl',['JSXDOM','Arbiter','CSS','DOM','Event','Ellipsizer','WebMessengerMenuFolderControl','MercuryConfig','MercuryFilters','MercuryFolders','MercuryThreadlistConstants','MessagingFilteringNux','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTabbedFolderControl','WebMessengerTemplates','WebMessengerEditFilteringSettingDialog','WebMessengerEvents','WebMessengerSubscriptionsHandler','WebMessengerMercury','csx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){if(c.__markCompiled)c.__markCompiled();var ea=Object.assign||function(ma){for(var na=1;na<arguments.length;na++){var oa=arguments[na];for(var pa in oa)if(Object.prototype.hasOwnProperty.call(oa,pa))ma[pa]=oa[pa];}return ma;};function fa(ma,na,oa){'use strict';this._manager=ma;this._rootElement=na;this._rootTopContentElement=oa;this._threadInformer=ba.getThreadInformer();this._unreadState=ba.getUnreadState();k.empty(this._rootElement);var pa=x[':fb:web-messenger:master-view:tab-bar'].build(),qa=x[':fb:web-messenger:master-view:top-content'].build();k.setContent(this._rootElement,pa.getRoot());k.setContent(this._rootTopContentElement,qa.getRoot());this._tabList=pa.getRoot();this._moreMenu=pa.getNode('moreMenu');this._topContentCont=qa.getRoot();this._topContent=qa.getNode('masterViewTopContentHolder');this._closeButton=qa.getNode('masterViewTopContentCloseButton');this._closeButtonCont=qa.getNode('masterViewTopContentCloseCont');this._state=null;this._folder=null;this._filter=null;this._query=null;this._threadID=null;this._folders=q.getSupportedFolders();this._foldersToHeader={};this._filters=p.getSupportedFilters();this._filtersToHeader={};this._otherMarkAllRead=h.a({href:"#"},da._("Mark All as Read"));this._unreadMarkAllRead=h.a({href:"#"},da._("Mark All as Read"));this._otherEditSettings=h.a({href:"#"},da._("Edit Preferences"));var ra=[];this._filters.forEach((function(ua){var va=ka.bind(null,this,t.INBOX,ua);switch(ua){case t.UNREAD:this._filtersToHeader[ua]=this._filtersToHeader[ua]||new n(da._("Unread"),this._moreMenu,va);break;}}).bind(this));this._folders.forEach((function(ua){var va=ka.bind(null,this,ua,p.ALL),wa=ka.bind(null,this,ua,t.UNREAD);switch(ua){case t.INBOX:var xa=o.CoreGraphEnabled?da._("Recent"):da._("Inbox");this._foldersToHeader[ua]=this._foldersToHeader[ua]||new w(xa,ra,va,wa);break;case t.OTHER:if(o.CoreGraphEnabled){this._foldersToHeader[ua]=this._foldersToHeader[ua]||new n(da._("Filtered"),this._moreMenu,va);}else this._foldersToHeader[ua]=this._foldersToHeader[ua]||new w(da._("Other"),ra,va);break;case t.ACTION_ARCHIVED:this._foldersToHeader[ua]=this._foldersToHeader[ua]||new n(da._("Archived"),this._moreMenu,va);break;case t.SPAM:if(o.CoreGraphEnabled)break;this._foldersToHeader[ua]=this._foldersToHeader[ua]||new n(da._("Spam"),this._moreMenu,va);break;case t.PENDING:if(!o.CoreGraphEnabled)break;this._foldersToHeader[ua]=this._foldersToHeader[ua]||new w(da._("Message Requests"),ra,va);break;}}).bind(this));k.prependContent(this._tabList,ra);var sa=k.scry(this._tabList,"._6xt");sa.push(pa.getNode('moreMenuLabel'));this._ellipsizer=new m(sa);ga(this);var ta=ka.bind(null,this,t.INBOX,p.ALL);i.subscribe(s.ACCEPTED_EVENT,ja.bind(null,this));aa.addSubscriptions(this._threadInformer.subscribe('unread-updated',la.bind(null,this)),l.listen(this._otherMarkAllRead,'click',(function(){this._unreadState.markFolderAsRead(t.OTHER);}).bind(this)),l.listen(this._unreadMarkAllRead,'click',(function(){this._unreadState.markFolderAsRead(t.INBOX);}).bind(this)),l.listen(this._otherEditSettings,'click',function(){y.show();}),l.listen(this._closeButton,'click',ta));}fa.prototype.updateView=function(){'use strict';var ma=ia(this);ha(this);if(ma)ja(this);ga(this);};fa.prototype.getOtherFolderLabel=function(){'use strict';var ma=t.OTHER,na=this._foldersToHeader[ma];if(!na||!na._template)return null;return na._template.getNode('folderLabel');};fa.prototype.destroy=function(){'use strict';for(var ma in this._foldersToHeader)this._foldersToHeader[ma]&&this._foldersToHeader[ma].destroy();for(var na in this._filtersToHeader)this._filtersToHeader[na]&&this._filtersToHeader[na].destroy();};function ga(ma){var na=85;k.scry(ma._tabList,"._1r").forEach(function(oa){na+=oa.offsetWidth;});ma._ellipsizer.confineWithin(ma._rootElement.offsetWidth-na,1.3);}function ha(ma){var na=v.getCurrentStateData();ma._state=v.getCurrentMasterState();ma._folder=na.folder;ma._filter=na.filter;ma._query=na.query;}function ia(ma){if(!ma._state||!ma._folder)return true;var na=v.getCurrentStateData();if(ma._folder!=na.folder)return true;if(ma._filter!=na.filter)return true;return false;}function ja(ma){var na=false,oa;ma._folders.forEach(function(pa){var qa=ma._filter==t.UNREAD,ra=pa==ma._folder&&(ma._filter==p.ALL||qa),sa,ta;switch(pa){case t.INBOX:if(qa){var ua=h.strong(null,da._("Unread")),va=h.strong(null,da._("Inbox")),wa=da._("{unread} messages in {inbox}",[da.param('unread',ua),da.param('inbox',va)]);sa=h.div(null,wa,' \u00b7 ',ma._unreadMarkAllRead);ta=true;}break;case t.OTHER:if(o.CoreGraphEnabled)break;var xa='';if(o.filtering_active)xa=h.span(null,ma._otherEditSettings,' \u00b7 ');sa=h.div(null,h.p(null,h.strong(null,da._("Tip:")+' '),da._("See a message from someone you know? Just reply or click Move to Inbox from the Actions menu.")),xa,ma._otherMarkAllRead);s.tryShow(ma.getOtherFolderLabel());break;}if(ra){oa=pa;j.conditionShow(ma._closeButtonCont,ta);}else ma._foldersToHeader[pa].setSelected(false);if(ra&&sa){na=true;k.setContent(ma._topContent,sa);}});ma._filters.forEach(function(pa){var qa=ma._folder==t.INBOX&&pa==ma._filter;ma._filtersToHeader[pa].setSelected(qa);});oa&&ma._foldersToHeader[oa].setSelected(true);j.conditionShow(ma._topContentCont,na);la(ma);ma._manager.draw();}function ka(ma,na,oa){var pa=ma._state==u.MASTER.SEARCH;if(pa||ma._folder!=na||ma._filter!=oa){var qa=ea({},v.getCurrentStateData()),ra=v.getCurrentDetailState();if(ra!==u.DETAIL.SEARCH_SNIPPET&&ra!==u.DETAIL.SEARCH_CONTEXT)delete qa.query;v.updateMasterState(u.MASTER.RECENT_THREADS,Object.assign(qa,{folder:na,filter:oa}));}z.focusComposer();return false;}function la(ma){for(var na in ma._foldersToHeader){if(na==t.ACTION_ARCHIVED)continue;var oa=ma._unreadState.exceedsMaxCount(na)?r.MAX_UNREAD_COUNT+'+':ma._unreadState.getUnreadCount(na),pa=[ma._foldersToHeader[na].getCountBadge()];if(na==t.INBOX)ma._filters.forEach(function(qa){pa.push(ma._filtersToHeader[qa].getCountBadge());});pa.forEach(function(qa){if(oa)k.setContent(qa,da._("({unread_count})",[da.param('unread_count',oa)]));j.conditionShow(qa,oa);});}ga(ma);}f.exports=fa;},null);
__d('WebMessengerThreadlistRenderer',['CSS','DOM','Event','Focus','MercuryListUpdateRenderer','MercuryAPIArgsSource','MessagingTag','WebMessengerStateConstants','WebMessengerStateManager','WebMessengerTemplates','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','Tooltip','WebMessengerMercury','WebMessengerPermalinks','WebMessengerDeleteThreadDialog','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z={renderThreadsFromIDs:function(ba,ca,da,ea,fa,ga){ea=ea||function(ha){return ha;};fa=fa||{};l.updateList(ba,ca.map(ea),function(ha){return !fa[ca[ha]]&&ca[ha]!=da;},function(ha){var ia=ca[ha],ja=q[':fb:web-messenger:threadlist-row'].build();ja.getRoot().setAttribute('id',ea(ia));var ka=ja.getNode('threadLink');k.listen(ka,function(la){h.conditionClass(ja.getRoot(),"_5fes",la);});j.listen(ka,'click',function(la){if(la.getModifiers().any)return true;var ma=p.getCurrentMasterState(),na={thread_id:ia};if(ma===o.MASTER.SEARCH)na.query=p.getCurrentStateData().query;p.updateDetailState(o.DETAIL.RECENT_MESSAGES,na);return false;});if(ia==da)h.addClass(ja.getRoot(),"_kv");u.getThreads().getThreadMeta(ia,function(la){var ma=s.getForFBID(p.getCurrentUserID());ma.renderCoreThreadlist(la,ja,aa.bind(null,ga),{names_renderer:r.renderShortNames,show_unread_count:false},true);},m.WEBMESSENGER);return ja.getRoot();});}};function aa(ba,ca,da){var ea=ca.getNode('readToggler'),fa=ca.getNode('archiveButton'),ga=ca.getNode('deleteButton');ca.getNode('threadLink').setAttribute('href',v.getURI(ba,o.DETAIL.RECENT_MESSAGES,{thread_id:da.thread_id}).toString());if(da.unread_count>0){h.addClass(ca.getRoot(),"_kx");i.setContent(ca.getNode('newCount'),y._("{num} new",[y.param('num',da.unread_count)]));h.addClass(ea,"_ky");t.set(ea,y._("Mark as Read"),'above','right');}else{h.addClass(ea,"_kz");t.set(ea,y._("Mark as Unread"),'above','right');}j.listen(ea,'click',function(event){var ja=u.getThreadActions();h.hasClass(ea,"_ky")?ja.markRead(da.thread_id):ja.markUnread(da.thread_id);return false;});var ha=p.getCurrentStateData().folder;if(ha==n.SPAM){t.set(ga,y._("Delete Conversation"),'above','right');h.addClass(ga,"_4_3q");j.listen(ga,'click',function(event){w.show(da.thread_id);});h.hide(fa);}else{h.hide(ga);var ia=true;if(ha==n.ACTION_ARCHIVED){ia=false;t.set(fa,y._("Unarchive"),'above','right');h.addClass(fa,"_2s2");}else{t.set(fa,y._("Archive"),'above','right');h.addClass(fa,"_l9");}j.listen(fa,'click',function(event){var ja=u.getThreadActions();ia?ja.archive(da.thread_id):ja.unarchive(da.thread_id);var ka=p.getCurrentStateData();if(ka.thread_id==da.thread_id)p.updateDetailState(o.DETAIL.RECENT_MESSAGES,{folder:ka.folder});return false;});}}f.exports=z;},null);
__d('MercuryDataSources',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i={add:function(j,k){h[j]=k;},get:function(j){!h[j];return h[j];}};f.exports=i;},null);
__d("Autosize",["CSS","cx","DOM","Style"],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=['fontFamily','fontStyle','fontVariant','fontWeight','letterSpacing','textDecoration','textIndent','textTransform','whiteSpace','wordSpacing','wordWrap'],m=/^[0-9]+$/;function n(s){var t=s.cloneNode(true);h.addClass(t,"_4g");var u=s.clientWidth-k.getFloat(s,'paddingLeft')-k.getFloat(s,'paddingRight');k.set(t,'width',u+'px');var v=s.clientHeight-k.getFloat(s,'paddingTop')-k.getFloat(s,'paddingBottom');k.set(t,'height',v+'px');j.insertAfter(s,t);return t;}function o(s,t,u,v,w){var x=s.style.fontSize,y=s.style.height;k.set(s,"height","auto");if(t!==null){var z=s.style.width;k.set(s,"width","auto");}var aa=0,ba=w.length-1;while(aa<ba){var ca=Math.ceil((aa+ba)/2);k.set(s,"font-size",w[ca]+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){ba=ca-1;}else aa=ca;}s.style.fontSize=x;s.style.height=y;if(t!==null)s.style.width=z;return w[aa]+v;}function p(s,t,u,v,w,x){var y=s.style.fontSize,z=s.style.height;k.set(s,"height","auto");if(t!==null){var aa=s.style.width;k.set(s,"width","auto");}k.set(s,"font-size",x+v);if((u===null||s.scrollHeight<=u)&&(t===null||s.scrollWidth<=t)){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return x+v;}k.set(s,"font-size",w+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}while(w+1<x){var ba=Math.ceil((w+x)/2);k.set(s,"font-size",ba+v);if(u!==null&&s.scrollHeight>u||t!==null&&s.scrollWidth>t){x=ba;}else w=ba;}s.style.fontSize=y;s.style.height=z;if(t!==null)s.style.width=aa;return w+v;}function q(s,t){this._wrap=s;this._attr=t;if(this._attr.sizes){var u=this._attr.sizes;for(var v=1,w=u.length;v<w;v++){if(u[v-1]<=u[v])continue;u.sort(function(y,z){return y-z;});break;}}else if(t.min>t.max){var x=t.min;t.min=t.max;t.max=x;}this.fit();}q.prototype.fit=function(s,t){var u=this._wrap;if(!u.clientWidth){r.push(this);return;}var v=n(u);if(typeof s==="undefined")s=this._attr.width;if(m.test(s)){v.style.width=s+"px";}else if(s!==null&&s!=="auto")v.style.width=s;if(typeof t==="undefined")t=this._attr.height;if(m.test(t)){v.style.height=t+"px";}else if(t!==null&&t!=="auto")v.style.height=t;var w=null;if(!this._attr.wrap)w=v.clientWidth;var x=null;if(this._attr.wrap||t!==null)x=v.clientHeight;var y;if(this._attr.sizes){y=o(v,w,x,"px",this._attr.sizes);}else y=p(v,w,x,"px",this._attr.min,this._attr.max);j.remove(v);k.set(u,"font-size",y);h.removeClass(u,"invisible_elem");};var r=[];q.onNodeInserted=function(){var s=r;r=[];s.forEach(function(t){t.fit();});};f.exports=q;},null);
__d('FileFormResetOnSubmit',['DOMQuery','Event','emptyFunction'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(m,n){var o=i.listen(m,'change',j.thatReturnsFalse,i.Priority.URGENT);try{n();}catch(p){throw p;}finally{o.remove();}}function l(m){'use strict';this._form=m;}l.prototype.enable=function(){'use strict';var m=this._reset.bind(this);this._subscription=this._form.subscribe('submit',function(){setTimeout(m,0);});};l.prototype.disable=function(){'use strict';this._subscription.unsubscribe();this._subscription=null;};l.prototype._reset=function(){'use strict';var m=this._form.getRoot();k(m,function(){var n=h.scry(m,'input[type="file"]');n.forEach(function(o){o.value='';});});};f.exports=l;},null);
__d('FormSubmitOnChange',['Event','submitForm'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(k){'use strict';this._form=k;}j.prototype.enable=function(){'use strict';this._listener=h.listen(this._form.getRoot(),'change',this._submit.bind(this));};j.prototype.disable=function(){'use strict';this._listener.remove();this._listener=null;};j.prototype._submit=function(){'use strict';i(this._form.getRoot());};Object.assign(j.prototype,{_listener:null});f.exports=j;},null);