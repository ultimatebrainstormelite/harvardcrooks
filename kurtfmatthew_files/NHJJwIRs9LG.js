/*!CK:2124727837!*//*1439790113,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["SC1tN"]); }

__d('legacy:tooltips',['ToolTips'],function a(b,c,d,e){if(c.__markCompiled)c.__markCompiled();b.ToolTips=c('ToolTips');},3);
__d('CurationCaretNux',['csx','cx','ge','tidyEvent','Arbiter','AsyncRequest','CSS','DataStore','DOM','Event','NavigationMessage','Parent','Rect'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){if(c.__markCompiled)c.__markCompiled();var u="div._1zpr",v="_5jmm",w='CurationCaretNux_instance',x='CurationCaretNux_caretMenuLoaded',y=100,z="caret_nux",aa="save_option_nux",ba="seen",ca="dismissed",da="focus",ea="click",fa="scroll",ga=false;function ha(ia,ja,ka,la){'use strict';var ma=j(la);if(ma){this.container=ma;this.caret=ka;this.caretNux=ia.instance;this.caretNuxData=ia;this.saveOptionNux=ja.instance;this.saveOptionNuxData=ja;this.popoverTriggered=false;var na=s.byClass(ma,v);o.set(na,w,this);this.$CurationCaretNux1();l.subscribeOnce(r.NAVIGATION_BEGIN,(function(){this.caretNux&&this.caretNux.hide();this.saveOptionNux&&this.saveOptionNux.hide();}).bind(this));}}ha.prototype.$CurationCaretNux1=function(){'use strict';var ia=p.scry(this.container,u);if(ia.length>0)k([q.listen(ia[0],'click',(function(){if(ga)return;this.caretNux.subscribe('show',(function(){this.$CurationCaretNux2();}).bind(this));this.caretNux.subscribe('hide',(function(){this.$CurationCaretNux3();if(ga){this.$CurationCaretNux4(z,ba);this.$CurationCaretNux4(z,ca);}}).bind(this));this.$CurationCaretNux5();this.interactionTime=0;setTimeout((function(){if(!this.$CurationCaretNux6()){ga=true;this.caretNux.show();}}).bind(this),this.caretNuxData.min_consume_duration);setTimeout((function(){if(!this.$CurationCaretNux6()){ga=false;this.caretNux.hide();}}).bind(this),this.caretNuxData.max_consume_duration);var ja=Date.now();setTimeout((function(){this.$CurationCaretNux7((function(){if(!this.interactionTime)this.interactionTime=Date.now()-ja;}).bind(this));}).bind(this),0);}).bind(this))]);};ha.prototype.$CurationCaretNux6=function(){'use strict';return this.interactionTime&&this.interactionTime>0;};ha.prototype.$CurationCaretNux2=function(){'use strict';this.caretClickListener=q.listen(this.caret,'click',(function(){this.caretNux.hide();if(this.saveOptionNux){this.popoverTriggered=true;this.$CurationCaretNux8();}}).bind(this));var ia=false;this.$CurationCaretNux7((function(ja){if(ia||ja===ea||!this.caretNux.isShown())return;var ka=t.getViewportWithoutScrollbarsBounds(),la=t.getElementBounds(this.caretNux.getContentRoot());la=la.sub(0,y);if(ka.contains(la)){this.$CurationCaretNux4(z,ba);ia=true;}}).bind(this));};ha.prototype.$CurationCaretNux3=function(){'use strict';this.caretClickListener.remove();this.$CurationCaretNux9();};ha.prototype.$CurationCaretNux8=function(){'use strict';if(this.$CurationCaretNux10()&&this.popoverTriggered)setTimeout((function(){var ia=p.scry(document,"li.save_caret_menu_item");for(var ja=0;ja<ia.length;ja++){var ka=ia[ja],la=s.byClass(ka,"uiLayer");if(la&&n.shown(la)){this.saveOptionNux.setContext(ka);break;}}this.saveOptionNux.show();this.$CurationCaretNux4(aa,ba);var ma=o.get(this.caret,'Popover');ma&&ma.subscribeOnce('hide',(function(){this.saveOptionNux.hide();}).bind(this));}).bind(this),0);};ha.prototype.$CurationCaretNux4=function(ia,ja){'use strict';var ka;if(ia===z){ka=this.caretNuxData;}else if(ia===aa){ka=this.saveOptionNuxData;}else throw "Invalid nux type";var la;if(ja===ba){la=ka.seen_uri;ka.seen_uri=null;}else if(ja===ca){la=ka.dismiss_uri;ka.dismiss_uri=null;}else throw "Invalid impression type";if(la){var ma=new m(la);if(this.interactionTime&&ia===z)ma.setData({interaction_time:this.interactionTime});ma.send();}};ha.prototype.$CurationCaretNux7=function(ia){'use strict';this.$CurationCaretNux11.push(ia);};ha.prototype.$CurationCaretNux12=function(ia){'use strict';this.$CurationCaretNux11.forEach(function(ja){ja.call(this,ia);},this);};ha.prototype.$CurationCaretNux5=function(){'use strict';if(!this.$CurationCaretNux13){this.$CurationCaretNux11=[];this.$CurationCaretNux13=[q.listen(window,'click',this.$CurationCaretNux12.bind(this,ea)),q.listen(window,'focus',this.$CurationCaretNux12.bind(this,da)),q.listen(window,'scroll',this.$CurationCaretNux12.bind(this,fa))];}};ha.prototype.$CurationCaretNux9=function(ia){'use strict';if(this.$CurationCaretNux13){while(this.$CurationCaretNux13.length)this.$CurationCaretNux13.pop().remove();this.$CurationCaretNux13=null;this.$CurationCaretNux11=null;}};ha.prototype.$CurationCaretNux10=function(){'use strict';var ia=s.byClass(this.container,v);return o.get(ia,x)===true;};ha.saveOptionLoaded=function(ia){'use strict';var ja=j(ia);if(ja){var ka=s.byClass(ja,v);o.set(ka,x,true);var la=o.get(ka,w);la&&la.$CurationCaretNux8();}};f.exports=ha;},null);