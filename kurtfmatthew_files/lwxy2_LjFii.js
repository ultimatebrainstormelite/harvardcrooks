/*!CK:1758176318!*//*1439929543,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["GJDTV"]); }

__d("GraphicPhotoWarningConfig",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={Events:{GRAPHIC_PHOTO_SHOWN_NO_WARNING:"GRAPHIC_PHOTO_SHOWN_NO_WARNING",GRAPHIC_PHOTO_SHOWN_WITH_WARNING:"GRAPHIC_PHOTO_SHOWN_WITH_WARNING",GRAPHIC_PHOTO_WARNING_DISMISSED:"GRAPHIC_PHOTO_WARNING_DISMISSED"}};},null,{});
__d('ImageUtils',['UserAgent_DEPRECATED'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={hasLoaded:function(j){if(j.naturalWidth!==undefined){return j.complete&&j.width!==0;}else if(j.height==20&&j.width==20&&j.complete){return false;}else if(j.complete===undefined&&h.webkit()<500){var k=new Image();k.src=j.src;return k.complete;}return j.complete;}};f.exports=i;},null);
__d("XGraphicPhotoWarningLoggingController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/photos\/graphic_photo\/logging\/",{event:{type:"Enum",required:true,enumType:1}});},null,{});
__d('GraphicPhotoWarning',['AsyncRequest','CSS','Event','XGraphicPhotoWarningLoggingController','GraphicPhotoWarningConfig'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('GraphicPhotoWarningConfig').Events;function m(n){'use strict';j.listen(n.seePhotoButton,'click',function(){i.hide(n.warningOverlay);m.log(l.GRAPHIC_PHOTO_WARNING_DISMISSED);});}m.log=function(event){var n=k.getURIBuilder().setEnum('event',event).getURI();new h(n).setAllowCrossPageTransition(true).send();};f.exports=m;},null);
__d('GraphicPhotoWarningMixin',['CSS','DOM','csx','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=k,m={getGraphicWarningContainer:l,getGraphicWarningHiddenContent:l,_graphicWarningMarkup:null,_graphicWarningOverlay:null,_graphicWarningHiddenContentWrapper:null,initGraphicWarningDOM:function(n){this._graphicWarningMarkup=n;this._graphicWarningOverlay=i.scry(n,"._zjl").pop();this._graphicWarningHiddenContentWrapper=i.scry(n,"._zjn").pop();},showGraphicWarning:function(){this._graphicWarningOverlay&&h.show(this._graphicWarningOverlay);if(this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;if(this._graphicWarningHiddenContentWrapper){this.getGraphicWarningContainer().replaceChild(this._graphicWarningMarkup,this.getGraphicWarningHiddenContent());this._graphicWarningHiddenContentWrapper.appendChild(this.getGraphicWarningHiddenContent());}},hideGraphicWarning:function(){if(!this.getGraphicWarningContainer().contains(this._graphicWarningMarkup))return;this.getGraphicWarningContainer().replaceChild(this.getGraphicWarningHiddenContent(),this._graphicWarningMarkup);}};f.exports=m;},null);
__d('PhotoEverstoreLogger',['Event','AsyncRequest','ImageUtils'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}Object.assign(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){var o=document.getElementById(n);if(o!=null)if(j.hasLoaded(o)){l._log(o.src);}else h.listen(o,'load',function(event){l._log(o.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new i().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}f.exports=l;},null);
__d('PhotoSessionLog',['AsyncRequest','Run','URI','Vector'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(){}Object.assign(l,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(m){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.eid='';this.version=m;this.buttonLikes=0;this.pagingAction='';this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;this.panoramaClicks=0;this.panoramaImpressions=0;if(m===l.SNOWLIFT){var n=k.getViewportDimensions();this.width=n.x;this.height=n.y;}},setLogFbids:function(m){this.logIds=m;},setEid:function(m){this.eid=m;},setPhotoSet:function(m){this.set=m;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(m){this.pagingAction=m;},setCycle:function(m){this.cycle=m;},setEndOfRelevant:function(m){this.endOfRelevant=m;},setRelevantCount:function(m){this.relevantCount=m;},setEndMetrics:function(m){this.endMetrics=m;},setSource:function(m){this.source=m;},addPanoramaClick:function(){this.panoramaClicks++;},addPanoramaImpression:function(){this.panoramaImpressions++;},addPhotoView:function(m,n,o){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(m)this.fbidList.push([m.fbid,m.owner,Date.now()]);if(n)this.hiResLoads++;if(o)this.fullScreenViews[m.fbid]=true;},logEnterFullScreen:function(m){this.fullScreenViews[m]=true;},addDetailData:function(m,n){if(!this.details[m])this.details[m]={t:n.num_tags,l:n.has_location,c:n.has_caption,cm:n.comment_count,lk:n.like_count,w:n.width,h:n.height,ad:'{}',p:this.pagingAction};},updateAdData:function(m,n){if(this.details[m])this.details[m].ad=JSON.stringify(n);},logPhotoViews:function(m){if(!this.views)return;if(m!=this.AGGREGATE)this.last=true;var n={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},eid:this.eid,first:this.first,last:this.last,close:m?m:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,panorama_clicks:this.panoramaClicks,panorama_impressions:this.panoramaImpressions};if(this.version===l.SNOWLIFT){var o=k.getViewportDimensions();n.width=o.x||this.width;n.height=o.y||this.height;if(this.hiResLoads>0)n.hires_loads=this.hiResLoads;if(this.last){var p=Object.keys(this.fullScreenViews).length;if(p>0)n.fullscreen=p;}}var q=new j('/ajax/photos/logging/session_logging.php').setSubdomain('www');new h().setAllowCrossPageTransition(true).setURI(q).setOption('asynchronous',m!=l.UNLOAD).setOption('suppressErrorHandlerWarning',true).setData(n).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});i.onUnload(function(){l.logPhotoViews(l.UNLOAD);});i.onLeave(function(){l.logPhotoViews(l.LEAVE);});f.exports=l;},null);
__d('PhotoViewerImage',['PhotoEverstoreLogger','URI','Vector'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();function k(l){'use strict';this._hiResDimensions=l.hiResDimensions&&j.deserialize(l.hiResDimensions);this._normalDimensions=l.normalDimensions&&j.deserialize(l.normalDimensions);this._info=l.info;this._video=l.video;this._shouldLog=l.everstoreLogThis;this._hiResSrc=l.hiResSrc;this._normalSrc=l.normalSrc;this._thumbSrc=l.thumbSrc;this._isInverted=false;this._data=l;}k.prototype.getURIString=function(){'use strict';return new i(this._info.permalink).getUnqualifiedURI().toString();};k.prototype.hasHiResDimensions=function(){'use strict';return !!this._hiResDimensions;};k.prototype.getHiResDimensions=function(){'use strict';return this._hiResDimensions;};k.prototype.getNormalDimensions=function(){'use strict';return this._normalDimensions;};k.prototype.getHiResSrc=function(){'use strict';return this._hiResSrc;};k.prototype.getNormalSrc=function(){'use strict';return this._normalSrc;};k.prototype.getThumbSrc=function(){'use strict';return this._thumbSrc;};k.prototype.getInfo=function(){'use strict';return this._info;};k.prototype.getPermalink=function(){'use strict';return this._info.permalink;};k.prototype.getHighestResSrc=function(){'use strict';return this._hiResSrc||this._normalSrc;};k.prototype.preload=function(l){'use strict';var m;if(this.getHighestResSrc())if(l&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();m=this._resource.src;if(this._shouldLog)h.logImmediately(this._resource.src);}else if(!l&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;m=this._small.src;if(this._shouldLog)h.logImmediately(this._small.src);}return m;};k.prototype.setNormalDimensions=function(l,m){'use strict';this._normalDimensions=new j(l,m);};k.prototype.setHiResDimensions=function(l,m){'use strict';this._hiResDimensions=new j(l,m);};k.prototype.invertDimensions=function(){'use strict';if(this.hasHiResDimensions())this._hiResDimensions=new j(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new j(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;};k.prototype.copy=function(){'use strict';return new k(this._data);};f.exports=k;},null);
__d('PhotosConst',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_PERMALINK_STRING:'permalink',VIEWER_SNOWLIFT_STRING:'snowlift',VIEWER_VAULTBOX_STRING:'vaultbox',VIEWER_CAROUSEL_STRING:'carousel',BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};f.exports=h;},null);
__d('PhotosUtils',['Vector'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(){}Object.assign(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});f.exports=i;},null);
__d('PhotoPermalinkURI',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={isValid:function(i){return h.parse(i)!==null;},parse:function(i){if(this.isValidLegacy(i)){var j=i.getQueryData();if(j.fbid)return {photo_id:j.fbid,set_token:j.set};if(j.id&&j.pid)return {photo_id:j.id+':'+j.pid,set_token:j.set};return null;}var k=i.getPath();if(k[k.length-1]==='/')k=k.substring(0,k.length-1);var l=k.split('/');if(l.length>=3&&l[2]==='photos')if(l.length===4&&/^\d+$/.exec(l[3])!==null){return {photo_id:l[3],set_token:null};}else if(l.length===5&&/^\d+$/.exec(l[4])!==null)return {photo_id:l[4],set_token:l[3]};return null;},isValidLegacy:function(i){var j=i.getPath();if(j[j.length-1]==='/')j=j.substring(0,j.length-1);if(j==='/photo.php'||j==='/force_photo/photo.php'||j==='/photo'||j==='/force_photo/photo/index.php'||j==='/photo/index.php'||j==='/force_photo/photo'||j==='/video.php'||j==='/video/video.php')return true;return false;}};f.exports=h;},null);
__d('PhotoStreamCache',['DOM','HTML','PhotoEverstoreLogger','PhotosConst','PhotoViewerImage','Rect','UIPagelet','URI','Vector','createArrayFromMixed','ge'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=Object.assign||function(u){for(var v=1;v<arguments.length;v++){var w=arguments[v];for(var x in w)if(Object.prototype.hasOwnProperty.call(w,x))u[x]=w[x];}return u;};function t(){'use strict';}t.prototype.init=function(u,v,w,x,y){'use strict';this.version=u;this.pageletName=v;this.pageletRootID=w;this.tagSuggestionMode=y;this.bufferSize=t.BUFFER_SIZE;this.fullBucketSize=t.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.logger=x;this.viewAsUser=null;this.reset();};t.prototype.setViewAs=function(u){'use strict';this.viewAsUser=u;};t.prototype.isInViewAsMode=function(){'use strict';return !!this.viewAsUser;};t.prototype.getViewAsUserId=function(){'use strict';return this.viewAsUser;};t.prototype.getUsesOpaqueCursor=function(){'use strict';return this.usesOpaqueCursor;};t.prototype.isNonCircularPhotoSet=function(){'use strict';return this.usesNonCircularPhotoSet;};t.prototype.setReachedLeftEnd=function(){'use strict';this.reachedLeftEnd=true;};t.prototype.setReachedRightEnd=function(){'use strict';this.reachedRightEnd=true;};t.prototype.hasReachedLeftEnd=function(){'use strict';return this.reachedLeftEnd;};t.prototype.hasReachedRightEnd=function(){'use strict';return this.reachedRightEnd;};t.prototype.nonCircularPhotoSetCanPage=function(u){'use strict';if(!this.isNonCircularPhotoSet())return true;if(u<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(u>0)return this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd();return true;};t.prototype.setUseAjaxPipe=function(u){'use strict';this.useAjaxPipe=u;};t.prototype.reset=function(){'use strict';this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;};t.prototype.waitForInitData=function(){'use strict';this.fbidList.push(t.INIT_PLACEHOLDER);};t.prototype.destroy=function(){'use strict';this.reset();this.isActive=false;};t.prototype.isLoaded=function(){'use strict';return this.loaded;};t.prototype.canPage=function(){'use strict';if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;};t.prototype.errorInCurrent=function(){'use strict';if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());};t.prototype.getLength=function(){'use strict';return this.fbidList.length;};t.prototype.getPhotoSet=function(){'use strict';return this.photoSetQuery.set;};t.prototype.getPhotoSetQuery=function(){'use strict';return this.photoSetQuery;};t.prototype.getCurrentImageData=function(){'use strict';return this.getImageData(this.getCursor());};t.prototype.addViewAsToURI=function(u){'use strict';var v=new o(u);if(this.isInViewAsMode())v.addQueryData({viewas:this.getViewAsUserId()});return v;};t.prototype.getOpaqueCursor=function(u){'use strict';if(this.getImageData(u)){if(this.version===k.VIEWER_VAULTBOX)return this.getImageData(u).getInfo().opaquecursor;return this.getImageData(u).info.opaquecursor;}if(u==this.firstCursor)return this.firstOpaqueCursor;return null;};t.prototype.getImageData=function(u){'use strict';var v=this.getCacheContent(u,t.IMAGE_DATA);if(v)v.info.permalink=this.addViewAsToURI(v.info.permalink);return v;};t.prototype.getCurrentHtml=function(){'use strict';return this.getCacheContent(this.getCursor(),t.HTML);};t.prototype.getCurrentExtraData=function(){'use strict';return this.getCacheContent(this.getCursor(),t.EXTRA);};t.prototype.getCacheContent=function(u,v){'use strict';if(!u||u===t.ERROR_ID||u===t.INIT_PLACEHOLDER)return null;return this.cache[v][u];};t.prototype.getCursorPos=function(){'use strict';return this.position;};t.prototype.getCursor=function(){'use strict';if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;};t.prototype.getCursorAt=function(u){'use strict';return this.fbidList[u];};t.prototype.getCursorForURI=function(u){'use strict';return this.permalinkMap[u];};t.prototype.calculatePositionForMovement=function(u){'use strict';var v=this.position+u;if(this.allLoaded){var w=this.getLength();v=(w+v%w)%w;}return v;};t.prototype.isValidMovement=function(u){'use strict';if(!this.isLoaded()||!this.canPage())return false;var v=this.calculatePositionForMovement(u);return this.getCursor()>0||v>=0&&v<this.getLength();};t.prototype.moveCursor=function(u){'use strict';if(!this.isValidMovement(u))return;this.position=this.calculatePositionForMovement(u);if(u!==0)this.loadMoreIfNeccessary(u>0);};t.prototype.checkErrorAt=function(u){'use strict';if(!this.isLoaded())return false;if(u===t.ERROR_ID)return true;return false;};t.prototype.getRelativeMovement=function(u){'use strict';for(var v=0;v<this.getLength();v++)if(this.fbidList[v]==u)return v-this.position;return null;};t.prototype.preloadImages=function(u){'use strict';var v,w,x=this.getLength(),y=this.cache.image,z=t.BUFFER_SIZE;if(x>z*2){v=(this.position+x-z%x)%x;w=(this.position+z)%x;}else{v=0;w=x-1;}while(v!=w){var aa,ba=this.fbidList[v],ca=u&&u(y[ba]);if(this.version===k.VIEWER_VAULTBOX){aa=y[ba]&&y[ba].preload(ca);}else if(y[ba]&&y[ba].url)if(ca&&!y[ba].resource){y[ba].resource=new Image();y[ba].resource.src=y[ba].url;aa=y[ba].url;if(y[ba].everstoreLogThis===true)j.logImmediately(y[ba].resource.src);}else if(!ca&&!y[ba].small){y[ba].small=new Image();y[ba].small.src=y[ba].smallurl||y[ba].url;aa=y[ba].small.src;if(y[ba].everstoreLogThis===true)j.logImmediately(y[ba].small.src);}if(this.logger&&aa)this.logger.log(aa);v=(v+1)%x;}};t.prototype.loadMoreIfNeccessary=function(u){'use strict';if(this.allLoaded||u&&this.rightLock||!u&&this.leftLock)return;var v=u?1:-1,w=this.position+this.bufferSize*v;if(w<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(w>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}};t.prototype.getEndCursor=function(u){'use strict';return u?this.fbidList[this.getLength()-1]:this.fbidList[0];};t.prototype.calculateRelativeIndex=function(u,v,w){'use strict';if(!this.totalCount)return null;var x=this.fbidList.indexOf(v),y=this.fbidList.indexOf(w);if(x===-1||y===-1)return null;var z=y-x;return (u+z+this.totalCount)%this.totalCount;};t.prototype.calculateDistance=function(u,v){'use strict';var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;return (x-w+this.getLength())%this.getLength();};t.prototype.fetch=function(u,v){'use strict';var w=this.getEndCursor(v),x=s({cursor:w,version:this.version,end:this.getEndCursor(!v),fetchSize:v?u:-1*u,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(w),tagSuggestionMode:this.tagSuggestionMode},this.photoSetQuery);if(this.isInViewAsMode())x.viewas=this.getViewAsUserId();if(this.totalCount&&this.firstCursorIndex!==null){x.total=this.totalCount;x.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,w);}var y=r(this.pageletRootID);if(!y){y=h.create('div',{id:this.pageletRootID});h.appendContent(document.body,y);}n.loadFromEndpoint(this.pageletName,y,x,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);};t.prototype.storeToCache=function(u){'use strict';var v={};if(!this.isActive)return v;if('error' in u){this.processErrorResult(u.error);v.error=true;return v;}if('init' in u){this.processInitResult(u.init);v.init={logids:u.init.logids,fbid:u.init.fbid,loggedin:u.init.loggedin,fromad:u.init.fromad,eid:u.init.eid};}if('image' in u){this.processImageResult(u.image);v.image=true;}if('data' in u){this.processDataResult(u.data);v.data=true;}return v;};t.prototype.processInitResult=function(u){'use strict';if(this.loaded)return;this.usesOpaqueCursor=u.usesopaquecursor;this.usesNonCircularPhotoSet=u.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=u.query;if(u.bufferSize)this.bufferSize=u.bufferSize;if(u.fullBucketSize)this.fullBucketSize=u.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(u.fbid);this.rightLock=true;}else{var v=this.fbidList.indexOf(t.INIT_PLACEHOLDER);if(v!=-1)this.fbidList[v]=u.fbid;}this.firstCursor=u.fbid;this.firstOpaqueCursor=u.opaquecursor;if('initIndex' in u&&'totalCount' in u){this.firstCursorIndex=u.initIndex;this.totalCount=u.totalCount;}if(this.version==k.VIEWER_PERMALINK)this.fetch(t.INIT_BUCKET_SIZE,true);};t.prototype.processImageResult=function(u){'use strict';for(var v in u){if(v===this.firstCursor&&u[v].everstoreLogThis)j.logImmediately(u[v].url);if(this.version===k.VIEWER_VAULTBOX){var w=u[v];this.cache.image[v]=new l(w);this.permalinkMap[this.cache.image[v].getURIString()]=v;}else{this.cache.image[v]=u[v];if(u[v].dimensions)this.cache.image[v].dimensions=p.deserialize(u[v].dimensions);if(u[v].originalDimensions)this.cache.image[v].originalDimensions=p.deserialize(u[v].originalDimensions);if(u[v].smalldims)this.cache.image[v].smalldims=p.deserialize(u[v].smalldims);this.permalinkMap[new o(u[v].info.permalink).getUnqualifiedURI().toString()]=v;}}};t.prototype.attachToFbidsList=function(u,v,w){'use strict';if(this.allLoaded)return;if(v===-1){for(var x=u.length-1;x>=0;x--){this.fbidList.unshift(u[x]);this.position++;}this.leftLock=false;}else{for(var y=0;y<u.length;y++)this.fbidList.push(u[y]);this.rightLock=false;}if(w)this.setAllLoaded();};t.prototype.setAllLoaded=function(){'use strict';this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);};t.prototype.processDataResult=function(u){'use strict';for(var v in u){if(!this.cache.html[v])this.cache.html[v]={};for(var w in u[v].html){var x=u[v].html[w];if(typeof x==='string')x=i(x).getRootNode();this.cache.html[v][w]=q(x.childNodes);}if(!('extra' in u[v])){this.cache.extra[v]=null;continue;}this.cache.extra[v]={tagRects:{}};if(!Array.isArray(u[v].extra.tagRects))for(var y in u[v].extra.tagRects)if(u[v].extra.tagRects[y])this.cache.extra[v].tagRects[y]=m.deserialize(u[v].extra.tagRects[y]);Object.keys(u[v].extra).forEach((function(z){if(z=='tagRects')return;this.cache.extra[v][z]=u[v].extra[z];}).bind(this));}};t.prototype.processErrorResult=function(u){'use strict';if(!this.isLoaded()){this.initError=true;return;}var v=u.side,w=[t.ERROR_ID];this.attachToFbidsList(w,v);};t.prototype.setTotalCount=function(u){'use strict';this.totalCount=u;};t.prototype.setFirstCursorIndex=function(u){'use strict';this.firstCursorIndex=u;};Object.assign(t,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});f.exports=t;},null);
__d('PhotoViewer',['Bootloader','CSS','DOM','emptyFunction'],function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();function l(){'use strict';this.image=null;this.root=null;this.stream=null;}l.prototype.getEventString=function(m){'use strict';var n=this.getEventPrefix();if(n)return n+'.'+m;return null;};l.prototype.getImage=function(){'use strict';return this.image;};l.prototype.getPosition=function(){'use strict';return this.stream?this.stream.getCursor():null;};l.prototype.getRoot=function(){'use strict';return this.root;};l.prototype.hiliteAllBoxes=function(){'use strict';j.scry(this.stageWrapper,'div.tagsWrapper div.faceBox').forEach(function(m){i.addClass(m,'otherActive');});};l.bootstrap=function(m,n){'use strict';h.loadModules(["PhotoSnowlift"],function(o){o.bootstrap(m,n);});};Object.assign(l.prototype,{getEventPrefix:k.thatReturnsNull,getSourceString:k.thatReturnsNull,getVersionConst:k.thatReturnsNull,getViewerSource:k.thatReturnsNull,getViewerSet:k.thatReturnsNull});f.exports=l;},null);
__d('PhotoTagSearchPivotLogger',['Banzai'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i={};h.subscribe(h.SHUTDOWN,function(){Object.keys(i).forEach(function(m){var n=i[m];Object.keys(n).forEach(function(o){h.post('photo_tag_search_pivot',{source:m,action:o,count:n[o]});});});});var j=/^(perm:)?tag:/,k,l={logImpression:function(m,n){var o=m in i?i[m]:i[m]={};o[n]=n in o?o[n]+1:1;},logImageImpression:function(m,n,o){if(k!==n){if(o.some(function(p){return j.test(p);}))this.logImpression(m,'image_impression');k=n;}},logPivotImpression:function(m,n){if(j.test(n))this.logImpression(m,'pivot_impression');},logShowMorePhotos:function(){this.logImpression('photoset','show_more_photos');},logHideMorePhotos:function(){this.logImpression('photoset','hide_more_photos');},logSuggestMorePhotos:function(){this.logImpression('photoset','suggest_more_photos');},logMorePhotosNavigation:function(m){h.post('photo_tag_search_pivot',{source:'photoset',action:'more_photos_search',query:m,count:1});}};f.exports=l;},null);